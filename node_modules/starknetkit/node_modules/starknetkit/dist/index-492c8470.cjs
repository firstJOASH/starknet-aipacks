"use strict";var Oh=Object.defineProperty;var Ah=(t,e,i)=>e in t?Oh(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i;var V=(t,e,i)=>(Ah(t,typeof e!="symbol"?e+"":e,i),i);const Ot=require("./connector-391e8980.cjs"),st=require("./Modal-e70d488c.cjs"),gt=require("starknet"),Zc=require("./index-631f545a.cjs");var Ws={exports:{}},_i=typeof Reflect=="object"?Reflect:null,Ao=_i&&typeof _i.apply=="function"?_i.apply:function(e,i,r){return Function.prototype.apply.call(e,i,r)},kr;_i&&typeof _i.ownKeys=="function"?kr=_i.ownKeys:Object.getOwnPropertySymbols?kr=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:kr=function(e){return Object.getOwnPropertyNames(e)};function Ph(t){console&&console.warn&&console.warn(t)}var Qc=Number.isNaN||function(e){return e!==e};function te(){te.init.call(this)}Ws.exports=te;Ws.exports.once=Nh;te.EventEmitter=te;te.prototype._events=void 0;te.prototype._eventsCount=0;te.prototype._maxListeners=void 0;var Po=10;function an(t){if(typeof t!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}Object.defineProperty(te,"defaultMaxListeners",{enumerable:!0,get:function(){return Po},set:function(t){if(typeof t!="number"||t<0||Qc(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");Po=t}});te.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};te.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||Qc(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function Xc(t){return t._maxListeners===void 0?te.defaultMaxListeners:t._maxListeners}te.prototype.getMaxListeners=function(){return Xc(this)};te.prototype.emit=function(e){for(var i=[],r=1;r<arguments.length;r++)i.push(arguments[r]);var n=e==="error",s=this._events;if(s!==void 0)n=n&&s.error===void 0;else if(!n)return!1;if(n){var o;if(i.length>0&&(o=i[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var c=s[e];if(c===void 0)return!1;if(typeof c=="function")Ao(c,this,i);else for(var u=c.length,l=nu(c,u),r=0;r<u;++r)Ao(l[r],this,i);return!0};function eu(t,e,i,r){var n,s,o;if(an(i),s=t._events,s===void 0?(s=t._events=Object.create(null),t._eventsCount=0):(s.newListener!==void 0&&(t.emit("newListener",e,i.listener?i.listener:i),s=t._events),o=s[e]),o===void 0)o=s[e]=i,++t._eventsCount;else if(typeof o=="function"?o=s[e]=r?[i,o]:[o,i]:r?o.unshift(i):o.push(i),n=Xc(t),n>0&&o.length>n&&!o.warned){o.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=t,a.type=e,a.count=o.length,Ph(a)}return t}te.prototype.addListener=function(e,i){return eu(this,e,i,!1)};te.prototype.on=te.prototype.addListener;te.prototype.prependListener=function(e,i){return eu(this,e,i,!0)};function Ch(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function tu(t,e,i){var r={fired:!1,wrapFn:void 0,target:t,type:e,listener:i},n=Ch.bind(r);return n.listener=i,r.wrapFn=n,n}te.prototype.once=function(e,i){return an(i),this.on(e,tu(this,e,i)),this};te.prototype.prependOnceListener=function(e,i){return an(i),this.prependListener(e,tu(this,e,i)),this};te.prototype.removeListener=function(e,i){var r,n,s,o,a;if(an(i),n=this._events,n===void 0)return this;if(r=n[e],r===void 0)return this;if(r===i||r.listener===i)--this._eventsCount===0?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||i));else if(typeof r!="function"){for(s=-1,o=r.length-1;o>=0;o--)if(r[o]===i||r[o].listener===i){a=r[o].listener,s=o;break}if(s<0)return this;s===0?r.shift():Rh(r,s),r.length===1&&(n[e]=r[0]),n.removeListener!==void 0&&this.emit("removeListener",e,a||i)}return this};te.prototype.off=te.prototype.removeListener;te.prototype.removeAllListeners=function(e){var i,r,n;if(r=this._events,r===void 0)return this;if(r.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):r[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete r[e]),this;if(arguments.length===0){var s=Object.keys(r),o;for(n=0;n<s.length;++n)o=s[n],o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(i=r[e],typeof i=="function")this.removeListener(e,i);else if(i!==void 0)for(n=i.length-1;n>=0;n--)this.removeListener(e,i[n]);return this};function iu(t,e,i){var r=t._events;if(r===void 0)return[];var n=r[e];return n===void 0?[]:typeof n=="function"?i?[n.listener||n]:[n]:i?Th(n):nu(n,n.length)}te.prototype.listeners=function(e){return iu(this,e,!0)};te.prototype.rawListeners=function(e){return iu(this,e,!1)};te.listenerCount=function(t,e){return typeof t.listenerCount=="function"?t.listenerCount(e):ru.call(t,e)};te.prototype.listenerCount=ru;function ru(t){var e=this._events;if(e!==void 0){var i=e[t];if(typeof i=="function")return 1;if(i!==void 0)return i.length}return 0}te.prototype.eventNames=function(){return this._eventsCount>0?kr(this._events):[]};function nu(t,e){for(var i=new Array(e),r=0;r<e;++r)i[r]=t[r];return i}function Rh(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}function Th(t){for(var e=new Array(t.length),i=0;i<e.length;++i)e[i]=t[i].listener||t[i];return e}function Nh(t,e){return new Promise(function(i,r){function n(o){t.removeListener(e,s),r(o)}function s(){typeof t.removeListener=="function"&&t.removeListener("error",n),i([].slice.call(arguments))}su(t,e,s,{once:!0}),e!=="error"&&Fh(t,n,{once:!0})})}function Fh(t,e,i){typeof t.on=="function"&&su(t,"error",e,i)}function su(t,e,i,r){if(typeof t.on=="function")r.once?t.once(e,i):t.on(e,i);else if(typeof t.addEventListener=="function")t.addEventListener(e,function n(s){r.once&&t.removeEventListener(e,n),i(s)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t)}var Ge=Ws.exports;const ou=Ot.getDefaultExportFromCjs(Ge);var T={};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var ls=function(t,e){return ls=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var n in r)r.hasOwnProperty(n)&&(i[n]=r[n])},ls(t,e)};function Lh(t,e){ls(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}var hs=function(){return hs=Object.assign||function(e){for(var i,r=1,n=arguments.length;r<n;r++){i=arguments[r];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(e[s]=i[s])}return e},hs.apply(this,arguments)};function Bh(t,e){var i={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(i[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,r=Object.getOwnPropertySymbols(t);n<r.length;n++)e.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(t,r[n])&&(i[r[n]]=t[r[n]]);return i}function Uh(t,e,i,r){var n=arguments.length,s=n<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,i):r,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s}function kh(t,e){return function(i,r){e(i,r,t)}}function Mh(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function qh(t,e,i,r){function n(s){return s instanceof i?s:new i(function(o){o(s)})}return new(i||(i=Promise))(function(s,o){function a(l){try{u(r.next(l))}catch(h){o(h)}}function c(l){try{u(r.throw(l))}catch(h){o(h)}}function u(l){l.done?s(l.value):n(l.value).then(a,c)}u((r=r.apply(t,e||[])).next())})}function jh(t,e){var i={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,n,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(u){return function(l){return c([u,l])}}function c(u){if(r)throw new TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(s=u[0]&2?n.return:u[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,u[1])).done)return s;switch(n=0,s&&(u=[u[0]&2,s.value]),u[0]){case 0:case 1:s=u;break;case 4:return i.label++,{value:u[1],done:!1};case 5:i.label++,n=u[1],u=[0];continue;case 7:u=i.ops.pop(),i.trys.pop();continue;default:if(s=i.trys,!(s=s.length>0&&s[s.length-1])&&(u[0]===6||u[0]===2)){i=0;continue}if(u[0]===3&&(!s||u[1]>s[0]&&u[1]<s[3])){i.label=u[1];break}if(u[0]===6&&i.label<s[1]){i.label=s[1],s=u;break}if(s&&i.label<s[2]){i.label=s[2],i.ops.push(u);break}s[2]&&i.ops.pop(),i.trys.pop();continue}u=e.call(t,i)}catch(l){u=[6,l],n=0}finally{r=s=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function zh(t,e,i,r){r===void 0&&(r=i),t[r]=e[i]}function Vh(t,e){for(var i in t)i!=="default"&&!e.hasOwnProperty(i)&&(e[i]=t[i])}function ds(t){var e=typeof Symbol=="function"&&Symbol.iterator,i=e&&t[e],r=0;if(i)return i.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function au(t,e){var i=typeof Symbol=="function"&&t[Symbol.iterator];if(!i)return t;var r=i.call(t),n,s=[],o;try{for(;(e===void 0||e-- >0)&&!(n=r.next()).done;)s.push(n.value)}catch(a){o={error:a}}finally{try{n&&!n.done&&(i=r.return)&&i.call(r)}finally{if(o)throw o.error}}return s}function Kh(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(au(arguments[e]));return t}function Hh(){for(var t=0,e=0,i=arguments.length;e<i;e++)t+=arguments[e].length;for(var r=Array(t),n=0,e=0;e<i;e++)for(var s=arguments[e],o=0,a=s.length;o<a;o++,n++)r[n]=s[o];return r}function ir(t){return this instanceof ir?(this.v=t,this):new ir(t)}function Wh(t,e,i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=i.apply(t,e||[]),n,s=[];return n={},o("next"),o("throw"),o("return"),n[Symbol.asyncIterator]=function(){return this},n;function o(d){r[d]&&(n[d]=function(f){return new Promise(function(p,g){s.push([d,f,p,g])>1||a(d,f)})})}function a(d,f){try{c(r[d](f))}catch(p){h(s[0][3],p)}}function c(d){d.value instanceof ir?Promise.resolve(d.value.v).then(u,l):h(s[0][2],d)}function u(d){a("next",d)}function l(d){a("throw",d)}function h(d,f){d(f),s.shift(),s.length&&a(s[0][0],s[0][1])}}function Gh(t){var e,i;return e={},r("next"),r("throw",function(n){throw n}),r("return"),e[Symbol.iterator]=function(){return this},e;function r(n,s){e[n]=t[n]?function(o){return(i=!i)?{value:ir(t[n](o)),done:n==="return"}:s?s(o):o}:s}}function Yh(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],i;return e?e.call(t):(t=typeof ds=="function"?ds(t):t[Symbol.iterator](),i={},r("next"),r("throw"),r("return"),i[Symbol.asyncIterator]=function(){return this},i);function r(s){i[s]=t[s]&&function(o){return new Promise(function(a,c){o=t[s](o),n(a,c,o.done,o.value)})}}function n(s,o,a,c){Promise.resolve(c).then(function(u){s({value:u,done:a})},o)}}function Jh(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function Zh(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var i in t)Object.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function Qh(t){return t&&t.__esModule?t:{default:t}}function Xh(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}function ed(t,e,i){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,i),i}const td=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return hs},__asyncDelegator:Gh,__asyncGenerator:Wh,__asyncValues:Yh,__await:ir,__awaiter:qh,__classPrivateFieldGet:Xh,__classPrivateFieldSet:ed,__createBinding:zh,__decorate:Uh,__exportStar:Vh,__extends:Lh,__generator:jh,__importDefault:Qh,__importStar:Zh,__makeTemplateObject:Jh,__metadata:Mh,__param:kh,__read:au,__rest:Bh,__spread:Kh,__spreadArrays:Hh,__values:ds},Symbol.toStringTag,{value:"Module"})),hr=Ot.getAugmentedNamespace(td);var $n={},ki={},Co;function id(){if(Co)return ki;Co=1,Object.defineProperty(ki,"__esModule",{value:!0}),ki.delay=void 0;function t(e){return new Promise(i=>{setTimeout(()=>{i(!0)},e)})}return ki.delay=t,ki}var jt={},xn={},zt={},Ro;function rd(){return Ro||(Ro=1,Object.defineProperty(zt,"__esModule",{value:!0}),zt.ONE_THOUSAND=zt.ONE_HUNDRED=void 0,zt.ONE_HUNDRED=100,zt.ONE_THOUSAND=1e3),zt}var On={},To;function nd(){return To||(To=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ONE_YEAR=t.FOUR_WEEKS=t.THREE_WEEKS=t.TWO_WEEKS=t.ONE_WEEK=t.THIRTY_DAYS=t.SEVEN_DAYS=t.FIVE_DAYS=t.THREE_DAYS=t.ONE_DAY=t.TWENTY_FOUR_HOURS=t.TWELVE_HOURS=t.SIX_HOURS=t.THREE_HOURS=t.ONE_HOUR=t.SIXTY_MINUTES=t.THIRTY_MINUTES=t.TEN_MINUTES=t.FIVE_MINUTES=t.ONE_MINUTE=t.SIXTY_SECONDS=t.THIRTY_SECONDS=t.TEN_SECONDS=t.FIVE_SECONDS=t.ONE_SECOND=void 0,t.ONE_SECOND=1,t.FIVE_SECONDS=5,t.TEN_SECONDS=10,t.THIRTY_SECONDS=30,t.SIXTY_SECONDS=60,t.ONE_MINUTE=t.SIXTY_SECONDS,t.FIVE_MINUTES=t.ONE_MINUTE*5,t.TEN_MINUTES=t.ONE_MINUTE*10,t.THIRTY_MINUTES=t.ONE_MINUTE*30,t.SIXTY_MINUTES=t.ONE_MINUTE*60,t.ONE_HOUR=t.SIXTY_MINUTES,t.THREE_HOURS=t.ONE_HOUR*3,t.SIX_HOURS=t.ONE_HOUR*6,t.TWELVE_HOURS=t.ONE_HOUR*12,t.TWENTY_FOUR_HOURS=t.ONE_HOUR*24,t.ONE_DAY=t.TWENTY_FOUR_HOURS,t.THREE_DAYS=t.ONE_DAY*3,t.FIVE_DAYS=t.ONE_DAY*5,t.SEVEN_DAYS=t.ONE_DAY*7,t.THIRTY_DAYS=t.ONE_DAY*30,t.ONE_WEEK=t.SEVEN_DAYS,t.TWO_WEEKS=t.ONE_WEEK*2,t.THREE_WEEKS=t.ONE_WEEK*3,t.FOUR_WEEKS=t.ONE_WEEK*4,t.ONE_YEAR=t.ONE_DAY*365}(On)),On}var No;function cu(){return No||(No=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=hr;e.__exportStar(rd(),t),e.__exportStar(nd(),t)}(xn)),xn}var Fo;function sd(){if(Fo)return jt;Fo=1,Object.defineProperty(jt,"__esModule",{value:!0}),jt.fromMiliseconds=jt.toMiliseconds=void 0;const t=cu();function e(r){return r*t.ONE_THOUSAND}jt.toMiliseconds=e;function i(r){return Math.floor(r/t.ONE_THOUSAND)}return jt.fromMiliseconds=i,jt}var Lo;function od(){return Lo||(Lo=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=hr;e.__exportStar(id(),t),e.__exportStar(sd(),t)}($n)),$n}var hi={},Bo;function ad(){if(Bo)return hi;Bo=1,Object.defineProperty(hi,"__esModule",{value:!0}),hi.Watch=void 0;class t{constructor(){this.timestamps=new Map}start(i){if(this.timestamps.has(i))throw new Error(`Watch already started for label: ${i}`);this.timestamps.set(i,{started:Date.now()})}stop(i){const r=this.get(i);if(typeof r.elapsed<"u")throw new Error(`Watch already stopped for label: ${i}`);const n=Date.now()-r.started;this.timestamps.set(i,{started:r.started,elapsed:n})}get(i){const r=this.timestamps.get(i);if(typeof r>"u")throw new Error(`No timestamp found for label: ${i}`);return r}elapsed(i){const r=this.get(i);return r.elapsed||Date.now()-r.started}}return hi.Watch=t,hi.default=t,hi}var An={},Mi={},Uo;function cd(){if(Uo)return Mi;Uo=1,Object.defineProperty(Mi,"__esModule",{value:!0}),Mi.IWatch=void 0;class t{}return Mi.IWatch=t,Mi}var ko;function ud(){return ko||(ko=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),hr.__exportStar(cd(),t)}(An)),An}(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=hr;e.__exportStar(od(),t),e.__exportStar(ad(),t),e.__exportStar(ud(),t),e.__exportStar(cu(),t)})(T);class oi{}let ld=class extends oi{constructor(e){super()}};const Mo=T.FIVE_SECONDS,Ci={pulse:"heartbeat_pulse"};let hd=class uu extends ld{constructor(e){super(e),this.events=new Ge.EventEmitter,this.interval=Mo,this.interval=e?.interval||Mo}static async init(e){const i=new uu(e);return await i.init(),i}async init(){await this.initialize()}stop(){clearInterval(this.intervalRef)}on(e,i){this.events.on(e,i)}once(e,i){this.events.once(e,i)}off(e,i){this.events.off(e,i)}removeListener(e,i){this.events.removeListener(e,i)}async initialize(){this.intervalRef=setInterval(()=>this.pulse(),T.toMiliseconds(this.interval))}pulse(){this.events.emit(Ci.pulse)}};const dd=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,pd=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,fd=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function gd(t,e){if(t==="__proto__"||t==="constructor"&&e&&typeof e=="object"&&"prototype"in e){yd(t);return}return e}function yd(t){console.warn(`[destr] Dropping "${t}" key to prevent prototype pollution.`)}function xr(t,e={}){if(typeof t!="string")return t;if(t[0]==='"'&&t[t.length-1]==='"'&&t.indexOf("\\")===-1)return t.slice(1,-1);const i=t.trim();if(i.length<=9)switch(i.toLowerCase()){case"true":return!0;case"false":return!1;case"undefined":return;case"null":return null;case"nan":return Number.NaN;case"infinity":return Number.POSITIVE_INFINITY;case"-infinity":return Number.NEGATIVE_INFINITY}if(!fd.test(t)){if(e.strict)throw new SyntaxError("[destr] Invalid JSON");return t}try{if(dd.test(t)||pd.test(t)){if(e.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(t,gd)}return JSON.parse(t)}catch(r){if(e.strict)throw r;return t}}function wd(t){return!t||typeof t.then!="function"?Promise.resolve(t):t}function we(t,...e){try{return wd(t(...e))}catch(i){return Promise.reject(i)}}function md(t){const e=typeof t;return t===null||e!=="object"&&e!=="function"}function bd(t){const e=Object.getPrototypeOf(t);return!e||e.isPrototypeOf(Object)}function Mr(t){if(md(t))return String(t);if(bd(t)||Array.isArray(t))return JSON.stringify(t);if(typeof t.toJSON=="function")return Mr(t.toJSON());throw new Error("[unstorage] Cannot stringify value!")}const ps="base64:";function vd(t){return typeof t=="string"?t:ps+Id(t)}function Ed(t){return typeof t!="string"||!t.startsWith(ps)?t:_d(t.slice(ps.length))}function _d(t){return globalThis.Buffer?Buffer.from(t,"base64"):Uint8Array.from(globalThis.atob(t),e=>e.codePointAt(0))}function Id(t){return globalThis.Buffer?Buffer.from(t).toString("base64"):globalThis.btoa(String.fromCodePoint(...t))}function Ue(t){return t&&t.split("?")[0]?.replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,"")||""}function Dd(...t){return Ue(t.join(":"))}function Or(t){return t=Ue(t),t?t+":":""}function Sd(t,e){if(e===void 0)return!0;let i=0,r=t.indexOf(":");for(;r>-1;)i++,r=t.indexOf(":",r+1);return i<=e}function $d(t,e){return e?t.startsWith(e)&&t[t.length-1]!=="$":t[t.length-1]!=="$"}const xd="memory",Od=()=>{const t=new Map;return{name:xd,getInstance:()=>t,hasItem(e){return t.has(e)},getItem(e){return t.get(e)??null},getItemRaw(e){return t.get(e)??null},setItem(e,i){t.set(e,i)},setItemRaw(e,i){t.set(e,i)},removeItem(e){t.delete(e)},getKeys(){return[...t.keys()]},clear(){t.clear()},dispose(){t.clear()}}};function Ad(t={}){const e={mounts:{"":t.driver||Od()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},i=u=>{for(const l of e.mountpoints)if(u.startsWith(l))return{base:l,relativeKey:u.slice(l.length),driver:e.mounts[l]};return{base:"",relativeKey:u,driver:e.mounts[""]}},r=(u,l)=>e.mountpoints.filter(h=>h.startsWith(u)||l&&u.startsWith(h)).map(h=>({relativeBase:u.length>h.length?u.slice(h.length):void 0,mountpoint:h,driver:e.mounts[h]})),n=(u,l)=>{if(e.watching){l=Ue(l);for(const h of e.watchListeners)h(u,l)}},s=async()=>{if(!e.watching){e.watching=!0;for(const u in e.mounts)e.unwatch[u]=await qo(e.mounts[u],n,u)}},o=async()=>{if(e.watching){for(const u in e.unwatch)await e.unwatch[u]();e.unwatch={},e.watching=!1}},a=(u,l,h)=>{const d=new Map,f=p=>{let g=d.get(p.base);return g||(g={driver:p.driver,base:p.base,items:[]},d.set(p.base,g)),g};for(const p of u){const g=typeof p=="string",y=Ue(g?p:p.key),m=g?void 0:p.value,w=g||!p.options?l:{...l,...p.options},b=i(y);f(b).items.push({key:y,value:m,relativeKey:b.relativeKey,options:w})}return Promise.all([...d.values()].map(p=>h(p))).then(p=>p.flat())},c={hasItem(u,l={}){u=Ue(u);const{relativeKey:h,driver:d}=i(u);return we(d.hasItem,h,l)},getItem(u,l={}){u=Ue(u);const{relativeKey:h,driver:d}=i(u);return we(d.getItem,h,l).then(f=>xr(f))},getItems(u,l={}){return a(u,l,h=>h.driver.getItems?we(h.driver.getItems,h.items.map(d=>({key:d.relativeKey,options:d.options})),l).then(d=>d.map(f=>({key:Dd(h.base,f.key),value:xr(f.value)}))):Promise.all(h.items.map(d=>we(h.driver.getItem,d.relativeKey,d.options).then(f=>({key:d.key,value:xr(f)})))))},getItemRaw(u,l={}){u=Ue(u);const{relativeKey:h,driver:d}=i(u);return d.getItemRaw?we(d.getItemRaw,h,l):we(d.getItem,h,l).then(f=>Ed(f))},async setItem(u,l,h={}){if(l===void 0)return c.removeItem(u);u=Ue(u);const{relativeKey:d,driver:f}=i(u);f.setItem&&(await we(f.setItem,d,Mr(l),h),f.watch||n("update",u))},async setItems(u,l){await a(u,l,async h=>{if(h.driver.setItems)return we(h.driver.setItems,h.items.map(d=>({key:d.relativeKey,value:Mr(d.value),options:d.options})),l);h.driver.setItem&&await Promise.all(h.items.map(d=>we(h.driver.setItem,d.relativeKey,Mr(d.value),d.options)))})},async setItemRaw(u,l,h={}){if(l===void 0)return c.removeItem(u,h);u=Ue(u);const{relativeKey:d,driver:f}=i(u);if(f.setItemRaw)await we(f.setItemRaw,d,l,h);else if(f.setItem)await we(f.setItem,d,vd(l),h);else return;f.watch||n("update",u)},async removeItem(u,l={}){typeof l=="boolean"&&(l={removeMeta:l}),u=Ue(u);const{relativeKey:h,driver:d}=i(u);d.removeItem&&(await we(d.removeItem,h,l),(l.removeMeta||l.removeMata)&&await we(d.removeItem,h+"$",l),d.watch||n("remove",u))},async getMeta(u,l={}){typeof l=="boolean"&&(l={nativeOnly:l}),u=Ue(u);const{relativeKey:h,driver:d}=i(u),f=Object.create(null);if(d.getMeta&&Object.assign(f,await we(d.getMeta,h,l)),!l.nativeOnly){const p=await we(d.getItem,h+"$",l).then(g=>xr(g));p&&typeof p=="object"&&(typeof p.atime=="string"&&(p.atime=new Date(p.atime)),typeof p.mtime=="string"&&(p.mtime=new Date(p.mtime)),Object.assign(f,p))}return f},setMeta(u,l,h={}){return this.setItem(u+"$",l,h)},removeMeta(u,l={}){return this.removeItem(u+"$",l)},async getKeys(u,l={}){u=Or(u);const h=r(u,!0);let d=[];const f=[];let p=!0;for(const y of h){y.driver.flags?.maxDepth||(p=!1);const m=await we(y.driver.getKeys,y.relativeBase,l);for(const w of m){const b=y.mountpoint+Ue(w);d.some(E=>b.startsWith(E))||f.push(b)}d=[y.mountpoint,...d.filter(w=>!w.startsWith(y.mountpoint))]}const g=l.maxDepth!==void 0&&!p;return f.filter(y=>(!g||Sd(y,l.maxDepth))&&$d(y,u))},async clear(u,l={}){u=Or(u),await Promise.all(r(u,!1).map(async h=>{if(h.driver.clear)return we(h.driver.clear,h.relativeBase,l);if(h.driver.removeItem){const d=await h.driver.getKeys(h.relativeBase||"",l);return Promise.all(d.map(f=>h.driver.removeItem(f,l)))}}))},async dispose(){await Promise.all(Object.values(e.mounts).map(u=>jo(u)))},async watch(u){return await s(),e.watchListeners.push(u),async()=>{e.watchListeners=e.watchListeners.filter(l=>l!==u),e.watchListeners.length===0&&await o()}},async unwatch(){e.watchListeners=[],await o()},mount(u,l){if(u=Or(u),u&&e.mounts[u])throw new Error(`already mounted at ${u}`);return u&&(e.mountpoints.push(u),e.mountpoints.sort((h,d)=>d.length-h.length)),e.mounts[u]=l,e.watching&&Promise.resolve(qo(l,n,u)).then(h=>{e.unwatch[u]=h}).catch(console.error),c},async unmount(u,l=!0){u=Or(u),!(!u||!e.mounts[u])&&(e.watching&&u in e.unwatch&&(e.unwatch[u]?.(),delete e.unwatch[u]),l&&await jo(e.mounts[u]),e.mountpoints=e.mountpoints.filter(h=>h!==u),delete e.mounts[u])},getMount(u=""){u=Ue(u)+":";const l=i(u);return{driver:l.driver,base:l.base}},getMounts(u="",l={}){return u=Ue(u),r(u,l.parents).map(d=>({driver:d.driver,base:d.mountpoint}))},keys:(u,l={})=>c.getKeys(u,l),get:(u,l={})=>c.getItem(u,l),set:(u,l,h={})=>c.setItem(u,l,h),has:(u,l={})=>c.hasItem(u,l),del:(u,l={})=>c.removeItem(u,l),remove:(u,l={})=>c.removeItem(u,l)};return c}function qo(t,e,i){return t.watch?t.watch((r,n)=>e(r,i+n)):()=>{}}async function jo(t){typeof t.dispose=="function"&&await we(t.dispose)}function ai(t){return new Promise((e,i)=>{t.oncomplete=t.onsuccess=()=>e(t.result),t.onabort=t.onerror=()=>i(t.error)})}function lu(t,e){let i;const r=()=>{if(i)return i;const n=indexedDB.open(t);return n.onupgradeneeded=()=>n.result.createObjectStore(e),i=ai(n),i.then(s=>{s.onclose=()=>i=void 0},()=>{}),i};return(n,s)=>r().then(o=>s(o.transaction(e,n).objectStore(e)))}let Pn;function dr(){return Pn||(Pn=lu("keyval-store","keyval")),Pn}function zo(t,e=dr()){return e("readonly",i=>ai(i.get(t)))}function Pd(t,e,i=dr()){return i("readwrite",r=>(r.put(e,t),ai(r.transaction)))}function Cd(t,e=dr()){return e("readwrite",i=>(i.delete(t),ai(i.transaction)))}function Rd(t=dr()){return t("readwrite",e=>(e.clear(),ai(e.transaction)))}function Td(t,e){return t.openCursor().onsuccess=function(){this.result&&(e(this.result),this.result.continue())},ai(t.transaction)}function Nd(t=dr()){return t("readonly",e=>{if(e.getAllKeys)return ai(e.getAllKeys());const i=[];return Td(e,r=>i.push(r.key)).then(()=>i)})}const Fd=t=>JSON.stringify(t,(e,i)=>typeof i=="bigint"?i.toString()+"n":i),Ld=t=>{const e=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,i=t.replace(e,'$1"$2n"$3');return JSON.parse(i,(r,n)=>typeof n=="string"&&n.match(/^\d+n$/)?BigInt(n.substring(0,n.length-1)):n)};function Ii(t){if(typeof t!="string")throw new Error(`Cannot safe json parse value of type ${typeof t}`);try{return Ld(t)}catch{return t}}function ti(t){return typeof t=="string"?t:Fd(t)||""}const Bd="idb-keyval";var Ud=(t={})=>{const e=t.base&&t.base.length>0?`${t.base}:`:"",i=n=>e+n;let r;return t.dbName&&t.storeName&&(r=lu(t.dbName,t.storeName)),{name:Bd,options:t,async hasItem(n){return!(typeof await zo(i(n),r)>"u")},async getItem(n){return await zo(i(n),r)??null},setItem(n,s){return Pd(i(n),s,r)},removeItem(n){return Cd(i(n),r)},getKeys(){return Nd(r)},clear(){return Rd(r)}}};const kd="WALLET_CONNECT_V2_INDEXED_DB",Md="keyvaluestorage";let qd=class{constructor(){this.indexedDb=Ad({driver:Ud({dbName:kd,storeName:Md})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(e=>[e.key,e.value])}async getItem(e){const i=await this.indexedDb.getItem(e);if(i!==null)return i}async setItem(e,i){await this.indexedDb.setItem(e,ti(i))}async removeItem(e){await this.indexedDb.removeItem(e)}};var Cn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},qr={exports:{}};(function(){let t;function e(){}t=e,t.prototype.getItem=function(i){return this.hasOwnProperty(i)?String(this[i]):null},t.prototype.setItem=function(i,r){this[i]=String(r)},t.prototype.removeItem=function(i){delete this[i]},t.prototype.clear=function(){const i=this;Object.keys(i).forEach(function(r){i[r]=void 0,delete i[r]})},t.prototype.key=function(i){return i=i||0,Object.keys(this)[i]},t.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof Cn<"u"&&Cn.localStorage?qr.exports=Cn.localStorage:typeof window<"u"&&window.localStorage?qr.exports=window.localStorage:qr.exports=new e})();function jd(t){var e;return[t[0],Ii((e=t[1])!=null?e:"")]}let zd=class{constructor(){this.localStorage=qr.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(jd)}async getItem(e){const i=this.localStorage.getItem(e);if(i!==null)return Ii(i)}async setItem(e,i){this.localStorage.setItem(e,ti(i))}async removeItem(e){this.localStorage.removeItem(e)}};const Vd="wc_storage_version",Vo=1,Kd=async(t,e,i)=>{const r=Vd,n=await e.getItem(r);if(n&&n>=Vo){i(e);return}const s=await t.getKeys();if(!s.length){i(e);return}const o=[];for(;s.length;){const a=s.shift();if(!a)continue;const c=a.toLowerCase();if(c.includes("wc@")||c.includes("walletconnect")||c.includes("wc_")||c.includes("wallet_connect")){const u=await t.getItem(a);await e.setItem(a,u),o.push(a)}}await e.setItem(r,Vo),i(e),Hd(t,o)},Hd=async(t,e)=>{e.length&&e.forEach(async i=>{await t.removeItem(i)})};let Wd=class{constructor(){this.initialized=!1,this.setInitialized=i=>{this.storage=i,this.initialized=!0};const e=new zd;this.storage=e;try{const i=new qd;Kd(e,i,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(e){return await this.initialize(),this.storage.getItem(e)}async setItem(e,i){return await this.initialize(),this.storage.setItem(e,i)}async removeItem(e){return await this.initialize(),this.storage.removeItem(e)}async initialize(){this.initialized||await new Promise(e=>{const i=setInterval(()=>{this.initialized&&(clearInterval(i),e())},20)})}};function Gd(t){try{return JSON.stringify(t)}catch{return'"[Circular]"'}}var Yd=Jd;function Jd(t,e,i){var r=i&&i.stringify||Gd,n=1;if(typeof t=="object"&&t!==null){var s=e.length+n;if(s===1)return t;var o=new Array(s);o[0]=r(t);for(var a=1;a<s;a++)o[a]=r(e[a]);return o.join(" ")}if(typeof t!="string")return t;var c=e.length;if(c===0)return t;for(var u="",l=1-n,h=-1,d=t&&t.length||0,f=0;f<d;){if(t.charCodeAt(f)===37&&f+1<d){switch(h=h>-1?h:0,t.charCodeAt(f+1)){case 100:case 102:if(l>=c||e[l]==null)break;h<f&&(u+=t.slice(h,f)),u+=Number(e[l]),h=f+2,f++;break;case 105:if(l>=c||e[l]==null)break;h<f&&(u+=t.slice(h,f)),u+=Math.floor(Number(e[l])),h=f+2,f++;break;case 79:case 111:case 106:if(l>=c||e[l]===void 0)break;h<f&&(u+=t.slice(h,f));var p=typeof e[l];if(p==="string"){u+="'"+e[l]+"'",h=f+2,f++;break}if(p==="function"){u+=e[l].name||"<anonymous>",h=f+2,f++;break}u+=r(e[l]),h=f+2,f++;break;case 115:if(l>=c)break;h<f&&(u+=t.slice(h,f)),u+=String(e[l]),h=f+2,f++;break;case 37:h<f&&(u+=t.slice(h,f)),u+="%",h=f+2,f++,l--;break}++l}++f}return h===-1?t:(h<d&&(u+=t.slice(h)),u)}const Ko=Yd;var vi=mt;const rr=op().console||{},Zd={mapHttpRequest:Ar,mapHttpResponse:Ar,wrapRequestSerializer:Rn,wrapResponseSerializer:Rn,wrapErrorSerializer:Rn,req:Ar,res:Ar,err:ip};function Qd(t,e){return Array.isArray(t)?t.filter(function(r){return r!=="!stdSerializers.err"}):t===!0?Object.keys(e):!1}function mt(t){t=t||{},t.browser=t.browser||{};const e=t.browser.transmit;if(e&&typeof e.send!="function")throw Error("pino: transmit option must have a send function");const i=t.browser.write||rr;t.browser.write&&(t.browser.asObject=!0);const r=t.serializers||{},n=Qd(t.browser.serialize,r);let s=t.browser.serialize;Array.isArray(t.browser.serialize)&&t.browser.serialize.indexOf("!stdSerializers.err")>-1&&(s=!1);const o=["error","fatal","warn","info","debug","trace"];typeof i=="function"&&(i.error=i.fatal=i.warn=i.info=i.debug=i.trace=i),t.enabled===!1&&(t.level="silent");const a=t.level||"info",c=Object.create(i);c.log||(c.log=nr),Object.defineProperty(c,"levelVal",{get:l}),Object.defineProperty(c,"level",{get:h,set:d});const u={transmit:e,serialize:n,asObject:t.browser.asObject,levels:o,timestamp:rp(t)};c.levels=mt.levels,c.level=a,c.setMaxListeners=c.getMaxListeners=c.emit=c.addListener=c.on=c.prependListener=c.once=c.prependOnceListener=c.removeListener=c.removeAllListeners=c.listeners=c.listenerCount=c.eventNames=c.write=c.flush=nr,c.serializers=r,c._serialize=n,c._stdErrSerialize=s,c.child=f,e&&(c._logEvent=fs());function l(){return this.level==="silent"?1/0:this.levels.values[this.level]}function h(){return this._level}function d(p){if(p!=="silent"&&!this.levels.values[p])throw Error("unknown level "+p);this._level=p,di(u,c,"error","log"),di(u,c,"fatal","error"),di(u,c,"warn","error"),di(u,c,"info","log"),di(u,c,"debug","log"),di(u,c,"trace","log")}function f(p,g){if(!p)throw new Error("missing bindings for child Pino");g=g||{},n&&p.serializers&&(g.serializers=p.serializers);const y=g.serializers;if(n&&y){var m=Object.assign({},r,y),w=t.browser.serialize===!0?Object.keys(m):n;delete p.serializers,cn([p],w,m,this._stdErrSerialize)}function b(E){this._childLevel=(E._childLevel|0)+1,this.error=pi(E,p,"error"),this.fatal=pi(E,p,"fatal"),this.warn=pi(E,p,"warn"),this.info=pi(E,p,"info"),this.debug=pi(E,p,"debug"),this.trace=pi(E,p,"trace"),m&&(this.serializers=m,this._serialize=w),e&&(this._logEvent=fs([].concat(E._logEvent.bindings,p)))}return b.prototype=this,new b(this)}return c}mt.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}};mt.stdSerializers=Zd;mt.stdTimeFunctions=Object.assign({},{nullTime:hu,epochTime:du,unixTime:np,isoTime:sp});function di(t,e,i,r){const n=Object.getPrototypeOf(e);e[i]=e.levelVal>e.levels.values[i]?nr:n[i]?n[i]:rr[i]||rr[r]||nr,Xd(t,e,i)}function Xd(t,e,i){!t.transmit&&e[i]===nr||(e[i]=function(r){return function(){const s=t.timestamp(),o=new Array(arguments.length),a=Object.getPrototypeOf&&Object.getPrototypeOf(this)===rr?rr:this;for(var c=0;c<o.length;c++)o[c]=arguments[c];if(t.serialize&&!t.asObject&&cn(o,this._serialize,this.serializers,this._stdErrSerialize),t.asObject?r.call(a,ep(this,i,o,s)):r.apply(a,o),t.transmit){const u=t.transmit.level||e.level,l=mt.levels.values[u],h=mt.levels.values[i];if(h<l)return;tp(this,{ts:s,methodLevel:i,methodValue:h,transmitLevel:u,transmitValue:mt.levels.values[t.transmit.level||e.level],send:t.transmit.send,val:e.levelVal},o)}}}(e[i]))}function ep(t,e,i,r){t._serialize&&cn(i,t._serialize,t.serializers,t._stdErrSerialize);const n=i.slice();let s=n[0];const o={};r&&(o.time=r),o.level=mt.levels.values[e];let a=(t._childLevel|0)+1;if(a<1&&(a=1),s!==null&&typeof s=="object"){for(;a--&&typeof n[0]=="object";)Object.assign(o,n.shift());s=n.length?Ko(n.shift(),n):void 0}else typeof s=="string"&&(s=Ko(n.shift(),n));return s!==void 0&&(o.msg=s),o}function cn(t,e,i,r){for(const n in t)if(r&&t[n]instanceof Error)t[n]=mt.stdSerializers.err(t[n]);else if(typeof t[n]=="object"&&!Array.isArray(t[n]))for(const s in t[n])e&&e.indexOf(s)>-1&&s in i&&(t[n][s]=i[s](t[n][s]))}function pi(t,e,i){return function(){const r=new Array(1+arguments.length);r[0]=e;for(var n=1;n<r.length;n++)r[n]=arguments[n-1];return t[i].apply(this,r)}}function tp(t,e,i){const r=e.send,n=e.ts,s=e.methodLevel,o=e.methodValue,a=e.val,c=t._logEvent.bindings;cn(i,t._serialize||Object.keys(t.serializers),t.serializers,t._stdErrSerialize===void 0?!0:t._stdErrSerialize),t._logEvent.ts=n,t._logEvent.messages=i.filter(function(u){return c.indexOf(u)===-1}),t._logEvent.level.label=s,t._logEvent.level.value=o,r(s,t._logEvent,a),t._logEvent=fs(c)}function fs(t){return{ts:0,messages:[],bindings:t||[],level:{label:"",value:0}}}function ip(t){const e={type:t.constructor.name,msg:t.message,stack:t.stack};for(const i in t)e[i]===void 0&&(e[i]=t[i]);return e}function rp(t){return typeof t.timestamp=="function"?t.timestamp:t.timestamp===!1?hu:du}function Ar(){return{}}function Rn(t){return t}function nr(){}function hu(){return!1}function du(){return Date.now()}function np(){return Math.round(Date.now()/1e3)}function sp(){return new Date(Date.now()).toISOString()}function op(){function t(e){return typeof e<"u"&&e}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return t(self)||t(window)||t(this)||{}}}const un=Ot.getDefaultExportFromCjs(vi),ap={level:"info"},pr="custom_context",Gs=1e3*1024;let cp=class{constructor(e){this.nodeValue=e,this.sizeInBytes=new TextEncoder().encode(this.nodeValue).length,this.next=null}get value(){return this.nodeValue}get size(){return this.sizeInBytes}},Ho=class{constructor(e){this.head=null,this.tail=null,this.lengthInNodes=0,this.maxSizeInBytes=e,this.sizeInBytes=0}append(e){const i=new cp(e);if(i.size>this.maxSizeInBytes)throw new Error(`[LinkedList] Value too big to insert into list: ${e} with size ${i.size}`);for(;this.size+i.size>this.maxSizeInBytes;)this.shift();this.head?(this.tail&&(this.tail.next=i),this.tail=i):(this.head=i,this.tail=i),this.lengthInNodes++,this.sizeInBytes+=i.size}shift(){if(!this.head)return;const e=this.head;this.head=this.head.next,this.head||(this.tail=null),this.lengthInNodes--,this.sizeInBytes-=e.size}toArray(){const e=[];let i=this.head;for(;i!==null;)e.push(i.value),i=i.next;return e}get length(){return this.lengthInNodes}get size(){return this.sizeInBytes}toOrderedArray(){return Array.from(this)}[Symbol.iterator](){let e=this.head;return{next:()=>{if(!e)return{done:!0,value:null};const i=e.value;return e=e.next,{done:!1,value:i}}}}},pu=class{constructor(e,i=Gs){this.level=e??"error",this.levelValue=vi.levels.values[this.level],this.MAX_LOG_SIZE_IN_BYTES=i,this.logs=new Ho(this.MAX_LOG_SIZE_IN_BYTES)}forwardToConsole(e,i){i===vi.levels.values.error?console.error(e):i===vi.levels.values.warn?console.warn(e):i===vi.levels.values.debug?console.debug(e):i===vi.levels.values.trace?console.trace(e):console.log(e)}appendToLogs(e){this.logs.append(ti({timestamp:new Date().toISOString(),log:e}));const i=typeof e=="string"?JSON.parse(e).level:e.level;i>=this.levelValue&&this.forwardToConsole(e,i)}getLogs(){return this.logs}clearLogs(){this.logs=new Ho(this.MAX_LOG_SIZE_IN_BYTES)}getLogArray(){return Array.from(this.logs)}logsToBlob(e){const i=this.getLogArray();return i.push(ti({extraMetadata:e})),new Blob(i,{type:"application/json"})}},up=class{constructor(e,i=Gs){this.baseChunkLogger=new pu(e,i)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}downloadLogsBlobInBrowser(e){const i=URL.createObjectURL(this.logsToBlob(e)),r=document.createElement("a");r.href=i,r.download=`walletconnect-logs-${new Date().toISOString()}.txt`,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(i)}},lp=class{constructor(e,i=Gs){this.baseChunkLogger=new pu(e,i)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}};var hp=Object.defineProperty,dp=Object.defineProperties,pp=Object.getOwnPropertyDescriptors,Wo=Object.getOwnPropertySymbols,fp=Object.prototype.hasOwnProperty,gp=Object.prototype.propertyIsEnumerable,Go=(t,e,i)=>e in t?hp(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,Gr=(t,e)=>{for(var i in e||(e={}))fp.call(e,i)&&Go(t,i,e[i]);if(Wo)for(var i of Wo(e))gp.call(e,i)&&Go(t,i,e[i]);return t},Yr=(t,e)=>dp(t,pp(e));function Ys(t){return Yr(Gr({},t),{level:t?.level||ap.level})}function yp(t,e=pr){return t[e]||""}function wp(t,e,i=pr){return t[i]=e,t}function je(t,e=pr){let i="";return typeof t.bindings>"u"?i=yp(t,e):i=t.bindings().context||"",i}function mp(t,e,i=pr){const r=je(t,i);return r.trim()?`${r}/${e}`:e}function Fe(t,e,i=pr){const r=mp(t,e,i),n=t.child({context:r});return wp(n,r,i)}function bp(t){var e,i;const r=new up((e=t.opts)==null?void 0:e.level,t.maxSizeInBytes);return{logger:un(Yr(Gr({},t.opts),{level:"trace",browser:Yr(Gr({},(i=t.opts)==null?void 0:i.browser),{write:n=>r.write(n)})})),chunkLoggerController:r}}function vp(t){var e;const i=new lp((e=t.opts)==null?void 0:e.level,t.maxSizeInBytes);return{logger:un(Yr(Gr({},t.opts),{level:"trace"}),i),chunkLoggerController:i}}function Ep(t){return typeof t.loggerOverride<"u"&&typeof t.loggerOverride!="string"?{logger:t.loggerOverride,chunkLoggerController:null}:typeof window<"u"?bp(t):vp(t)}var _p=Object.defineProperty,Ip=(t,e,i)=>e in t?_p(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,Yo=(t,e,i)=>Ip(t,typeof e!="symbol"?e+"":e,i);let Dp=class extends oi{constructor(e){super(),this.opts=e,Yo(this,"protocol","wc"),Yo(this,"version",2)}};var Sp=Object.defineProperty,$p=(t,e,i)=>e in t?Sp(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,xp=(t,e,i)=>$p(t,typeof e!="symbol"?e+"":e,i);class Op extends oi{constructor(e,i){super(),this.core=e,this.logger=i,xp(this,"records",new Map)}}let Ap=class{constructor(e,i){this.logger=e,this.core=i}};class Pp extends oi{constructor(e,i){super(),this.relayer=e,this.logger=i}}let Cp=class extends oi{constructor(e){super()}},Rp=class{constructor(e,i,r,n){this.core=e,this.logger=i,this.name=r}},Tp=class extends oi{constructor(e,i){super(),this.relayer=e,this.logger=i}},Np=class extends oi{constructor(e,i){super(),this.core=e,this.logger=i}},Fp=class{constructor(e,i,r){this.core=e,this.logger=i,this.store=r}};class Lp{constructor(e,i){this.projectId=e,this.logger=i}}let Bp=class{constructor(e,i,r){this.core=e,this.logger=i,this.telemetryEnabled=r}};var Up=Object.defineProperty,kp=(t,e,i)=>e in t?Up(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,Jo=(t,e,i)=>kp(t,typeof e!="symbol"?e+"":e,i);let Mp=class{constructor(e){this.opts=e,Jo(this,"protocol","wc"),Jo(this,"version",2)}},qp=class{constructor(e){this.client=e}};function jp(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function fu(t,...e){if(!jp(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function Zo(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function zp(t,e){fu(t);const i=e.outputLen;if(t.length<i)throw new Error("digestInto() expects output buffer of length at least "+i)}const fi=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Tn=t=>new DataView(t.buffer,t.byteOffset,t.byteLength);function Vp(t){if(typeof t!="string")throw new Error("utf8ToBytes expected string, got "+typeof t);return new Uint8Array(new TextEncoder().encode(t))}function gu(t){return typeof t=="string"&&(t=Vp(t)),fu(t),t}let Kp=class{clone(){return this._cloneInto()}};function Hp(t){const e=r=>t().update(gu(r)).digest(),i=t();return e.outputLen=i.outputLen,e.blockLen=i.blockLen,e.create=()=>t(),e}function yu(t=32){if(fi&&typeof fi.getRandomValues=="function")return fi.getRandomValues(new Uint8Array(t));if(fi&&typeof fi.randomBytes=="function")return fi.randomBytes(t);throw new Error("crypto.getRandomValues must be defined")}function Wp(t,e,i,r){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,i,r);const n=BigInt(32),s=BigInt(4294967295),o=Number(i>>n&s),a=Number(i&s),c=r?4:0,u=r?0:4;t.setUint32(e+c,o,r),t.setUint32(e+u,a,r)}let Gp=class extends Kp{constructor(e,i,r,n){super(),this.blockLen=e,this.outputLen=i,this.padOffset=r,this.isLE=n,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Tn(this.buffer)}update(e){Zo(this);const{view:i,buffer:r,blockLen:n}=this;e=gu(e);const s=e.length;for(let o=0;o<s;){const a=Math.min(n-this.pos,s-o);if(a===n){const c=Tn(e);for(;n<=s-o;o+=n)this.process(c,o);continue}r.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===n&&(this.process(i,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Zo(this),zp(e,this),this.finished=!0;const{buffer:i,view:r,blockLen:n,isLE:s}=this;let{pos:o}=this;i[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>n-o&&(this.process(r,0),o=0);for(let h=o;h<n;h++)i[h]=0;Wp(r,n-8,BigInt(this.length*8),s),this.process(r,0);const a=Tn(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const u=c/4,l=this.get();if(u>l.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<u;h++)a.setUint32(4*h,l[h],s)}digest(){const{buffer:e,outputLen:i}=this;this.digestInto(e);const r=e.slice(0,i);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:i,buffer:r,length:n,finished:s,destroyed:o,pos:a}=this;return e.length=n,e.pos=a,e.finished=s,e.destroyed=o,n%i&&e.buffer.set(r),e}};const Pr=BigInt(2**32-1),gs=BigInt(32);function wu(t,e=!1){return e?{h:Number(t&Pr),l:Number(t>>gs&Pr)}:{h:Number(t>>gs&Pr)|0,l:Number(t&Pr)|0}}function Yp(t,e=!1){let i=new Uint32Array(t.length),r=new Uint32Array(t.length);for(let n=0;n<t.length;n++){const{h:s,l:o}=wu(t[n],e);[i[n],r[n]]=[s,o]}return[i,r]}const Jp=(t,e)=>BigInt(t>>>0)<<gs|BigInt(e>>>0),Zp=(t,e,i)=>t>>>i,Qp=(t,e,i)=>t<<32-i|e>>>i,Xp=(t,e,i)=>t>>>i|e<<32-i,ef=(t,e,i)=>t<<32-i|e>>>i,tf=(t,e,i)=>t<<64-i|e>>>i-32,rf=(t,e,i)=>t>>>i-32|e<<64-i,nf=(t,e)=>e,sf=(t,e)=>t,of=(t,e,i)=>t<<i|e>>>32-i,af=(t,e,i)=>e<<i|t>>>32-i,cf=(t,e,i)=>e<<i-32|t>>>64-i,uf=(t,e,i)=>t<<i-32|e>>>64-i;function lf(t,e,i,r){const n=(e>>>0)+(r>>>0);return{h:t+i+(n/2**32|0)|0,l:n|0}}const hf=(t,e,i)=>(t>>>0)+(e>>>0)+(i>>>0),df=(t,e,i,r)=>e+i+r+(t/2**32|0)|0,pf=(t,e,i,r)=>(t>>>0)+(e>>>0)+(i>>>0)+(r>>>0),ff=(t,e,i,r,n)=>e+i+r+n+(t/2**32|0)|0,gf=(t,e,i,r,n)=>(t>>>0)+(e>>>0)+(i>>>0)+(r>>>0)+(n>>>0),yf=(t,e,i,r,n,s)=>e+i+r+n+s+(t/2**32|0)|0,K={fromBig:wu,split:Yp,toBig:Jp,shrSH:Zp,shrSL:Qp,rotrSH:Xp,rotrSL:ef,rotrBH:tf,rotrBL:rf,rotr32H:nf,rotr32L:sf,rotlSH:of,rotlSL:af,rotlBH:cf,rotlBL:uf,add:lf,add3L:hf,add3H:df,add4L:pf,add4H:ff,add5H:yf,add5L:gf},[wf,mf]=(()=>K.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))))(),Tt=new Uint32Array(80),Nt=new Uint32Array(80);let bf=class extends Gp{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:e,Al:i,Bh:r,Bl:n,Ch:s,Cl:o,Dh:a,Dl:c,Eh:u,El:l,Fh:h,Fl:d,Gh:f,Gl:p,Hh:g,Hl:y}=this;return[e,i,r,n,s,o,a,c,u,l,h,d,f,p,g,y]}set(e,i,r,n,s,o,a,c,u,l,h,d,f,p,g,y){this.Ah=e|0,this.Al=i|0,this.Bh=r|0,this.Bl=n|0,this.Ch=s|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=u|0,this.El=l|0,this.Fh=h|0,this.Fl=d|0,this.Gh=f|0,this.Gl=p|0,this.Hh=g|0,this.Hl=y|0}process(e,i){for(let b=0;b<16;b++,i+=4)Tt[b]=e.getUint32(i),Nt[b]=e.getUint32(i+=4);for(let b=16;b<80;b++){const E=Tt[b-15]|0,x=Nt[b-15]|0,S=K.rotrSH(E,x,1)^K.rotrSH(E,x,8)^K.shrSH(E,x,7),$=K.rotrSL(E,x,1)^K.rotrSL(E,x,8)^K.shrSL(E,x,7),A=Tt[b-2]|0,I=Nt[b-2]|0,M=K.rotrSH(A,I,19)^K.rotrBH(A,I,61)^K.shrSH(A,I,6),L=K.rotrSL(A,I,19)^K.rotrBL(A,I,61)^K.shrSL(A,I,6),U=K.add4L($,L,Nt[b-7],Nt[b-16]),q=K.add4H(U,S,M,Tt[b-7],Tt[b-16]);Tt[b]=q|0,Nt[b]=U|0}let{Ah:r,Al:n,Bh:s,Bl:o,Ch:a,Cl:c,Dh:u,Dl:l,Eh:h,El:d,Fh:f,Fl:p,Gh:g,Gl:y,Hh:m,Hl:w}=this;for(let b=0;b<80;b++){const E=K.rotrSH(h,d,14)^K.rotrSH(h,d,18)^K.rotrBH(h,d,41),x=K.rotrSL(h,d,14)^K.rotrSL(h,d,18)^K.rotrBL(h,d,41),S=h&f^~h&g,$=d&p^~d&y,A=K.add5L(w,x,$,mf[b],Nt[b]),I=K.add5H(A,m,E,S,wf[b],Tt[b]),M=A|0,L=K.rotrSH(r,n,28)^K.rotrBH(r,n,34)^K.rotrBH(r,n,39),U=K.rotrSL(r,n,28)^K.rotrBL(r,n,34)^K.rotrBL(r,n,39),q=r&s^r&a^s&a,C=n&o^n&c^o&c;m=g|0,w=y|0,g=f|0,y=p|0,f=h|0,p=d|0,{h,l:d}=K.add(u|0,l|0,I|0,M|0),u=a|0,l=c|0,a=s|0,c=o|0,s=r|0,o=n|0;const _=K.add3L(M,U,C);r=K.add3H(_,I,L,q),n=_|0}({h:r,l:n}=K.add(this.Ah|0,this.Al|0,r|0,n|0)),{h:s,l:o}=K.add(this.Bh|0,this.Bl|0,s|0,o|0),{h:a,l:c}=K.add(this.Ch|0,this.Cl|0,a|0,c|0),{h:u,l}=K.add(this.Dh|0,this.Dl|0,u|0,l|0),{h,l:d}=K.add(this.Eh|0,this.El|0,h|0,d|0),{h:f,l:p}=K.add(this.Fh|0,this.Fl|0,f|0,p|0),{h:g,l:y}=K.add(this.Gh|0,this.Gl|0,g|0,y|0),{h:m,l:w}=K.add(this.Hh|0,this.Hl|0,m|0,w|0),this.set(r,n,s,o,a,c,u,l,h,d,f,p,g,y,m,w)}roundClean(){Tt.fill(0),Nt.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};const vf=Hp(()=>new bf);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Js=BigInt(0),mu=BigInt(1),Ef=BigInt(2);function Zs(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Qs(t){if(!Zs(t))throw new Error("Uint8Array expected")}function Nn(t,e){if(typeof e!="boolean")throw new Error(t+" boolean expected, got "+e)}const _f=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function Xs(t){Qs(t);let e="";for(let i=0;i<t.length;i++)e+=_f[t[i]];return e}function bu(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?Js:BigInt("0x"+t)}const Et={_0:48,_9:57,A:65,F:70,a:97,f:102};function Qo(t){if(t>=Et._0&&t<=Et._9)return t-Et._0;if(t>=Et.A&&t<=Et.F)return t-(Et.A-10);if(t>=Et.a&&t<=Et.f)return t-(Et.a-10)}function vu(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length,i=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const r=new Uint8Array(i);for(let n=0,s=0;n<i;n++,s+=2){const o=Qo(t.charCodeAt(s)),a=Qo(t.charCodeAt(s+1));if(o===void 0||a===void 0){const c=t[s]+t[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}r[n]=o*16+a}return r}function If(t){return bu(Xs(t))}function jr(t){return Qs(t),bu(Xs(Uint8Array.from(t).reverse()))}function Eu(t,e){return vu(t.toString(16).padStart(e*2,"0"))}function ys(t,e){return Eu(t,e).reverse()}function _t(t,e,i){let r;if(typeof e=="string")try{r=vu(e)}catch(s){throw new Error(t+" must be hex string or Uint8Array, cause: "+s)}else if(Zs(e))r=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const n=r.length;if(typeof i=="number"&&n!==i)throw new Error(t+" of length "+i+" expected, got "+n);return r}function Xo(...t){let e=0;for(let r=0;r<t.length;r++){const n=t[r];Qs(n),e+=n.length}const i=new Uint8Array(e);for(let r=0,n=0;r<t.length;r++){const s=t[r];i.set(s,n),n+=s.length}return i}const Fn=t=>typeof t=="bigint"&&Js<=t;function Df(t,e,i){return Fn(t)&&Fn(e)&&Fn(i)&&e<=t&&t<i}function qi(t,e,i,r){if(!Df(e,i,r))throw new Error("expected valid "+t+": "+i+" <= n < "+r+", got "+e)}function Sf(t){let e;for(e=0;t>Js;t>>=mu,e+=1);return e}const $f=t=>(Ef<<BigInt(t-1))-mu,xf={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||Zs(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function eo(t,e,i={}){const r=(n,s,o)=>{const a=xf[s];if(typeof a!="function")throw new Error("invalid validator function");const c=t[n];if(!(o&&c===void 0)&&!a(c,t))throw new Error("param "+String(n)+" is invalid. Expected "+s+", got "+c)};for(const[n,s]of Object.entries(e))r(n,s,!1);for(const[n,s]of Object.entries(i))r(n,s,!0);return t}function ea(t){const e=new WeakMap;return(i,...r)=>{const n=e.get(i);if(n!==void 0)return n;const s=t(i,...r);return e.set(i,s),s}}const ve=BigInt(0),ue=BigInt(1),Gt=BigInt(2),Of=BigInt(3),ws=BigInt(4),ta=BigInt(5),ia=BigInt(8);function fe(t,e){const i=t%e;return i>=ve?i:e+i}function Af(t,e,i){if(e<ve)throw new Error("invalid exponent, negatives unsupported");if(i<=ve)throw new Error("invalid modulus");if(i===ue)return ve;let r=ue;for(;e>ve;)e&ue&&(r=r*t%i),t=t*t%i,e>>=ue;return r}function ct(t,e,i){let r=t;for(;e-- >ve;)r*=r,r%=i;return r}function ra(t,e){if(t===ve)throw new Error("invert: expected non-zero number");if(e<=ve)throw new Error("invert: expected positive modulus, got "+e);let i=fe(t,e),r=e,n=ve,s=ue;for(;i!==ve;){const o=r/i,a=r%i,c=n-s*o;r=i,i=a,n=s,s=c}if(r!==ue)throw new Error("invert: does not exist");return fe(n,e)}function Pf(t){const e=(t-ue)/Gt;let i,r,n;for(i=t-ue,r=0;i%Gt===ve;i/=Gt,r++);for(n=Gt;n<t&&Af(n,e,t)!==t-ue;n++)if(n>1e3)throw new Error("Cannot find square root: likely non-prime P");if(r===1){const o=(t+ue)/ws;return function(a,c){const u=a.pow(c,o);if(!a.eql(a.sqr(u),c))throw new Error("Cannot find square root");return u}}const s=(i+ue)/Gt;return function(o,a){if(o.pow(a,e)===o.neg(o.ONE))throw new Error("Cannot find square root");let c=r,u=o.pow(o.mul(o.ONE,n),i),l=o.pow(a,s),h=o.pow(a,i);for(;!o.eql(h,o.ONE);){if(o.eql(h,o.ZERO))return o.ZERO;let d=1;for(let p=o.sqr(h);d<c&&!o.eql(p,o.ONE);d++)p=o.sqr(p);const f=o.pow(u,ue<<BigInt(c-d-1));u=o.sqr(f),l=o.mul(l,f),h=o.mul(h,u),c=d}return l}}function Cf(t){if(t%ws===Of){const e=(t+ue)/ws;return function(i,r){const n=i.pow(r,e);if(!i.eql(i.sqr(n),r))throw new Error("Cannot find square root");return n}}if(t%ia===ta){const e=(t-ta)/ia;return function(i,r){const n=i.mul(r,Gt),s=i.pow(n,e),o=i.mul(r,s),a=i.mul(i.mul(o,Gt),s),c=i.mul(o,i.sub(a,i.ONE));if(!i.eql(i.sqr(c),r))throw new Error("Cannot find square root");return c}}return Pf(t)}const Rf=(t,e)=>(fe(t,e)&ue)===ue,Tf=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function Nf(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},i=Tf.reduce((r,n)=>(r[n]="function",r),e);return eo(t,i)}function Ff(t,e,i){if(i<ve)throw new Error("invalid exponent, negatives unsupported");if(i===ve)return t.ONE;if(i===ue)return e;let r=t.ONE,n=e;for(;i>ve;)i&ue&&(r=t.mul(r,n)),n=t.sqr(n),i>>=ue;return r}function Lf(t,e){const i=new Array(e.length),r=e.reduce((s,o,a)=>t.is0(o)?s:(i[a]=s,t.mul(s,o)),t.ONE),n=t.inv(r);return e.reduceRight((s,o,a)=>t.is0(o)?s:(i[a]=t.mul(s,i[a]),t.mul(s,o)),n),i}function _u(t,e){const i=e!==void 0?e:t.toString(2).length,r=Math.ceil(i/8);return{nBitLength:i,nByteLength:r}}function Iu(t,e,i=!1,r={}){if(t<=ve)throw new Error("invalid field: expected ORDER > 0, got "+t);const{nBitLength:n,nByteLength:s}=_u(t,e);if(s>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:t,isLE:i,BITS:n,BYTES:s,MASK:$f(n),ZERO:ve,ONE:ue,create:c=>fe(c,t),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return ve<=c&&c<t},is0:c=>c===ve,isOdd:c=>(c&ue)===ue,neg:c=>fe(-c,t),eql:(c,u)=>c===u,sqr:c=>fe(c*c,t),add:(c,u)=>fe(c+u,t),sub:(c,u)=>fe(c-u,t),mul:(c,u)=>fe(c*u,t),pow:(c,u)=>Ff(a,c,u),div:(c,u)=>fe(c*ra(u,t),t),sqrN:c=>c*c,addN:(c,u)=>c+u,subN:(c,u)=>c-u,mulN:(c,u)=>c*u,inv:c=>ra(c,t),sqrt:r.sqrt||(c=>(o||(o=Cf(t)),o(a,c))),invertBatch:c=>Lf(a,c),cmov:(c,u,l)=>l?u:c,toBytes:c=>i?ys(c,s):Eu(c,s),fromBytes:c=>{if(c.length!==s)throw new Error("Field.fromBytes: expected "+s+" bytes, got "+c.length);return i?jr(c):If(c)}});return Object.freeze(a)}const na=BigInt(0),Cr=BigInt(1);function Ln(t,e){const i=e.negate();return t?i:e}function Du(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function Bn(t,e){Du(t,e);const i=Math.ceil(e/t)+1,r=2**(t-1);return{windows:i,windowSize:r}}function Bf(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((i,r)=>{if(!(i instanceof e))throw new Error("invalid point at index "+r)})}function Uf(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((i,r)=>{if(!e.isValid(i))throw new Error("invalid scalar at index "+r)})}const Un=new WeakMap,Su=new WeakMap;function kn(t){return Su.get(t)||1}function kf(t,e){return{constTimeNegate:Ln,hasPrecomputes(i){return kn(i)!==1},unsafeLadder(i,r,n=t.ZERO){let s=i;for(;r>na;)r&Cr&&(n=n.add(s)),s=s.double(),r>>=Cr;return n},precomputeWindow(i,r){const{windows:n,windowSize:s}=Bn(r,e),o=[];let a=i,c=a;for(let u=0;u<n;u++){c=a,o.push(c);for(let l=1;l<s;l++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(i,r,n){const{windows:s,windowSize:o}=Bn(i,e);let a=t.ZERO,c=t.BASE;const u=BigInt(2**i-1),l=2**i,h=BigInt(i);for(let d=0;d<s;d++){const f=d*o;let p=Number(n&u);n>>=h,p>o&&(p-=l,n+=Cr);const g=f,y=f+Math.abs(p)-1,m=d%2!==0,w=p<0;p===0?c=c.add(Ln(m,r[g])):a=a.add(Ln(w,r[y]))}return{p:a,f:c}},wNAFUnsafe(i,r,n,s=t.ZERO){const{windows:o,windowSize:a}=Bn(i,e),c=BigInt(2**i-1),u=2**i,l=BigInt(i);for(let h=0;h<o;h++){const d=h*a;if(n===na)break;let f=Number(n&c);if(n>>=l,f>a&&(f-=u,n+=Cr),f===0)continue;let p=r[d+Math.abs(f)-1];f<0&&(p=p.negate()),s=s.add(p)}return s},getPrecomputes(i,r,n){let s=Un.get(r);return s||(s=this.precomputeWindow(r,i),i!==1&&Un.set(r,n(s))),s},wNAFCached(i,r,n){const s=kn(i);return this.wNAF(s,this.getPrecomputes(s,i,n),r)},wNAFCachedUnsafe(i,r,n,s){const o=kn(i);return o===1?this.unsafeLadder(i,r,s):this.wNAFUnsafe(o,this.getPrecomputes(o,i,n),r,s)},setWindowSize(i,r){Du(r,e),Su.set(i,r),Un.delete(i)}}}function Mf(t,e,i,r){if(Bf(i,t),Uf(r,e),i.length!==r.length)throw new Error("arrays of points and scalars must have equal length");const n=t.ZERO,s=Sf(BigInt(i.length)),o=s>12?s-3:s>4?s-2:s?2:1,a=(1<<o)-1,c=new Array(a+1).fill(n),u=Math.floor((e.BITS-1)/o)*o;let l=n;for(let h=u;h>=0;h-=o){c.fill(n);for(let f=0;f<r.length;f++){const p=r[f],g=Number(p>>BigInt(h)&BigInt(a));c[g]=c[g].add(i[f])}let d=n;for(let f=c.length-1,p=n;f>0;f--)p=p.add(c[f]),d=d.add(p);if(l=l.add(d),h!==0)for(let f=0;f<o;f++)l=l.double()}return l}function qf(t){return Nf(t.Fp),eo(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({..._u(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}const et=BigInt(0),Le=BigInt(1),Rr=BigInt(2),jf=BigInt(8),zf={zip215:!0};function Vf(t){const e=qf(t);return eo(t,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...e})}function Kf(t){const e=Vf(t),{Fp:i,n:r,prehash:n,hash:s,randomBytes:o,nByteLength:a,h:c}=e,u=Rr<<BigInt(a*8)-Le,l=i.create,h=Iu(e.n,e.nBitLength),d=e.uvRatio||((_,v)=>{try{return{isValid:!0,value:i.sqrt(_*i.inv(v))}}catch{return{isValid:!1,value:et}}}),f=e.adjustScalarBytes||(_=>_),p=e.domain||((_,v,O)=>{if(Nn("phflag",O),v.length||O)throw new Error("Contexts/pre-hash are not supported");return _});function g(_,v){qi("coordinate "+_,v,et,u)}function y(_){if(!(_ instanceof b))throw new Error("ExtendedPoint expected")}const m=ea((_,v)=>{const{ex:O,ey:P,ez:D}=_,N=_.is0();v==null&&(v=N?jf:i.inv(D));const B=l(O*v),k=l(P*v),j=l(D*v);if(N)return{x:et,y:Le};if(j!==Le)throw new Error("invZ was invalid");return{x:B,y:k}}),w=ea(_=>{const{a:v,d:O}=e;if(_.is0())throw new Error("bad point: ZERO");const{ex:P,ey:D,ez:N,et:B}=_,k=l(P*P),j=l(D*D),z=l(N*N),H=l(z*z),Y=l(k*v),se=l(z*l(Y+j)),ee=l(H+l(O*l(k*j)));if(se!==ee)throw new Error("bad point: equation left != right (1)");const J=l(P*D),Pe=l(N*B);if(J!==Pe)throw new Error("bad point: equation left != right (2)");return!0});class b{constructor(v,O,P,D){this.ex=v,this.ey=O,this.ez=P,this.et=D,g("x",v),g("y",O),g("z",P),g("t",D),Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(v){if(v instanceof b)throw new Error("extended point not allowed");const{x:O,y:P}=v||{};return g("x",O),g("y",P),new b(O,P,Le,l(O*P))}static normalizeZ(v){const O=i.invertBatch(v.map(P=>P.ez));return v.map((P,D)=>P.toAffine(O[D])).map(b.fromAffine)}static msm(v,O){return Mf(b,h,v,O)}_setWindowSize(v){S.setWindowSize(this,v)}assertValidity(){w(this)}equals(v){y(v);const{ex:O,ey:P,ez:D}=this,{ex:N,ey:B,ez:k}=v,j=l(O*k),z=l(N*D),H=l(P*k),Y=l(B*D);return j===z&&H===Y}is0(){return this.equals(b.ZERO)}negate(){return new b(l(-this.ex),this.ey,this.ez,l(-this.et))}double(){const{a:v}=e,{ex:O,ey:P,ez:D}=this,N=l(O*O),B=l(P*P),k=l(Rr*l(D*D)),j=l(v*N),z=O+P,H=l(l(z*z)-N-B),Y=j+B,se=Y-k,ee=j-B,J=l(H*se),Pe=l(Y*ee),_e=l(H*ee),Re=l(se*Y);return new b(J,Pe,Re,_e)}add(v){y(v);const{a:O,d:P}=e,{ex:D,ey:N,ez:B,et:k}=this,{ex:j,ey:z,ez:H,et:Y}=v;if(O===BigInt(-1)){const _o=l((N-D)*(z+j)),Io=l((N+D)*(z-j)),Sn=l(Io-_o);if(Sn===et)return this.double();const Do=l(B*Rr*Y),So=l(k*Rr*H),$o=So+Do,xo=Io+_o,Oo=So-Do,Dh=l($o*Sn),Sh=l(xo*Oo),$h=l($o*Oo),xh=l(Sn*xo);return new b(Dh,Sh,xh,$h)}const se=l(D*j),ee=l(N*z),J=l(k*P*Y),Pe=l(B*H),_e=l((D+N)*(j+z)-se-ee),Re=Pe-J,Ye=Pe+J,vt=l(ee-O*se),li=l(_e*Re),Eh=l(Ye*vt),_h=l(_e*vt),Ih=l(Re*Ye);return new b(li,Eh,Ih,_h)}subtract(v){return this.add(v.negate())}wNAF(v){return S.wNAFCached(this,v,b.normalizeZ)}multiply(v){const O=v;qi("scalar",O,Le,r);const{p:P,f:D}=this.wNAF(O);return b.normalizeZ([P,D])[0]}multiplyUnsafe(v,O=b.ZERO){const P=v;return qi("scalar",P,et,r),P===et?x:this.is0()||P===Le?this:S.wNAFCachedUnsafe(this,P,b.normalizeZ,O)}isSmallOrder(){return this.multiplyUnsafe(c).is0()}isTorsionFree(){return S.unsafeLadder(this,r).is0()}toAffine(v){return m(this,v)}clearCofactor(){const{h:v}=e;return v===Le?this:this.multiplyUnsafe(v)}static fromHex(v,O=!1){const{d:P,a:D}=e,N=i.BYTES;v=_t("pointHex",v,N),Nn("zip215",O);const B=v.slice(),k=v[N-1];B[N-1]=k&-129;const j=jr(B),z=O?u:i.ORDER;qi("pointHex.y",j,et,z);const H=l(j*j),Y=l(H-Le),se=l(P*H-D);let{isValid:ee,value:J}=d(Y,se);if(!ee)throw new Error("Point.fromHex: invalid y coordinate");const Pe=(J&Le)===Le,_e=(k&128)!==0;if(!O&&J===et&&_e)throw new Error("Point.fromHex: x=0 and x_0=1");return _e!==Pe&&(J=l(-J)),b.fromAffine({x:J,y:j})}static fromPrivateKey(v){return I(v).point}toRawBytes(){const{x:v,y:O}=this.toAffine(),P=ys(O,i.BYTES);return P[P.length-1]|=v&Le?128:0,P}toHex(){return Xs(this.toRawBytes())}}b.BASE=new b(e.Gx,e.Gy,Le,l(e.Gx*e.Gy)),b.ZERO=new b(et,Le,Le,et);const{BASE:E,ZERO:x}=b,S=kf(b,a*8);function $(_){return fe(_,r)}function A(_){return $(jr(_))}function I(_){const v=i.BYTES;_=_t("private key",_,v);const O=_t("hashed private key",s(_),2*v),P=f(O.slice(0,v)),D=O.slice(v,2*v),N=A(P),B=E.multiply(N),k=B.toRawBytes();return{head:P,prefix:D,scalar:N,point:B,pointBytes:k}}function M(_){return I(_).pointBytes}function L(_=new Uint8Array,...v){const O=Xo(...v);return A(s(p(O,_t("context",_),!!n)))}function U(_,v,O={}){_=_t("message",_),n&&(_=n(_));const{prefix:P,scalar:D,pointBytes:N}=I(v),B=L(O.context,P,_),k=E.multiply(B).toRawBytes(),j=L(O.context,k,N,_),z=$(B+j*D);qi("signature.s",z,et,r);const H=Xo(k,ys(z,i.BYTES));return _t("result",H,i.BYTES*2)}const q=zf;function C(_,v,O,P=q){const{context:D,zip215:N}=P,B=i.BYTES;_=_t("signature",_,2*B),v=_t("message",v),O=_t("publicKey",O,B),N!==void 0&&Nn("zip215",N),n&&(v=n(v));const k=jr(_.slice(B,2*B));let j,z,H;try{j=b.fromHex(O,N),z=b.fromHex(_.slice(0,B),N),H=E.multiplyUnsafe(k)}catch{return!1}if(!N&&j.isSmallOrder())return!1;const Y=L(D,z.toRawBytes(),j.toRawBytes(),v);return z.add(j.multiplyUnsafe(Y)).subtract(H).clearCofactor().equals(b.ZERO)}return E._setWindowSize(8),{CURVE:e,getPublicKey:M,sign:U,verify:C,ExtendedPoint:b,utils:{getExtendedPublicKey:I,randomPrivateKey:()=>o(i.BYTES),precompute(_=8,v=b.BASE){return v._setWindowSize(_),v.multiply(BigInt(3)),v}}}}BigInt(0),BigInt(1);const to=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),sa=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt(0);const Hf=BigInt(1),oa=BigInt(2);BigInt(3);const Wf=BigInt(5),Gf=BigInt(8);function Yf(t){const e=BigInt(10),i=BigInt(20),r=BigInt(40),n=BigInt(80),s=to,o=t*t%s*t%s,a=ct(o,oa,s)*o%s,c=ct(a,Hf,s)*t%s,u=ct(c,Wf,s)*c%s,l=ct(u,e,s)*u%s,h=ct(l,i,s)*l%s,d=ct(h,r,s)*h%s,f=ct(d,n,s)*d%s,p=ct(f,n,s)*d%s,g=ct(p,e,s)*u%s;return{pow_p_5_8:ct(g,oa,s)*t%s,b2:o}}function Jf(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}function Zf(t,e){const i=to,r=fe(e*e*e,i),n=fe(r*r*e,i),s=Yf(t*n).pow_p_5_8;let o=fe(t*r*s,i);const a=fe(e*o*o,i),c=o,u=fe(o*sa,i),l=a===t,h=a===fe(-t,i),d=a===fe(-t*sa,i);return l&&(o=c),(h||d)&&(o=u),Rf(o,i)&&(o=fe(-o,i)),{isValid:l||h,value:o}}const Qf=(()=>Iu(to,void 0,!0))(),Xf=(()=>({a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:Qf,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:Gf,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:vf,randomBytes:yu,adjustScalarBytes:Jf,uvRatio:Zf}))(),$u=(()=>Kf(Xf))(),eg="EdDSA",tg="JWT",Jr=".",ln="base64url",xu="utf8",Ou="utf8",ig=":",rg="did",ng="key",aa="base58btc",sg="z",og="K36",ag=32;function io(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function Au(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?io(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function Pu(t,e){e||(e=t.reduce((n,s)=>n+s.length,0));const i=Au(e);let r=0;for(const n of t)i.set(n,r),r+=n.length;return io(i)}function cg(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var i=new Uint8Array(256),r=0;r<i.length;r++)i[r]=255;for(var n=0;n<t.length;n++){var s=t.charAt(n),o=s.charCodeAt(0);if(i[o]!==255)throw new TypeError(s+" is ambiguous");i[o]=n}var a=t.length,c=t.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(p){if(p instanceof Uint8Array||(ArrayBuffer.isView(p)?p=new Uint8Array(p.buffer,p.byteOffset,p.byteLength):Array.isArray(p)&&(p=Uint8Array.from(p))),!(p instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(p.length===0)return"";for(var g=0,y=0,m=0,w=p.length;m!==w&&p[m]===0;)m++,g++;for(var b=(w-m)*l+1>>>0,E=new Uint8Array(b);m!==w;){for(var x=p[m],S=0,$=b-1;(x!==0||S<y)&&$!==-1;$--,S++)x+=256*E[$]>>>0,E[$]=x%a>>>0,x=x/a>>>0;if(x!==0)throw new Error("Non-zero carry");y=S,m++}for(var A=b-y;A!==b&&E[A]===0;)A++;for(var I=c.repeat(g);A<b;++A)I+=t.charAt(E[A]);return I}function d(p){if(typeof p!="string")throw new TypeError("Expected String");if(p.length===0)return new Uint8Array;var g=0;if(p[g]!==" "){for(var y=0,m=0;p[g]===c;)y++,g++;for(var w=(p.length-g)*u+1>>>0,b=new Uint8Array(w);p[g];){var E=i[p.charCodeAt(g)];if(E===255)return;for(var x=0,S=w-1;(E!==0||x<m)&&S!==-1;S--,x++)E+=a*b[S]>>>0,b[S]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");m=x,g++}if(p[g]!==" "){for(var $=w-m;$!==w&&b[$]===0;)$++;for(var A=new Uint8Array(y+(w-$)),I=y;$!==w;)A[I++]=b[$++];return A}}}function f(p){var g=d(p);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:d,decode:f}}var ug=cg,lg=ug;const Cu=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},hg=t=>new TextEncoder().encode(t),dg=t=>new TextDecoder().decode(t);let pg=class{constructor(e,i,r){this.name=e,this.prefix=i,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},fg=class{constructor(e,i,r){if(this.name=e,this.prefix=i,i.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i.codePointAt(0),this.baseDecode=r}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Ru(this,e)}},gg=class{constructor(e){this.decoders=e}or(e){return Ru(this,e)}decode(e){const i=e[0],r=this.decoders[i];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const Ru=(t,e)=>new gg({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});let yg=class{constructor(e,i,r,n){this.name=e,this.prefix=i,this.baseEncode=r,this.baseDecode=n,this.encoder=new pg(e,i,r),this.decoder=new fg(e,i,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const hn=({name:t,prefix:e,encode:i,decode:r})=>new yg(t,e,i,r),fr=({prefix:t,name:e,alphabet:i})=>{const{encode:r,decode:n}=lg(i,e);return hn({prefix:t,name:e,encode:r,decode:s=>Cu(n(s))})},wg=(t,e,i,r)=>{const n={};for(let l=0;l<e.length;++l)n[e[l]]=l;let s=t.length;for(;t[s-1]==="=";)--s;const o=new Uint8Array(s*i/8|0);let a=0,c=0,u=0;for(let l=0;l<s;++l){const h=n[t[l]];if(h===void 0)throw new SyntaxError(`Non-${r} character`);c=c<<i|h,a+=i,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=i||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},mg=(t,e,i)=>{const r=e[e.length-1]==="=",n=(1<<i)-1;let s="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>i;)o-=i,s+=e[n&a>>o];if(o&&(s+=e[n&a<<i-o]),r)for(;s.length*i&7;)s+="=";return s},xe=({name:t,prefix:e,bitsPerChar:i,alphabet:r})=>hn({prefix:e,name:t,encode(n){return mg(n,r,i)},decode(n){return wg(n,r,i,t)}}),bg=hn({prefix:"\0",name:"identity",encode:t=>dg(t),decode:t=>hg(t)});var vg=Object.freeze({__proto__:null,identity:bg});const Eg=xe({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var _g=Object.freeze({__proto__:null,base2:Eg});const Ig=xe({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var Dg=Object.freeze({__proto__:null,base8:Ig});const Sg=fr({prefix:"9",name:"base10",alphabet:"0123456789"});var $g=Object.freeze({__proto__:null,base10:Sg});const xg=xe({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Og=xe({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var Ag=Object.freeze({__proto__:null,base16:xg,base16upper:Og});const Pg=xe({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Cg=xe({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Rg=xe({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Tg=xe({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Ng=xe({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Fg=xe({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Lg=xe({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Bg=xe({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Ug=xe({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var kg=Object.freeze({__proto__:null,base32:Pg,base32upper:Cg,base32pad:Rg,base32padupper:Tg,base32hex:Ng,base32hexupper:Fg,base32hexpad:Lg,base32hexpadupper:Bg,base32z:Ug});const Mg=fr({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),qg=fr({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var jg=Object.freeze({__proto__:null,base36:Mg,base36upper:qg});const zg=fr({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Vg=fr({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Kg=Object.freeze({__proto__:null,base58btc:zg,base58flickr:Vg});const Hg=xe({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Wg=xe({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Gg=xe({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Yg=xe({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var Jg=Object.freeze({__proto__:null,base64:Hg,base64pad:Wg,base64url:Gg,base64urlpad:Yg});const Tu=Array.from(""),Zg=Tu.reduce((t,e,i)=>(t[i]=e,t),[]),Qg=Tu.reduce((t,e,i)=>(t[e.codePointAt(0)]=i,t),[]);function Xg(t){return t.reduce((e,i)=>(e+=Zg[i],e),"")}function ey(t){const e=[];for(const i of t){const r=Qg[i.codePointAt(0)];if(r===void 0)throw new Error(`Non-base256emoji character: ${i}`);e.push(r)}return new Uint8Array(e)}const ty=hn({prefix:"",name:"base256emoji",encode:Xg,decode:ey});var iy=Object.freeze({__proto__:null,base256emoji:ty}),ry=Nu,ca=128,ny=127,sy=~ny,oy=Math.pow(2,31);function Nu(t,e,i){e=e||[],i=i||0;for(var r=i;t>=oy;)e[i++]=t&255|ca,t/=128;for(;t&sy;)e[i++]=t&255|ca,t>>>=7;return e[i]=t|0,Nu.bytes=i-r+1,e}var ay=ms,cy=128,ua=127;function ms(t,r){var i=0,r=r||0,n=0,s=r,o,a=t.length;do{if(s>=a)throw ms.bytes=0,new RangeError("Could not decode varint");o=t[s++],i+=n<28?(o&ua)<<n:(o&ua)*Math.pow(2,n),n+=7}while(o>=cy);return ms.bytes=s-r,i}var uy=Math.pow(2,7),ly=Math.pow(2,14),hy=Math.pow(2,21),dy=Math.pow(2,28),py=Math.pow(2,35),fy=Math.pow(2,42),gy=Math.pow(2,49),yy=Math.pow(2,56),wy=Math.pow(2,63),my=function(t){return t<uy?1:t<ly?2:t<hy?3:t<dy?4:t<py?5:t<fy?6:t<gy?7:t<yy?8:t<wy?9:10},by={encode:ry,decode:ay,encodingLength:my},Fu=by;const la=(t,e,i=0)=>(Fu.encode(t,e,i),e),ha=t=>Fu.encodingLength(t),bs=(t,e)=>{const i=e.byteLength,r=ha(t),n=r+ha(i),s=new Uint8Array(n+i);return la(t,s,0),la(i,s,r),s.set(e,n),new vy(t,i,e,s)};let vy=class{constructor(e,i,r,n){this.code=e,this.size=i,this.digest=r,this.bytes=n}};const Lu=({name:t,code:e,encode:i})=>new Ey(t,e,i);let Ey=class{constructor(e,i,r){this.name=e,this.code=i,this.encode=r}digest(e){if(e instanceof Uint8Array){const i=this.encode(e);return i instanceof Uint8Array?bs(this.code,i):i.then(r=>bs(this.code,r))}else throw Error("Unknown type, must be binary type")}};const Bu=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),_y=Lu({name:"sha2-256",code:18,encode:Bu("SHA-256")}),Iy=Lu({name:"sha2-512",code:19,encode:Bu("SHA-512")});var Dy=Object.freeze({__proto__:null,sha256:_y,sha512:Iy});const Uu=0,Sy="identity",ku=Cu,$y=t=>bs(Uu,ku(t)),xy={code:Uu,name:Sy,encode:ku,digest:$y};var Oy=Object.freeze({__proto__:null,identity:xy});new TextEncoder,new TextDecoder;const da={...vg,..._g,...Dg,...$g,...Ag,...kg,...jg,...Kg,...Jg,...iy};({...Dy,...Oy});function Mu(t,e,i,r){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:i},decoder:{decode:r}}}const pa=Mu("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),Mn=Mu("ascii","a",t=>{let e="a";for(let i=0;i<t.length;i++)e+=String.fromCharCode(t[i]);return e},t=>{t=t.substring(1);const e=Au(t.length);for(let i=0;i<t.length;i++)e[i]=t.charCodeAt(i);return e}),qu={utf8:pa,"utf-8":pa,hex:da.base16,latin1:Mn,ascii:Mn,binary:Mn,...da};function dn(t,e="utf8"){const i=qu[e];if(!i)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):i.encoder.encode(t).substring(1)}function Ri(t,e="utf8"){const i=qu[e];if(!i)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?io(globalThis.Buffer.from(t,"utf-8")):i.decoder.decode(`${i.prefix}${t}`)}function fa(t){return Ii(dn(Ri(t,ln),xu))}function Zr(t){return dn(Ri(ti(t),xu),ln)}function ju(t){const e=Ri(og,aa),i=sg+dn(Pu([e,t]),aa);return[rg,ng,i].join(ig)}function Ay(t){return dn(t,ln)}function Py(t){return Ri(t,ln)}function Cy(t){return Ri([Zr(t.header),Zr(t.payload)].join(Jr),Ou)}function Ry(t){return[Zr(t.header),Zr(t.payload),Ay(t.signature)].join(Jr)}function vs(t){const e=t.split(Jr),i=fa(e[0]),r=fa(e[1]),n=Py(e[2]),s=Ri(e.slice(0,2).join(Jr),Ou);return{header:i,payload:r,signature:n,data:s}}function ga(t=yu(ag)){const e=$u.getPublicKey(t);return{secretKey:Pu([t,e]),publicKey:e}}async function Ty(t,e,i,r,n=T.fromMiliseconds(Date.now())){const s={alg:eg,typ:tg},o=ju(r.publicKey),a=n+i,c={iss:o,sub:t,aud:e,iat:n,exp:a},u=Cy({header:s,payload:c}),l=$u.sign(u,r.secretKey.slice(0,32));return Ry({header:s,payload:c,signature:l})}var ae={};Object.defineProperty(ae,"__esModule",{value:!0});ae.getLocalStorage=ae.getLocalStorageOrThrow=ae.getCrypto=ae.getCryptoOrThrow=zu=ae.getLocation=ae.getLocationOrThrow=ro=ae.getNavigator=ae.getNavigatorOrThrow=gr=ae.getDocument=ae.getDocumentOrThrow=ae.getFromWindowOrThrow=ae.getFromWindow=void 0;function ci(t){let e;return typeof window<"u"&&typeof window[t]<"u"&&(e=window[t]),e}ae.getFromWindow=ci;function Ti(t){const e=ci(t);if(!e)throw new Error(`${t} is not defined in Window`);return e}ae.getFromWindowOrThrow=Ti;function Ny(){return Ti("document")}ae.getDocumentOrThrow=Ny;function Fy(){return ci("document")}var gr=ae.getDocument=Fy;function Ly(){return Ti("navigator")}ae.getNavigatorOrThrow=Ly;function By(){return ci("navigator")}var ro=ae.getNavigator=By;function Uy(){return Ti("location")}ae.getLocationOrThrow=Uy;function ky(){return ci("location")}var zu=ae.getLocation=ky;function My(){return Ti("crypto")}ae.getCryptoOrThrow=My;function qy(){return ci("crypto")}ae.getCrypto=qy;function jy(){return Ti("localStorage")}ae.getLocalStorageOrThrow=jy;function zy(){return ci("localStorage")}ae.getLocalStorage=zy;var no={};Object.defineProperty(no,"__esModule",{value:!0});var Vu=no.getWindowMetadata=void 0;const ya=ae;function Vy(){let t,e;try{t=ya.getDocumentOrThrow(),e=ya.getLocationOrThrow()}catch{return null}function i(){const h=t.getElementsByTagName("link"),d=[];for(let f=0;f<h.length;f++){const p=h[f],g=p.getAttribute("rel");if(g&&g.toLowerCase().indexOf("icon")>-1){const y=p.getAttribute("href");if(y)if(y.toLowerCase().indexOf("https:")===-1&&y.toLowerCase().indexOf("http:")===-1&&y.indexOf("//")!==0){let m=e.protocol+"//"+e.host;if(y.indexOf("/")===0)m+=y;else{const w=e.pathname.split("/");w.pop();const b=w.join("/");m+=b+"/"+y}d.push(m)}else if(y.indexOf("//")===0){const m=e.protocol+y;d.push(m)}else d.push(y)}}return d}function r(...h){const d=t.getElementsByTagName("meta");for(let f=0;f<d.length;f++){const p=d[f],g=["itemprop","property","name"].map(y=>p.getAttribute(y)).filter(y=>y?h.includes(y):!1);if(g.length&&g){const y=p.getAttribute("content");if(y)return y}}return""}function n(){let h=r("name","og:site_name","og:title","twitter:title");return h||(h=t.title),h}function s(){return r("description","og:description","twitter:description","keywords")}const o=n(),a=s(),c=e.origin,u=i();return{description:a,url:c,icons:u,name:o}}Vu=no.getWindowMetadata=Vy;function sr(t,{strict:e=!0}={}){return!t||typeof t!="string"?!1:e?/^0x[0-9a-fA-F]*$/.test(t):t.startsWith("0x")}function wa(t){return sr(t,{strict:!1})?Math.ceil((t.length-2)/2):t.length}const Ku="2.23.2";let qn={getDocsUrl:({docsBaseUrl:t,docsPath:e="",docsSlug:i})=>e?`${t??"https://viem.sh"}${e}${i?`#${i}`:""}`:void 0,version:`viem@${Ku}`};class ii extends Error{constructor(e,i={}){const r=(()=>i.cause instanceof ii?i.cause.details:i.cause?.message?i.cause.message:i.details)(),n=(()=>i.cause instanceof ii&&i.cause.docsPath||i.docsPath)(),s=qn.getDocsUrl?.({...i,docsPath:n}),o=[e||"An error occurred.","",...i.metaMessages?[...i.metaMessages,""]:[],...s?[`Docs: ${s}`]:[],...r?[`Details: ${r}`]:[],...qn.version?[`Version: ${qn.version}`]:[]].join(`
`);super(o,i.cause?{cause:i.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metaMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),this.details=r,this.docsPath=n,this.metaMessages=i.metaMessages,this.name=i.name??this.name,this.shortMessage=e,this.version=Ku}walk(e){return Hu(this,e)}}function Hu(t,e){return e?.(t)?t:t&&typeof t=="object"&&"cause"in t&&t.cause!==void 0?Hu(t.cause,e):e?null:t}class Wu extends ii{constructor({size:e,targetSize:i,type:r}){super(`${r.charAt(0).toUpperCase()}${r.slice(1).toLowerCase()} size (${e}) exceeds padding size (${i}).`,{name:"SizeExceedsPaddingSizeError"})}}function Ni(t,{dir:e,size:i=32}={}){return typeof t=="string"?Ky(t,{dir:e,size:i}):Hy(t,{dir:e,size:i})}function Ky(t,{dir:e,size:i=32}={}){if(i===null)return t;const r=t.replace("0x","");if(r.length>i*2)throw new Wu({size:Math.ceil(r.length/2),targetSize:i,type:"hex"});return`0x${r[e==="right"?"padEnd":"padStart"](i*2,"0")}`}function Hy(t,{dir:e,size:i=32}={}){if(i===null)return t;if(t.length>i)throw new Wu({size:t.length,targetSize:i,type:"bytes"});const r=new Uint8Array(i);for(let n=0;n<i;n++){const s=e==="right";r[s?n:i-n-1]=t[s?n:t.length-n-1]}return r}class Wy extends ii{constructor({max:e,min:i,signed:r,size:n,value:s}){super(`Number "${s}" is not in safe ${n?`${n*8}-bit ${r?"signed":"unsigned"} `:""}integer range ${e?`(${i} to ${e})`:`(above ${i})`}`,{name:"IntegerOutOfRangeError"})}}class Gy extends ii{constructor({givenSize:e,maxSize:i}){super(`Size cannot exceed ${i} bytes. Given size: ${e} bytes.`,{name:"SizeOverflowError"})}}function Fi(t,{size:e}){if(wa(t)>e)throw new Gy({givenSize:wa(t),maxSize:e})}function Es(t,e={}){const{signed:i}=e;e.size&&Fi(t,{size:e.size});const r=BigInt(t);if(!i)return r;const n=(t.length-2)/2,s=(1n<<BigInt(n)*8n-1n)-1n;return r<=s?r:r-BigInt(`0x${"f".padStart(n*2,"f")}`)-1n}function Yy(t,e={}){return Number(Es(t,e))}const Jy=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function _s(t,e={}){return typeof t=="number"||typeof t=="bigint"?Yu(t,e):typeof t=="string"?Xy(t,e):typeof t=="boolean"?Zy(t,e):Gu(t,e)}function Zy(t,e={}){const i=`0x${Number(t)}`;return typeof e.size=="number"?(Fi(i,{size:e.size}),Ni(i,{size:e.size})):i}function Gu(t,e={}){let i="";for(let n=0;n<t.length;n++)i+=Jy[t[n]];const r=`0x${i}`;return typeof e.size=="number"?(Fi(r,{size:e.size}),Ni(r,{dir:"right",size:e.size})):r}function Yu(t,e={}){const{signed:i,size:r}=e,n=BigInt(t);let s;r?i?s=(1n<<BigInt(r)*8n-1n)-1n:s=2n**(BigInt(r)*8n)-1n:typeof t=="number"&&(s=BigInt(Number.MAX_SAFE_INTEGER));const o=typeof s=="bigint"&&i?-s-1n:0;if(s&&n>s||n<o){const c=typeof t=="bigint"?"n":"";throw new Wy({max:s?`${s}${c}`:void 0,min:`${o}${c}`,signed:i,size:r,value:`${t}${c}`})}const a=`0x${(i&&n<0?(1n<<BigInt(r*8))+BigInt(n):n).toString(16)}`;return r?Ni(a,{size:r}):a}const Qy=new TextEncoder;function Xy(t,e={}){const i=Qy.encode(t);return Gu(i,e)}const ew=new TextEncoder;function tw(t,e={}){return typeof t=="number"||typeof t=="bigint"?rw(t,e):typeof t=="boolean"?iw(t,e):sr(t)?Ju(t,e):Zu(t,e)}function iw(t,e={}){const i=new Uint8Array(1);return i[0]=Number(t),typeof e.size=="number"?(Fi(i,{size:e.size}),Ni(i,{size:e.size})):i}const It={zero:48,nine:57,A:65,F:70,a:97,f:102};function ma(t){if(t>=It.zero&&t<=It.nine)return t-It.zero;if(t>=It.A&&t<=It.F)return t-(It.A-10);if(t>=It.a&&t<=It.f)return t-(It.a-10)}function Ju(t,e={}){let i=t;e.size&&(Fi(i,{size:e.size}),i=Ni(i,{dir:"right",size:e.size}));let r=i.slice(2);r.length%2&&(r=`0${r}`);const n=r.length/2,s=new Uint8Array(n);for(let o=0,a=0;o<n;o++){const c=ma(r.charCodeAt(a++)),u=ma(r.charCodeAt(a++));if(c===void 0||u===void 0)throw new ii(`Invalid byte sequence ("${r[a-2]}${r[a-1]}" in "${r}").`);s[o]=c*16+u}return s}function rw(t,e){const i=Yu(t,e);return Ju(i)}function Zu(t,e={}){const i=ew.encode(t);return typeof e.size=="number"?(Fi(i,{size:e.size}),Ni(i,{dir:"right",size:e.size})):i}function Qr(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function nw(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function yr(t,...e){if(!nw(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function sw(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Qr(t.outputLen),Qr(t.blockLen)}function Is(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function Qu(t,e){yr(t);const i=e.outputLen;if(t.length<i)throw new Error("digestInto() expects output buffer of length at least "+i)}const Tr=BigInt(2**32-1),ba=BigInt(32);function ow(t,e=!1){return e?{h:Number(t&Tr),l:Number(t>>ba&Tr)}:{h:Number(t>>ba&Tr)|0,l:Number(t&Tr)|0}}function aw(t,e=!1){let i=new Uint32Array(t.length),r=new Uint32Array(t.length);for(let n=0;n<t.length;n++){const{h:s,l:o}=ow(t[n],e);[i[n],r[n]]=[s,o]}return[i,r]}const cw=(t,e,i)=>t<<i|e>>>32-i,uw=(t,e,i)=>e<<i|t>>>32-i,lw=(t,e,i)=>e<<i-32|t>>>64-i,hw=(t,e,i)=>t<<i-32|e>>>64-i,gi=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function dw(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function pw(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function fw(t,e){return t<<32-e|t>>>e}const va=(()=>new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68)();function gw(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}function Ea(t){for(let e=0;e<t.length;e++)t[e]=gw(t[e])}function yw(t){if(typeof t!="string")throw new Error("utf8ToBytes expected string, got "+typeof t);return new Uint8Array(new TextEncoder().encode(t))}function so(t){return typeof t=="string"&&(t=yw(t)),yr(t),t}function ww(...t){let e=0;for(let r=0;r<t.length;r++){const n=t[r];yr(n),e+=n.length}const i=new Uint8Array(e);for(let r=0,n=0;r<t.length;r++){const s=t[r];i.set(s,n),n+=s.length}return i}class Xu{clone(){return this._cloneInto()}}function el(t){const e=r=>t().update(so(r)).digest(),i=t();return e.outputLen=i.outputLen,e.blockLen=i.blockLen,e.create=()=>t(),e}function mw(t=32){if(gi&&typeof gi.getRandomValues=="function")return gi.getRandomValues(new Uint8Array(t));if(gi&&typeof gi.randomBytes=="function")return gi.randomBytes(t);throw new Error("crypto.getRandomValues must be defined")}const tl=[],il=[],rl=[],bw=BigInt(0),ji=BigInt(1),vw=BigInt(2),Ew=BigInt(7),_w=BigInt(256),Iw=BigInt(113);for(let t=0,e=ji,i=1,r=0;t<24;t++){[i,r]=[r,(2*i+3*r)%5],tl.push(2*(5*r+i)),il.push((t+1)*(t+2)/2%64);let n=bw;for(let s=0;s<7;s++)e=(e<<ji^(e>>Ew)*Iw)%_w,e&vw&&(n^=ji<<(ji<<BigInt(s))-ji);rl.push(n)}const[Dw,Sw]=aw(rl,!0),_a=(t,e,i)=>i>32?lw(t,e,i):cw(t,e,i),Ia=(t,e,i)=>i>32?hw(t,e,i):uw(t,e,i);function $w(t,e=24){const i=new Uint32Array(10);for(let r=24-e;r<24;r++){for(let o=0;o<10;o++)i[o]=t[o]^t[o+10]^t[o+20]^t[o+30]^t[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,u=i[c],l=i[c+1],h=_a(u,l,1)^i[a],d=Ia(u,l,1)^i[a+1];for(let f=0;f<50;f+=10)t[o+f]^=h,t[o+f+1]^=d}let n=t[2],s=t[3];for(let o=0;o<24;o++){const a=il[o],c=_a(n,s,a),u=Ia(n,s,a),l=tl[o];n=t[l],s=t[l+1],t[l]=c,t[l+1]=u}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)i[a]=t[o+a];for(let a=0;a<10;a++)t[o+a]^=~i[(a+2)%10]&i[(a+4)%10]}t[0]^=Dw[r],t[1]^=Sw[r]}i.fill(0)}class oo extends Xu{constructor(e,i,r,n=!1,s=24){if(super(),this.blockLen=e,this.suffix=i,this.outputLen=r,this.enableXOF=n,this.rounds=s,this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,Qr(r),0>=this.blockLen||this.blockLen>=200)throw new Error("Sha3 supports only keccak-f1600 function");this.state=new Uint8Array(200),this.state32=dw(this.state)}keccak(){va||Ea(this.state32),$w(this.state32,this.rounds),va||Ea(this.state32),this.posOut=0,this.pos=0}update(e){Is(this);const{blockLen:i,state:r}=this;e=so(e);const n=e.length;for(let s=0;s<n;){const o=Math.min(i-this.pos,n-s);for(let a=0;a<o;a++)r[this.pos++]^=e[s++];this.pos===i&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:i,pos:r,blockLen:n}=this;e[r]^=i,i&128&&r===n-1&&this.keccak(),e[n-1]^=128,this.keccak()}writeInto(e){Is(this,!1),yr(e),this.finish();const i=this.state,{blockLen:r}=this;for(let n=0,s=e.length;n<s;){this.posOut>=r&&this.keccak();const o=Math.min(r-this.posOut,s-n);e.set(i.subarray(this.posOut,this.posOut+o),n),this.posOut+=o,n+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return Qr(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(Qu(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(e){const{blockLen:i,suffix:r,outputLen:n,rounds:s,enableXOF:o}=this;return e||(e=new oo(i,r,n,o,s)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=s,e.suffix=r,e.outputLen=n,e.enableXOF=o,e.destroyed=this.destroyed,e}}const xw=(t,e,i)=>el(()=>new oo(e,t,i)),Ow=xw(1,136,256/8);function nl(t,e){const i=e||"hex",r=Ow(sr(t,{strict:!1})?tw(t):t);return i==="bytes"?r:_s(r)}class Aw extends Map{constructor(e){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=e}get(e){const i=super.get(e);return super.has(e)&&i!==void 0&&(this.delete(e),super.set(e,i)),i}set(e,i){if(super.set(e,i),this.maxSize&&this.size>this.maxSize){const r=this.keys().next().value;r&&this.delete(r)}return this}}const jn=new Aw(8192);function Pw(t,e){if(jn.has(`${t}.${e}`))return jn.get(`${t}.${e}`);const i=e?`${e}${t.toLowerCase()}`:t.substring(2).toLowerCase(),r=nl(Zu(i),"bytes"),n=(e?i.substring(`${e}0x`.length):i).split("");for(let o=0;o<40;o+=2)r[o>>1]>>4>=8&&n[o]&&(n[o]=n[o].toUpperCase()),(r[o>>1]&15)>=8&&n[o+1]&&(n[o+1]=n[o+1].toUpperCase());const s=`0x${n.join("")}`;return jn.set(`${t}.${e}`,s),s}function Cw(t){const e=nl(`0x${t.substring(4)}`).substring(26);return Pw(`0x${e}`)}async function Rw({hash:t,signature:e}){const i=sr(t)?t:_s(t),{secp256k1:r}=await Promise.resolve().then(()=>require("./secp256k1-0ef90b22.cjs"));return`0x${(()=>{if(typeof e=="object"&&"r"in e&&"s"in e){const{r:u,s:l,v:h,yParity:d}=e,f=Number(d??h),p=Da(f);return new r.Signature(Es(u),Es(l)).addRecoveryBit(p)}const o=sr(e)?e:_s(e),a=Yy(`0x${o.slice(130)}`),c=Da(a);return r.Signature.fromCompact(o.substring(2,130)).addRecoveryBit(c)})().recoverPublicKey(i.substring(2)).toHex(!1)}`}function Da(t){if(t===0||t===1)return t;if(t===27)return 0;if(t===28)return 1;throw new Error("Invalid yParityOrV value")}async function Tw({hash:t,signature:e}){return Cw(await Rw({hash:t,signature:e}))}function Nw(t){if(t.length>=255)throw new TypeError("Alphabet too long");const e=new Uint8Array(256);for(let u=0;u<e.length;u++)e[u]=255;for(let u=0;u<t.length;u++){const l=t.charAt(u),h=l.charCodeAt(0);if(e[h]!==255)throw new TypeError(l+" is ambiguous");e[h]=u}const i=t.length,r=t.charAt(0),n=Math.log(i)/Math.log(256),s=Math.log(256)/Math.log(i);function o(u){if(u instanceof Uint8Array||(ArrayBuffer.isView(u)?u=new Uint8Array(u.buffer,u.byteOffset,u.byteLength):Array.isArray(u)&&(u=Uint8Array.from(u))),!(u instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(u.length===0)return"";let l=0,h=0,d=0;const f=u.length;for(;d!==f&&u[d]===0;)d++,l++;const p=(f-d)*s+1>>>0,g=new Uint8Array(p);for(;d!==f;){let w=u[d],b=0;for(let E=p-1;(w!==0||b<h)&&E!==-1;E--,b++)w+=256*g[E]>>>0,g[E]=w%i>>>0,w=w/i>>>0;if(w!==0)throw new Error("Non-zero carry");h=b,d++}let y=p-h;for(;y!==p&&g[y]===0;)y++;let m=r.repeat(l);for(;y<p;++y)m+=t.charAt(g[y]);return m}function a(u){if(typeof u!="string")throw new TypeError("Expected String");if(u.length===0)return new Uint8Array;let l=0,h=0,d=0;for(;u[l]===r;)h++,l++;const f=(u.length-l)*n+1>>>0,p=new Uint8Array(f);for(;l<u.length;){const w=u.charCodeAt(l);if(w>255)return;let b=e[w];if(b===255)return;let E=0;for(let x=f-1;(b!==0||E<d)&&x!==-1;x--,E++)b+=i*p[x]>>>0,p[x]=b%256>>>0,b=b/256>>>0;if(b!==0)throw new Error("Non-zero carry");d=E,l++}let g=f-d;for(;g!==f&&p[g]===0;)g++;const y=new Uint8Array(h+(f-g));let m=h;for(;g!==f;)y[m++]=p[g++];return y}function c(u){const l=a(u);if(l)return l;throw new Error("Non-base"+i+" character")}return{encode:o,decodeUnsafe:a,decode:c}}var Fw="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";const Lw=Nw(Fw);function sl(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?globalThis.Buffer.allocUnsafe(t):new Uint8Array(t)}function Zi(t,e){e||(e=t.reduce((n,s)=>n+s.length,0));const i=sl(e);let r=0;for(const n of t)i.set(n,r),r+=n.length;return i}function Bw(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var i=new Uint8Array(256),r=0;r<i.length;r++)i[r]=255;for(var n=0;n<t.length;n++){var s=t.charAt(n),o=s.charCodeAt(0);if(i[o]!==255)throw new TypeError(s+" is ambiguous");i[o]=n}var a=t.length,c=t.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(p){if(p instanceof Uint8Array||(ArrayBuffer.isView(p)?p=new Uint8Array(p.buffer,p.byteOffset,p.byteLength):Array.isArray(p)&&(p=Uint8Array.from(p))),!(p instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(p.length===0)return"";for(var g=0,y=0,m=0,w=p.length;m!==w&&p[m]===0;)m++,g++;for(var b=(w-m)*l+1>>>0,E=new Uint8Array(b);m!==w;){for(var x=p[m],S=0,$=b-1;(x!==0||S<y)&&$!==-1;$--,S++)x+=256*E[$]>>>0,E[$]=x%a>>>0,x=x/a>>>0;if(x!==0)throw new Error("Non-zero carry");y=S,m++}for(var A=b-y;A!==b&&E[A]===0;)A++;for(var I=c.repeat(g);A<b;++A)I+=t.charAt(E[A]);return I}function d(p){if(typeof p!="string")throw new TypeError("Expected String");if(p.length===0)return new Uint8Array;var g=0;if(p[g]!==" "){for(var y=0,m=0;p[g]===c;)y++,g++;for(var w=(p.length-g)*u+1>>>0,b=new Uint8Array(w);p[g];){var E=i[p.charCodeAt(g)];if(E===255)return;for(var x=0,S=w-1;(E!==0||x<m)&&S!==-1;S--,x++)E+=a*b[S]>>>0,b[S]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");m=x,g++}if(p[g]!==" "){for(var $=w-m;$!==w&&b[$]===0;)$++;for(var A=new Uint8Array(y+(w-$)),I=y;$!==w;)A[I++]=b[$++];return A}}}function f(p){var g=d(p);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:d,decode:f}}var Uw=Bw,kw=Uw;const Mw=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},qw=t=>new TextEncoder().encode(t),jw=t=>new TextDecoder().decode(t);class zw{constructor(e,i,r){this.name=e,this.prefix=i,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class Vw{constructor(e,i,r){if(this.name=e,this.prefix=i,i.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i.codePointAt(0),this.baseDecode=r}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return ol(this,e)}}class Kw{constructor(e){this.decoders=e}or(e){return ol(this,e)}decode(e){const i=e[0],r=this.decoders[i];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const ol=(t,e)=>new Kw({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class Hw{constructor(e,i,r,n){this.name=e,this.prefix=i,this.baseEncode=r,this.baseDecode=n,this.encoder=new zw(e,i,r),this.decoder=new Vw(e,i,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const pn=({name:t,prefix:e,encode:i,decode:r})=>new Hw(t,e,i,r),wr=({prefix:t,name:e,alphabet:i})=>{const{encode:r,decode:n}=kw(i,e);return pn({prefix:t,name:e,encode:r,decode:s=>Mw(n(s))})},Ww=(t,e,i,r)=>{const n={};for(let l=0;l<e.length;++l)n[e[l]]=l;let s=t.length;for(;t[s-1]==="=";)--s;const o=new Uint8Array(s*i/8|0);let a=0,c=0,u=0;for(let l=0;l<s;++l){const h=n[t[l]];if(h===void 0)throw new SyntaxError(`Non-${r} character`);c=c<<i|h,a+=i,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=i||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},Gw=(t,e,i)=>{const r=e[e.length-1]==="=",n=(1<<i)-1;let s="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>i;)o-=i,s+=e[n&a>>o];if(o&&(s+=e[n&a<<i-o]),r)for(;s.length*i&7;)s+="=";return s},Oe=({name:t,prefix:e,bitsPerChar:i,alphabet:r})=>pn({prefix:e,name:t,encode(n){return Gw(n,r,i)},decode(n){return Ww(n,r,i,t)}}),Yw=pn({prefix:"\0",name:"identity",encode:t=>jw(t),decode:t=>qw(t)}),Jw=Object.freeze(Object.defineProperty({__proto__:null,identity:Yw},Symbol.toStringTag,{value:"Module"})),Zw=Oe({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),Qw=Object.freeze(Object.defineProperty({__proto__:null,base2:Zw},Symbol.toStringTag,{value:"Module"})),Xw=Oe({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),em=Object.freeze(Object.defineProperty({__proto__:null,base8:Xw},Symbol.toStringTag,{value:"Module"})),tm=wr({prefix:"9",name:"base10",alphabet:"0123456789"}),im=Object.freeze(Object.defineProperty({__proto__:null,base10:tm},Symbol.toStringTag,{value:"Module"})),rm=Oe({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),nm=Oe({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),sm=Object.freeze(Object.defineProperty({__proto__:null,base16:rm,base16upper:nm},Symbol.toStringTag,{value:"Module"})),om=Oe({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),am=Oe({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),cm=Oe({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),um=Oe({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),lm=Oe({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),hm=Oe({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),dm=Oe({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),pm=Oe({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),fm=Oe({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),gm=Object.freeze(Object.defineProperty({__proto__:null,base32:om,base32hex:lm,base32hexpad:dm,base32hexpadupper:pm,base32hexupper:hm,base32pad:cm,base32padupper:um,base32upper:am,base32z:fm},Symbol.toStringTag,{value:"Module"})),ym=wr({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),wm=wr({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),mm=Object.freeze(Object.defineProperty({__proto__:null,base36:ym,base36upper:wm},Symbol.toStringTag,{value:"Module"})),bm=wr({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),vm=wr({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),Em=Object.freeze(Object.defineProperty({__proto__:null,base58btc:bm,base58flickr:vm},Symbol.toStringTag,{value:"Module"})),_m=Oe({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Im=Oe({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Dm=Oe({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Sm=Oe({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),$m=Object.freeze(Object.defineProperty({__proto__:null,base64:_m,base64pad:Im,base64url:Dm,base64urlpad:Sm},Symbol.toStringTag,{value:"Module"})),al=Array.from(""),xm=al.reduce((t,e,i)=>(t[i]=e,t),[]),Om=al.reduce((t,e,i)=>(t[e.codePointAt(0)]=i,t),[]);function Am(t){return t.reduce((e,i)=>(e+=xm[i],e),"")}function Pm(t){const e=[];for(const i of t){const r=Om[i.codePointAt(0)];if(r===void 0)throw new Error(`Non-base256emoji character: ${i}`);e.push(r)}return new Uint8Array(e)}const Cm=pn({prefix:"",name:"base256emoji",encode:Am,decode:Pm}),Rm=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:Cm},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;const Sa={...Jw,...Qw,...em,...im,...sm,...gm,...mm,...Em,...$m,...Rm};function cl(t,e,i,r){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:i},decoder:{decode:r}}}const $a=cl("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),zn=cl("ascii","a",t=>{let e="a";for(let i=0;i<t.length;i++)e+=String.fromCharCode(t[i]);return e},t=>{t=t.substring(1);const e=sl(t.length);for(let i=0;i<t.length;i++)e[i]=t.charCodeAt(i);return e}),ul={utf8:$a,"utf-8":$a,hex:Sa.base16,latin1:zn,ascii:zn,binary:zn,...Sa};function Xe(t,e="utf8"){const i=ul[e];if(!i)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t,"utf8"):i.decoder.decode(`${i.prefix}${t}`)}function qe(t,e="utf8"){const i=ul[e];if(!i)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):i.encoder.encode(t).substring(1)}const Tm={waku:{publish:"waku_publish",batchPublish:"waku_batchPublish",subscribe:"waku_subscribe",batchSubscribe:"waku_batchSubscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe",batchUnsubscribe:"waku_batchUnsubscribe",batchFetchMessages:"waku_batchFetchMessages"},irn:{publish:"irn_publish",batchPublish:"irn_batchPublish",subscribe:"irn_subscribe",batchSubscribe:"irn_batchSubscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe",batchUnsubscribe:"irn_batchUnsubscribe",batchFetchMessages:"irn_batchFetchMessages"},iridium:{publish:"iridium_publish",batchPublish:"iridium_batchPublish",subscribe:"iridium_subscribe",batchSubscribe:"iridium_batchSubscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe",batchUnsubscribe:"iridium_batchUnsubscribe",batchFetchMessages:"iridium_batchFetchMessages"}},ao=":";function zr(t){const[e,i]=t.split(ao);return{namespace:e,reference:i}}function Nm(t){const{namespace:e,reference:i}=t;return[e,i].join(ao)}function Fm(t){const[e,i,r]=t.split(ao);return{namespace:e,reference:i,address:r}}function Lm(t,e){const i=[];return t.forEach(r=>{const n=e(r);i.includes(n)||i.push(n)}),i}function Bm(t){const{namespace:e,reference:i}=Fm(t);return Nm({namespace:e,reference:i})}function Um(t){return Lm(t,Bm)}function ll(t,e=[]){const i=[];return Object.keys(t).forEach(r=>{if(e.length&&!e.includes(r))return;const n=t[r];i.push(...n.accounts)}),i}function hl(t,e=[]){const i=[];return Object.keys(t).forEach(r=>{if(e.length&&!e.includes(r))return;const n=t[r];i.push(...Um(n.accounts))}),i}function km(t,e=[]){const i=[];return Object.keys(t).forEach(r=>{if(e.length&&!e.includes(r))return;const n=t[r];i.push(...co(r,n))}),i}function co(t,e){return t.includes(":")?[t]:e.chains||[]}var Mm=Object.defineProperty,qm=Object.defineProperties,jm=Object.getOwnPropertyDescriptors,xa=Object.getOwnPropertySymbols,zm=Object.prototype.hasOwnProperty,Vm=Object.prototype.propertyIsEnumerable,Oa=(t,e,i)=>e in t?Mm(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,Aa=(t,e)=>{for(var i in e||(e={}))zm.call(e,i)&&Oa(t,i,e[i]);if(xa)for(var i of xa(e))Vm.call(e,i)&&Oa(t,i,e[i]);return t},Km=(t,e)=>qm(t,jm(e));const Hm="ReactNative",We={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},Wm="js";function Xr(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function qt(){return!gr()&&!!ro()&&navigator.product===Hm}function Gm(){return qt()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="android"}function Ym(){return qt()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="ios"}function mr(){return!Xr()&&!!ro()&&!!gr()}function br(){return qt()?We.reactNative:Xr()?We.node:mr()?We.browser:We.unknown}function Pa(){var t;try{return qt()&&typeof global<"u"&&typeof(global==null?void 0:global.Application)<"u"?(t=global.Application)==null?void 0:t.applicationId:void 0}catch{return}}function Jm(t,e){const i=new URLSearchParams(t);for(const r of Object.keys(e).sort())if(e.hasOwnProperty(r)){const n=e[r];n!==void 0&&i.set(r,n)}return i.toString()}function Zm(t){var e,i;const r=dl();try{return t!=null&&t.url&&r.url&&t.url!==r.url&&(console.warn(`The configured WalletConnect 'metadata.url':${t.url} differs from the actual page url:${r.url}. This is probably unintended and can lead to issues.`),t.url=r.url),(e=t?.icons)!=null&&e.length&&t.icons.length>0&&(t.icons=t.icons.filter(n=>n!=="")),Km(Aa(Aa({},r),t),{url:t?.url||r.url,name:t?.name||r.name,description:t?.description||r.description,icons:(i=t?.icons)!=null&&i.length&&t.icons.length>0?t.icons:r.icons})}catch(n){return console.warn("Error populating app metadata",n),t||r}}function dl(){return Vu()||{name:"",description:"",url:"",icons:[""]}}function Qm(){if(br()===We.reactNative&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"){const{OS:i,Version:r}=global.Platform;return[i,r].join("-")}const t=st.detect();if(t===null)return"unknown";const e=t.os?t.os.replace(" ","").toLowerCase():"unknown";return t.type==="browser"?[e,t.name,t.version].join("-"):[e,t.version].join("-")}function Xm(){var t;const e=br();return e===We.browser?[e,((t=zu())==null?void 0:t.host)||"unknown"].join(":"):e}function pl(t,e,i){const r=Qm(),n=Xm();return[[t,e].join("-"),[Wm,i].join("-"),r,n].join("/")}function eb({protocol:t,version:e,relayUrl:i,sdkVersion:r,auth:n,projectId:s,useOnCloseEvent:o,bundleId:a,packageName:c}){const u=i.split("?"),l=pl(t,e,r),h={auth:n,ua:l,projectId:s,useOnCloseEvent:o||void 0,packageName:c||void 0,bundleId:a||void 0},d=Jm(u[1]||"",h);return u[0]+"?"+d}function Zt(t,e){return t.filter(i=>e.includes(i)).length===t.length}function Ds(t){return Object.fromEntries(t.entries())}function Ss(t){return new Map(Object.entries(t))}function Wt(t=T.FIVE_MINUTES,e){const i=T.toMiliseconds(t||T.FIVE_MINUTES);let r,n,s,o;return{resolve:a=>{s&&r&&(clearTimeout(s),r(a),o=Promise.resolve(a))},reject:a=>{s&&n&&(clearTimeout(s),n(a))},done:()=>new Promise((a,c)=>{if(o)return a(o);s=setTimeout(()=>{const u=new Error(e);o=Promise.reject(u),c(u)},i),r=a,n=c})}}function kt(t,e,i){return new Promise(async(r,n)=>{const s=setTimeout(()=>n(new Error(i)),e);try{const o=await t;r(o)}catch(o){n(o)}clearTimeout(s)})}function fl(t,e){if(typeof e=="string"&&e.startsWith(`${t}:`))return e;if(t.toLowerCase()==="topic"){if(typeof e!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}else if(t.toLowerCase()==="id"){if(typeof e!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${t}`)}function tb(t){return fl("topic",t)}function ib(t){return fl("id",t)}function gl(t){const[e,i]=t.split(":"),r={id:void 0,topic:void 0};if(e==="topic"&&typeof i=="string")r.topic=i;else if(e==="id"&&Number.isInteger(Number(i)))r.id=Number(i);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${i}`);return r}function pe(t,e){return T.fromMiliseconds((e||Date.now())+T.toMiliseconds(t))}function Bt(t){return Date.now()>=T.toMiliseconds(t)}function X(t,e){return`${t}${e?`:${e}`:""}`}function rb(t=[],e=[]){return[...new Set([...t,...e])]}async function nb({id:t,topic:e,wcDeepLink:i}){var r;try{if(!i)return;const n=typeof i=="string"?JSON.parse(i):i,s=n?.href;if(typeof s!="string")return;const o=sb(s,t,e),a=br();if(a===We.browser){if(!((r=gr())!=null&&r.hasFocus())){console.warn("Document does not have focus, skipping deeplink.");return}ob(o)}else a===We.reactNative&&typeof(global==null?void 0:global.Linking)<"u"&&await global.Linking.openURL(o)}catch(n){console.error(n)}}function sb(t,e,i){const r=`requestId=${e}&sessionTopic=${i}`;t.endsWith("/")&&(t=t.slice(0,-1));let n=`${t}`;if(t.startsWith("https://t.me")){const s=t.includes("?")?"&startapp=":"?startapp=";n=`${n}${s}${lb(r,!0)}`}else n=`${n}/wc?${r}`;return n}function ob(t){let e="_self";ub()?e="_top":(cb()||t.startsWith("https://")||t.startsWith("http://"))&&(e="_blank"),window.open(t,e,"noreferrer noopener")}async function ab(t,e){let i="";try{if(mr()&&(i=localStorage.getItem(e),i))return i;i=await t.getItem(e)}catch(r){console.error(r)}return i}function Ca(t,e){if(!t.includes(e))return null;const i=t.split(/([&,?,=])/),r=i.indexOf(e);return i[r+2]}function Ra(){return typeof crypto<"u"&&crypto!=null&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/gu,t=>{const e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)})}function uo(){return typeof process<"u"&&process.env.IS_VITEST==="true"}function cb(){return typeof window<"u"&&(!!window.TelegramWebviewProxy||!!window.Telegram||!!window.TelegramWebviewProxyProto)}function ub(){try{return window.self!==window.top}catch{return!1}}function lb(t,e=!1){const i=Buffer.from(t).toString("base64");return e?i.replace(/[=]/g,""):i}function yl(t){return Buffer.from(t,"base64").toString("utf-8")}function hb(t){return new Promise(e=>setTimeout(e,t))}function or(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function db(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function vr(t,...e){if(!db(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function lo(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");or(t.outputLen),or(t.blockLen)}function Di(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function wl(t,e){vr(t);const i=e.outputLen;if(t.length<i)throw new Error("digestInto() expects output buffer of length at least "+i)}const Nr=BigInt(2**32-1),Ta=BigInt(32);function pb(t,e=!1){return e?{h:Number(t&Nr),l:Number(t>>Ta&Nr)}:{h:Number(t>>Ta&Nr)|0,l:Number(t&Nr)|0}}function fb(t,e=!1){let i=new Uint32Array(t.length),r=new Uint32Array(t.length);for(let n=0;n<t.length;n++){const{h:s,l:o}=pb(t[n],e);[i[n],r[n]]=[s,o]}return[i,r]}const gb=(t,e,i)=>t<<i|e>>>32-i,yb=(t,e,i)=>e<<i|t>>>32-i,wb=(t,e,i)=>e<<i-32|t>>>64-i,mb=(t,e,i)=>t<<i-32|e>>>64-i,yi=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function bb(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function Vn(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function ut(t,e){return t<<32-e|t>>>e}const Na=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function vb(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}function Fa(t){for(let e=0;e<t.length;e++)t[e]=vb(t[e])}function Eb(t){if(typeof t!="string")throw new Error("utf8ToBytes expected string, got "+typeof t);return new Uint8Array(new TextEncoder().encode(t))}function Si(t){return typeof t=="string"&&(t=Eb(t)),vr(t),t}function _b(...t){let e=0;for(let r=0;r<t.length;r++){const n=t[r];vr(n),e+=n.length}const i=new Uint8Array(e);for(let r=0,n=0;r<t.length;r++){const s=t[r];i.set(s,n),n+=s.length}return i}class ho{clone(){return this._cloneInto()}}function ml(t){const e=r=>t().update(Si(r)).digest(),i=t();return e.outputLen=i.outputLen,e.blockLen=i.blockLen,e.create=()=>t(),e}function Li(t=32){if(yi&&typeof yi.getRandomValues=="function")return yi.getRandomValues(new Uint8Array(t));if(yi&&typeof yi.randomBytes=="function")return yi.randomBytes(t);throw new Error("crypto.getRandomValues must be defined")}const bl=[],vl=[],El=[],Ib=BigInt(0),zi=BigInt(1),Db=BigInt(2),Sb=BigInt(7),$b=BigInt(256),xb=BigInt(113);for(let t=0,e=zi,i=1,r=0;t<24;t++){[i,r]=[r,(2*i+3*r)%5],bl.push(2*(5*r+i)),vl.push((t+1)*(t+2)/2%64);let n=Ib;for(let s=0;s<7;s++)e=(e<<zi^(e>>Sb)*xb)%$b,e&Db&&(n^=zi<<(zi<<BigInt(s))-zi);El.push(n)}const[Ob,Ab]=fb(El,!0),La=(t,e,i)=>i>32?wb(t,e,i):gb(t,e,i),Ba=(t,e,i)=>i>32?mb(t,e,i):yb(t,e,i);function Pb(t,e=24){const i=new Uint32Array(10);for(let r=24-e;r<24;r++){for(let o=0;o<10;o++)i[o]=t[o]^t[o+10]^t[o+20]^t[o+30]^t[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,u=i[c],l=i[c+1],h=La(u,l,1)^i[a],d=Ba(u,l,1)^i[a+1];for(let f=0;f<50;f+=10)t[o+f]^=h,t[o+f+1]^=d}let n=t[2],s=t[3];for(let o=0;o<24;o++){const a=vl[o],c=La(n,s,a),u=Ba(n,s,a),l=bl[o];n=t[l],s=t[l+1],t[l]=c,t[l+1]=u}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)i[a]=t[o+a];for(let a=0;a<10;a++)t[o+a]^=~i[(a+2)%10]&i[(a+4)%10]}t[0]^=Ob[r],t[1]^=Ab[r]}i.fill(0)}let Cb=class _l extends ho{constructor(e,i,r,n=!1,s=24){if(super(),this.blockLen=e,this.suffix=i,this.outputLen=r,this.enableXOF=n,this.rounds=s,this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,or(r),0>=this.blockLen||this.blockLen>=200)throw new Error("Sha3 supports only keccak-f1600 function");this.state=new Uint8Array(200),this.state32=bb(this.state)}keccak(){Na||Fa(this.state32),Pb(this.state32,this.rounds),Na||Fa(this.state32),this.posOut=0,this.pos=0}update(e){Di(this);const{blockLen:i,state:r}=this;e=Si(e);const n=e.length;for(let s=0;s<n;){const o=Math.min(i-this.pos,n-s);for(let a=0;a<o;a++)r[this.pos++]^=e[s++];this.pos===i&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:i,pos:r,blockLen:n}=this;e[r]^=i,i&128&&r===n-1&&this.keccak(),e[n-1]^=128,this.keccak()}writeInto(e){Di(this,!1),vr(e),this.finish();const i=this.state,{blockLen:r}=this;for(let n=0,s=e.length;n<s;){this.posOut>=r&&this.keccak();const o=Math.min(r-this.posOut,s-n);e.set(i.subarray(this.posOut,this.posOut+o),n),this.posOut+=o,n+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return or(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(wl(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(e){const{blockLen:i,suffix:r,outputLen:n,rounds:s,enableXOF:o}=this;return e||(e=new _l(i,r,n,o,s)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=s,e.suffix=r,e.outputLen=n,e.enableXOF=o,e.destroyed=this.destroyed,e}};const Rb=(t,e,i)=>ml(()=>new Cb(e,t,i)),Tb=Rb(1,136,256/8),Nb="https://rpc.walletconnect.org/v1";function Il(t){const e=`Ethereum Signed Message:
${t.length}`,i=new TextEncoder().encode(e+t);return"0x"+Buffer.from(Tb(i)).toString("hex")}async function Fb(t,e,i,r,n,s){switch(i.t){case"eip191":return await Lb(t,e,i.s);case"eip1271":return await Bb(t,e,i.s,r,n,s);default:throw new Error(`verifySignature failed: Attempted to verify CacaoSignature with unknown type: ${i.t}`)}}async function Lb(t,e,i){return(await Tw({hash:Il(e),signature:i})).toLowerCase()===t.toLowerCase()}async function Bb(t,e,i,r,n,s){const o=zr(r);if(!o.namespace||!o.reference)throw new Error(`isValidEip1271Signature failed: chainId must be in CAIP-2 format, received: ${r}`);try{const a="0x1626ba7e",c="0000000000000000000000000000000000000000000000000000000000000040",u="0000000000000000000000000000000000000000000000000000000000000041",l=i.substring(2),h=Il(e).substring(2),d=a+h+c+u+l,f=await fetch(`${s||Nb}/?chainId=${r}&projectId=${n}`,{method:"POST",body:JSON.stringify({id:Ub(),jsonrpc:"2.0",method:"eth_call",params:[{to:t,data:d},"latest"]})}),{result:p}=await f.json();return p?p.slice(0,a.length).toLowerCase()===a.toLowerCase():!1}catch(a){return console.error("isValidEip1271Signature: ",a),!1}}function Ub(){return Date.now()+Math.floor(Math.random()*1e3)}function kb(t){const e=atob(t),i=new Uint8Array(e.length);for(let o=0;o<e.length;o++)i[o]=e.charCodeAt(o);const r=i[0];if(r===0)throw new Error("No signatures found");const n=1+r*64;if(i.length<n)throw new Error("Transaction data too short for claimed signature count");if(i.length<100)throw new Error("Transaction too short");const s=Buffer.from(t,"base64").slice(1,65);return Lw.encode(s)}var Mb=Object.defineProperty,qb=Object.defineProperties,jb=Object.getOwnPropertyDescriptors,Ua=Object.getOwnPropertySymbols,zb=Object.prototype.hasOwnProperty,Vb=Object.prototype.propertyIsEnumerable,ka=(t,e,i)=>e in t?Mb(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,Kb=(t,e)=>{for(var i in e||(e={}))zb.call(e,i)&&ka(t,i,e[i]);if(Ua)for(var i of Ua(e))Vb.call(e,i)&&ka(t,i,e[i]);return t},Hb=(t,e)=>qb(t,jb(e));const Wb="did:pkh:",po=t=>t?.split(":"),Gb=t=>{const e=t&&po(t);if(e)return t.includes(Wb)?e[3]:e[1]},$s=t=>{const e=t&&po(t);if(e)return e[2]+":"+e[3]},en=t=>{const e=t&&po(t);if(e)return e.pop()};async function Ma(t){const{cacao:e,projectId:i}=t,{s:r,p:n}=e,s=Dl(n,n.iss),o=en(n.iss);return await Fb(o,s,r,$s(n.iss),i)}const Dl=(t,e)=>{const i=`${t.domain} wants you to sign in with your Ethereum account:`,r=en(e);if(!t.aud&&!t.uri)throw new Error("Either `aud` or `uri` is required to construct the message");let n=t.statement||void 0;const s=`URI: ${t.aud||t.uri}`,o=`Version: ${t.version}`,a=`Chain ID: ${Gb(e)}`,c=`Nonce: ${t.nonce}`,u=`Issued At: ${t.iat}`,l=t.exp?`Expiration Time: ${t.exp}`:void 0,h=t.nbf?`Not Before: ${t.nbf}`:void 0,d=t.requestId?`Request ID: ${t.requestId}`:void 0,f=t.resources?`Resources:${t.resources.map(g=>`
- ${g}`).join("")}`:void 0,p=Vr(t.resources);if(p){const g=ar(p);n=r1(n,g)}return[i,r,"",n,"",s,o,a,c,u,l,h,d,f].filter(g=>g!=null).join(`
`)};function Yb(t){return Buffer.from(JSON.stringify(t)).toString("base64")}function Jb(t){return JSON.parse(Buffer.from(t,"base64").toString("utf-8"))}function ri(t){if(!t)throw new Error("No recap provided, value is undefined");if(!t.att)throw new Error("No `att` property found");const e=Object.keys(t.att);if(!(e!=null&&e.length))throw new Error("No resources found in `att` property");e.forEach(i=>{const r=t.att[i];if(Array.isArray(r))throw new Error(`Resource must be an object: ${i}`);if(typeof r!="object")throw new Error(`Resource must be an object: ${i}`);if(!Object.keys(r).length)throw new Error(`Resource object is empty: ${i}`);Object.keys(r).forEach(n=>{const s=r[n];if(!Array.isArray(s))throw new Error(`Ability limits ${n} must be an array of objects, found: ${s}`);if(!s.length)throw new Error(`Value of ${n} is empty array, must be an array with objects`);s.forEach(o=>{if(typeof o!="object")throw new Error(`Ability limits (${n}) must be an array of objects, found: ${o}`)})})})}function Zb(t,e,i,r={}){return i?.sort((n,s)=>n.localeCompare(s)),{att:{[t]:Qb(e,i,r)}}}function Qb(t,e,i={}){e=e?.sort((n,s)=>n.localeCompare(s));const r=e.map(n=>({[`${t}/${n}`]:[i]}));return Object.assign({},...r)}function Sl(t){return ri(t),`urn:recap:${Yb(t).replace(/=/g,"")}`}function ar(t){const e=Jb(t.replace("urn:recap:",""));return ri(e),e}function Xb(t,e,i){const r=Zb(t,e,i);return Sl(r)}function e1(t){return t&&t.includes("urn:recap:")}function t1(t,e){const i=ar(t),r=ar(e),n=i1(i,r);return Sl(n)}function i1(t,e){ri(t),ri(e);const i=Object.keys(t.att).concat(Object.keys(e.att)).sort((n,s)=>n.localeCompare(s)),r={att:{}};return i.forEach(n=>{var s,o;Object.keys(((s=t.att)==null?void 0:s[n])||{}).concat(Object.keys(((o=e.att)==null?void 0:o[n])||{})).sort((a,c)=>a.localeCompare(c)).forEach(a=>{var c,u;r.att[n]=Hb(Kb({},r.att[n]),{[a]:((c=t.att[n])==null?void 0:c[a])||((u=e.att[n])==null?void 0:u[a])})})}),r}function r1(t="",e){ri(e);const i="I further authorize the stated URI to perform the following actions on my behalf: ";if(t.includes(i))return t;const r=[];let n=0;Object.keys(e.att).forEach(a=>{const c=Object.keys(e.att[a]).map(h=>({ability:h.split("/")[0],action:h.split("/")[1]}));c.sort((h,d)=>h.action.localeCompare(d.action));const u={};c.forEach(h=>{u[h.ability]||(u[h.ability]=[]),u[h.ability].push(h.action)});const l=Object.keys(u).map(h=>(n++,`(${n}) '${h}': '${u[h].join("', '")}' for '${a}'.`));r.push(l.join(", ").replace(".,","."))});const s=r.join(" "),o=`${i}${s}`;return`${t?t+" ":""}${o}`}function qa(t){var e;const i=ar(t);ri(i);const r=(e=i.att)==null?void 0:e.eip155;return r?Object.keys(r).map(n=>n.split("/")[1]):[]}function ja(t){const e=ar(t);ri(e);const i=[];return Object.values(e.att).forEach(r=>{Object.values(r).forEach(n=>{var s;(s=n?.[0])!=null&&s.chains&&i.push(n[0].chains)})}),[...new Set(i.flat())]}function Vr(t){if(!t)return;const e=t?.[t.length-1];return e1(e)?e:void 0}function Kn(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function $l(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function He(t,...e){if(!$l(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function za(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function n1(t,e){He(t);const i=e.outputLen;if(t.length<i)throw new Error("digestInto() expects output buffer of length at least "+i)}function Va(t){if(typeof t!="boolean")throw new Error(`boolean expected, not ${t}`)}const Mt=t=>new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4)),s1=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),o1=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!o1)throw new Error("Non little-endian hardware is not supported");function a1(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function xs(t){if(typeof t=="string")t=a1(t);else if($l(t))t=Os(t);else throw new Error("Uint8Array expected, got "+typeof t);return t}function c1(t,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(t,e)}function u1(t,e){if(t.length!==e.length)return!1;let i=0;for(let r=0;r<t.length;r++)i|=t[r]^e[r];return i===0}const l1=(t,e)=>{function i(r,...n){if(He(r),t.nonceLength!==void 0){const u=n[0];if(!u)throw new Error("nonce / iv required");t.varSizeNonce?He(u):He(u,t.nonceLength)}const s=t.tagLength;s&&n[1]!==void 0&&He(n[1]);const o=e(r,...n),a=(u,l)=>{if(l!==void 0){if(u!==2)throw new Error("cipher output not supported");He(l)}};let c=!1;return{encrypt(u,l){if(c)throw new Error("cannot encrypt() twice with same key + nonce");return c=!0,He(u),a(o.encrypt.length,l),o.encrypt(u,l)},decrypt(u,l){if(He(u),s&&u.length<s)throw new Error("invalid ciphertext length: smaller than tagLength="+s);return a(o.decrypt.length,l),o.decrypt(u,l)}}}return Object.assign(i,t),i};function Ka(t,e,i=!0){if(e===void 0)return new Uint8Array(t);if(e.length!==t)throw new Error("invalid output length, expected "+t+", got: "+e.length);if(i&&!h1(e))throw new Error("invalid output, must be aligned");return e}function Ha(t,e,i,r){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,i,r);const n=BigInt(32),s=BigInt(4294967295),o=Number(i>>n&s),a=Number(i&s),c=r?4:0,u=r?0:4;t.setUint32(e+c,o,r),t.setUint32(e+u,a,r)}function h1(t){return t.byteOffset%4===0}function Os(t){return Uint8Array.from(t)}function $i(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}const xl=t=>Uint8Array.from(t.split("").map(e=>e.charCodeAt(0))),d1=xl("expand 16-byte k"),p1=xl("expand 32-byte k"),f1=Mt(d1),g1=Mt(p1);function Z(t,e){return t<<e|t>>>32-e}function As(t){return t.byteOffset%4===0}const Fr=64,y1=16,Ol=2**32-1,Wa=new Uint32Array;function w1(t,e,i,r,n,s,o,a){const c=n.length,u=new Uint8Array(Fr),l=Mt(u),h=As(n)&&As(s),d=h?Mt(n):Wa,f=h?Mt(s):Wa;for(let p=0;p<c;o++){if(t(e,i,r,l,o,a),o>=Ol)throw new Error("arx: counter overflow");const g=Math.min(Fr,c-p);if(h&&g===Fr){const y=p/4;if(p%4!==0)throw new Error("arx: invalid block position");for(let m=0,w;m<y1;m++)w=y+m,f[w]=d[w]^l[m];p+=Fr;continue}for(let y=0,m;y<g;y++)m=p+y,s[m]=n[m]^u[y];p+=g}}function m1(t,e){const{allowShortKeys:i,extendNonceFn:r,counterLength:n,counterRight:s,rounds:o}=c1({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof t!="function")throw new Error("core must be a function");return Kn(n),Kn(o),Va(s),Va(i),(a,c,u,l,h=0)=>{He(a),He(c),He(u);const d=u.length;if(l===void 0&&(l=new Uint8Array(d)),He(l),Kn(h),h<0||h>=Ol)throw new Error("arx: counter overflow");if(l.length<d)throw new Error(`arx: output (${l.length}) is shorter than data (${d})`);const f=[];let p=a.length,g,y;if(p===32)f.push(g=Os(a)),y=g1;else if(p===16&&i)g=new Uint8Array(32),g.set(a),g.set(a,16),y=f1,f.push(g);else throw new Error(`arx: invalid 32-byte key, got length=${p}`);As(c)||f.push(c=Os(c));const m=Mt(g);if(r){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");r(y,m,Mt(c.subarray(0,16)),m),c=c.subarray(16)}const w=16-n;if(w!==c.length)throw new Error(`arx: nonce must be ${w} or 16 bytes`);if(w!==12){const E=new Uint8Array(12);E.set(c,s?0:12-c.length),c=E,f.push(c)}const b=Mt(c);return w1(t,y,m,b,u,l,h,o),$i(...f),l}}const Ie=(t,e)=>t[e++]&255|(t[e++]&255)<<8;class b1{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=xs(e),He(e,32);const i=Ie(e,0),r=Ie(e,2),n=Ie(e,4),s=Ie(e,6),o=Ie(e,8),a=Ie(e,10),c=Ie(e,12),u=Ie(e,14);this.r[0]=i&8191,this.r[1]=(i>>>13|r<<3)&8191,this.r[2]=(r>>>10|n<<6)&7939,this.r[3]=(n>>>7|s<<9)&8191,this.r[4]=(s>>>4|o<<12)&255,this.r[5]=o>>>1&8190,this.r[6]=(o>>>14|a<<2)&8191,this.r[7]=(a>>>11|c<<5)&8065,this.r[8]=(c>>>8|u<<8)&8191,this.r[9]=u>>>5&127;for(let l=0;l<8;l++)this.pad[l]=Ie(e,16+2*l)}process(e,i,r=!1){const n=r?0:2048,{h:s,r:o}=this,a=o[0],c=o[1],u=o[2],l=o[3],h=o[4],d=o[5],f=o[6],p=o[7],g=o[8],y=o[9],m=Ie(e,i+0),w=Ie(e,i+2),b=Ie(e,i+4),E=Ie(e,i+6),x=Ie(e,i+8),S=Ie(e,i+10),$=Ie(e,i+12),A=Ie(e,i+14);let I=s[0]+(m&8191),M=s[1]+((m>>>13|w<<3)&8191),L=s[2]+((w>>>10|b<<6)&8191),U=s[3]+((b>>>7|E<<9)&8191),q=s[4]+((E>>>4|x<<12)&8191),C=s[5]+(x>>>1&8191),_=s[6]+((x>>>14|S<<2)&8191),v=s[7]+((S>>>11|$<<5)&8191),O=s[8]+(($>>>8|A<<8)&8191),P=s[9]+(A>>>5|n),D=0,N=D+I*a+M*(5*y)+L*(5*g)+U*(5*p)+q*(5*f);D=N>>>13,N&=8191,N+=C*(5*d)+_*(5*h)+v*(5*l)+O*(5*u)+P*(5*c),D+=N>>>13,N&=8191;let B=D+I*c+M*a+L*(5*y)+U*(5*g)+q*(5*p);D=B>>>13,B&=8191,B+=C*(5*f)+_*(5*d)+v*(5*h)+O*(5*l)+P*(5*u),D+=B>>>13,B&=8191;let k=D+I*u+M*c+L*a+U*(5*y)+q*(5*g);D=k>>>13,k&=8191,k+=C*(5*p)+_*(5*f)+v*(5*d)+O*(5*h)+P*(5*l),D+=k>>>13,k&=8191;let j=D+I*l+M*u+L*c+U*a+q*(5*y);D=j>>>13,j&=8191,j+=C*(5*g)+_*(5*p)+v*(5*f)+O*(5*d)+P*(5*h),D+=j>>>13,j&=8191;let z=D+I*h+M*l+L*u+U*c+q*a;D=z>>>13,z&=8191,z+=C*(5*y)+_*(5*g)+v*(5*p)+O*(5*f)+P*(5*d),D+=z>>>13,z&=8191;let H=D+I*d+M*h+L*l+U*u+q*c;D=H>>>13,H&=8191,H+=C*a+_*(5*y)+v*(5*g)+O*(5*p)+P*(5*f),D+=H>>>13,H&=8191;let Y=D+I*f+M*d+L*h+U*l+q*u;D=Y>>>13,Y&=8191,Y+=C*c+_*a+v*(5*y)+O*(5*g)+P*(5*p),D+=Y>>>13,Y&=8191;let se=D+I*p+M*f+L*d+U*h+q*l;D=se>>>13,se&=8191,se+=C*u+_*c+v*a+O*(5*y)+P*(5*g),D+=se>>>13,se&=8191;let ee=D+I*g+M*p+L*f+U*d+q*h;D=ee>>>13,ee&=8191,ee+=C*l+_*u+v*c+O*a+P*(5*y),D+=ee>>>13,ee&=8191;let J=D+I*y+M*g+L*p+U*f+q*d;D=J>>>13,J&=8191,J+=C*h+_*l+v*u+O*c+P*a,D+=J>>>13,J&=8191,D=(D<<2)+D|0,D=D+N|0,N=D&8191,D=D>>>13,B+=D,s[0]=N,s[1]=B,s[2]=k,s[3]=j,s[4]=z,s[5]=H,s[6]=Y,s[7]=se,s[8]=ee,s[9]=J}finalize(){const{h:e,pad:i}=this,r=new Uint16Array(10);let n=e[1]>>>13;e[1]&=8191;for(let a=2;a<10;a++)e[a]+=n,n=e[a]>>>13,e[a]&=8191;e[0]+=n*5,n=e[0]>>>13,e[0]&=8191,e[1]+=n,n=e[1]>>>13,e[1]&=8191,e[2]+=n,r[0]=e[0]+5,n=r[0]>>>13,r[0]&=8191;for(let a=1;a<10;a++)r[a]=e[a]+n,n=r[a]>>>13,r[a]&=8191;r[9]-=8192;let s=(n^1)-1;for(let a=0;a<10;a++)r[a]&=s;s=~s;for(let a=0;a<10;a++)e[a]=e[a]&s|r[a];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let o=e[0]+i[0];e[0]=o&65535;for(let a=1;a<8;a++)o=(e[a]+i[a]|0)+(o>>>16)|0,e[a]=o&65535;$i(r)}update(e){za(this);const{buffer:i,blockLen:r}=this;e=xs(e);const n=e.length;for(let s=0;s<n;){const o=Math.min(r-this.pos,n-s);if(o===r){for(;r<=n-s;s+=r)this.process(e,s);continue}i.set(e.subarray(s,s+o),this.pos),this.pos+=o,s+=o,this.pos===r&&(this.process(i,0,!1),this.pos=0)}return this}destroy(){$i(this.h,this.r,this.buffer,this.pad)}digestInto(e){za(this),n1(e,this),this.finished=!0;const{buffer:i,h:r}=this;let{pos:n}=this;if(n){for(i[n++]=1;n<16;n++)i[n]=0;this.process(i,0,!0)}this.finalize();let s=0;for(let o=0;o<8;o++)e[s++]=r[o]>>>0,e[s++]=r[o]>>>8;return e}digest(){const{buffer:e,outputLen:i}=this;this.digestInto(e);const r=e.slice(0,i);return this.destroy(),r}}function v1(t){const e=(r,n)=>t(n).update(xs(r)).digest(),i=t(new Uint8Array(32));return e.outputLen=i.outputLen,e.blockLen=i.blockLen,e.create=r=>t(r),e}const E1=v1(t=>new b1(t));function _1(t,e,i,r,n,s=20){let o=t[0],a=t[1],c=t[2],u=t[3],l=e[0],h=e[1],d=e[2],f=e[3],p=e[4],g=e[5],y=e[6],m=e[7],w=n,b=i[0],E=i[1],x=i[2],S=o,$=a,A=c,I=u,M=l,L=h,U=d,q=f,C=p,_=g,v=y,O=m,P=w,D=b,N=E,B=x;for(let j=0;j<s;j+=2)S=S+M|0,P=Z(P^S,16),C=C+P|0,M=Z(M^C,12),S=S+M|0,P=Z(P^S,8),C=C+P|0,M=Z(M^C,7),$=$+L|0,D=Z(D^$,16),_=_+D|0,L=Z(L^_,12),$=$+L|0,D=Z(D^$,8),_=_+D|0,L=Z(L^_,7),A=A+U|0,N=Z(N^A,16),v=v+N|0,U=Z(U^v,12),A=A+U|0,N=Z(N^A,8),v=v+N|0,U=Z(U^v,7),I=I+q|0,B=Z(B^I,16),O=O+B|0,q=Z(q^O,12),I=I+q|0,B=Z(B^I,8),O=O+B|0,q=Z(q^O,7),S=S+L|0,B=Z(B^S,16),v=v+B|0,L=Z(L^v,12),S=S+L|0,B=Z(B^S,8),v=v+B|0,L=Z(L^v,7),$=$+U|0,P=Z(P^$,16),O=O+P|0,U=Z(U^O,12),$=$+U|0,P=Z(P^$,8),O=O+P|0,U=Z(U^O,7),A=A+q|0,D=Z(D^A,16),C=C+D|0,q=Z(q^C,12),A=A+q|0,D=Z(D^A,8),C=C+D|0,q=Z(q^C,7),I=I+M|0,N=Z(N^I,16),_=_+N|0,M=Z(M^_,12),I=I+M|0,N=Z(N^I,8),_=_+N|0,M=Z(M^_,7);let k=0;r[k++]=o+S|0,r[k++]=a+$|0,r[k++]=c+A|0,r[k++]=u+I|0,r[k++]=l+M|0,r[k++]=h+L|0,r[k++]=d+U|0,r[k++]=f+q|0,r[k++]=p+C|0,r[k++]=g+_|0,r[k++]=y+v|0,r[k++]=m+O|0,r[k++]=w+P|0,r[k++]=b+D|0,r[k++]=E+N|0,r[k++]=x+B|0}const I1=m1(_1,{counterRight:!1,counterLength:4,allowShortKeys:!1}),D1=new Uint8Array(16),Ga=(t,e)=>{t.update(e);const i=e.length%16;i&&t.update(D1.subarray(i))},S1=new Uint8Array(32);function Ya(t,e,i,r,n){const s=t(e,i,S1),o=E1.create(s);n&&Ga(o,n),Ga(o,r);const a=new Uint8Array(16),c=s1(a);Ha(c,0,BigInt(n?n.length:0),!0),Ha(c,8,BigInt(r.length),!0),o.update(a);const u=o.digest();return $i(s,a),u}const $1=t=>(e,i,r)=>({encrypt(n,s){const o=n.length;s=Ka(o+16,s,!1),s.set(n);const a=s.subarray(0,-16);t(e,i,a,a,1);const c=Ya(t,e,i,a,r);return s.set(c,o),$i(c),s},decrypt(n,s){s=Ka(n.length-16,s,!1);const o=n.subarray(0,-16),a=n.subarray(-16),c=Ya(t,e,i,o,r);if(!u1(a,c))throw new Error("invalid tag");return s.set(n.subarray(0,-16)),t(e,i,s,s,1),$i(c),s}}),Al=l1({blockSize:64,nonceLength:12,tagLength:16},$1(I1));let Pl=class extends ho{constructor(e,i){super(),this.finished=!1,this.destroyed=!1,lo(e);const r=Si(i);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const n=this.blockLen,s=new Uint8Array(n);s.set(r.length>n?e.create().update(r).digest():r);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),s.fill(0)}update(e){return Di(this),this.iHash.update(e),this}digestInto(e){Di(this),vr(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:i,iHash:r,finished:n,destroyed:s,blockLen:o,outputLen:a}=this;return e=e,e.finished=n,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=i._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const fn=(t,e,i)=>new Pl(t,e).update(i).digest();fn.create=(t,e)=>new Pl(t,e);function x1(t,e,i){return lo(t),i===void 0&&(i=new Uint8Array(t.outputLen)),fn(t,Si(i),Si(e))}const Hn=new Uint8Array([0]),Ja=new Uint8Array;function O1(t,e,i,r=32){if(lo(t),or(r),r>255*t.outputLen)throw new Error("Length should be <= 255*HashLen");const n=Math.ceil(r/t.outputLen);i===void 0&&(i=Ja);const s=new Uint8Array(n*t.outputLen),o=fn.create(t,e),a=o._cloneInto(),c=new Uint8Array(o.outputLen);for(let u=0;u<n;u++)Hn[0]=u+1,a.update(u===0?Ja:c).update(i).update(Hn).digestInto(c),s.set(c,t.outputLen*u),o._cloneInto(a);return o.destroy(),a.destroy(),c.fill(0),Hn.fill(0),s.slice(0,r)}const A1=(t,e,i,r,n)=>O1(t,x1(t,e,i),r,n);function P1(t,e,i,r){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,i,r);const n=BigInt(32),s=BigInt(4294967295),o=Number(i>>n&s),a=Number(i&s),c=r?4:0,u=r?0:4;t.setUint32(e+c,o,r),t.setUint32(e+u,a,r)}function C1(t,e,i){return t&e^~t&i}function R1(t,e,i){return t&e^t&i^e&i}let T1=class extends ho{constructor(e,i,r,n){super(),this.blockLen=e,this.outputLen=i,this.padOffset=r,this.isLE=n,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Vn(this.buffer)}update(e){Di(this);const{view:i,buffer:r,blockLen:n}=this;e=Si(e);const s=e.length;for(let o=0;o<s;){const a=Math.min(n-this.pos,s-o);if(a===n){const c=Vn(e);for(;n<=s-o;o+=n)this.process(c,o);continue}r.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===n&&(this.process(i,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Di(this),wl(e,this),this.finished=!0;const{buffer:i,view:r,blockLen:n,isLE:s}=this;let{pos:o}=this;i[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>n-o&&(this.process(r,0),o=0);for(let h=o;h<n;h++)i[h]=0;P1(r,n-8,BigInt(this.length*8),s),this.process(r,0);const a=Vn(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const u=c/4,l=this.get();if(u>l.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<u;h++)a.setUint32(4*h,l[h],s)}digest(){const{buffer:e,outputLen:i}=this;this.digestInto(e);const r=e.slice(0,i);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:i,buffer:r,length:n,finished:s,destroyed:o,pos:a}=this;return e.length=n,e.pos=a,e.finished=s,e.destroyed=o,n%i&&e.buffer.set(r),e}};const N1=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Ft=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Lt=new Uint32Array(64);class F1 extends T1{constructor(){super(64,32,8,!1),this.A=Ft[0]|0,this.B=Ft[1]|0,this.C=Ft[2]|0,this.D=Ft[3]|0,this.E=Ft[4]|0,this.F=Ft[5]|0,this.G=Ft[6]|0,this.H=Ft[7]|0}get(){const{A:e,B:i,C:r,D:n,E:s,F:o,G:a,H:c}=this;return[e,i,r,n,s,o,a,c]}set(e,i,r,n,s,o,a,c){this.A=e|0,this.B=i|0,this.C=r|0,this.D=n|0,this.E=s|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,i){for(let h=0;h<16;h++,i+=4)Lt[h]=e.getUint32(i,!1);for(let h=16;h<64;h++){const d=Lt[h-15],f=Lt[h-2],p=ut(d,7)^ut(d,18)^d>>>3,g=ut(f,17)^ut(f,19)^f>>>10;Lt[h]=g+Lt[h-7]+p+Lt[h-16]|0}let{A:r,B:n,C:s,D:o,E:a,F:c,G:u,H:l}=this;for(let h=0;h<64;h++){const d=ut(a,6)^ut(a,11)^ut(a,25),f=l+d+C1(a,c,u)+N1[h]+Lt[h]|0,p=(ut(r,2)^ut(r,13)^ut(r,22))+R1(r,n,s)|0;l=u,u=c,c=a,a=o+f|0,o=s,s=n,n=r,r=f+p|0}r=r+this.A|0,n=n+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,u=u+this.G|0,l=l+this.H|0,this.set(r,n,s,o,a,c,u,l)}roundClean(){Lt.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}const Er=ml(()=>new F1);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const gn=BigInt(0),yn=BigInt(1),L1=BigInt(2);function ni(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function _r(t){if(!ni(t))throw new Error("Uint8Array expected")}function xi(t,e){if(typeof e!="boolean")throw new Error(t+" boolean expected, got "+e)}const B1=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function Oi(t){_r(t);let e="";for(let i=0;i<t.length;i++)e+=B1[t[i]];return e}function Ei(t){const e=t.toString(16);return e.length&1?"0"+e:e}function fo(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?gn:BigInt("0x"+t)}const Dt={_0:48,_9:57,A:65,F:70,a:97,f:102};function Za(t){if(t>=Dt._0&&t<=Dt._9)return t-Dt._0;if(t>=Dt.A&&t<=Dt.F)return t-(Dt.A-10);if(t>=Dt.a&&t<=Dt.f)return t-(Dt.a-10)}function Ai(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length,i=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const r=new Uint8Array(i);for(let n=0,s=0;n<i;n++,s+=2){const o=Za(t.charCodeAt(s)),a=Za(t.charCodeAt(s+1));if(o===void 0||a===void 0){const c=t[s]+t[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}r[n]=o*16+a}return r}function ei(t){return fo(Oi(t))}function cr(t){return _r(t),fo(Oi(Uint8Array.from(t).reverse()))}function Pi(t,e){return Ai(t.toString(16).padStart(e*2,"0"))}function wn(t,e){return Pi(t,e).reverse()}function U1(t){return Ai(Ei(t))}function Ke(t,e,i){let r;if(typeof e=="string")try{r=Ai(e)}catch(s){throw new Error(t+" must be hex string or Uint8Array, cause: "+s)}else if(ni(e))r=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const n=r.length;if(typeof i=="number"&&n!==i)throw new Error(t+" of length "+i+" expected, got "+n);return r}function ur(...t){let e=0;for(let r=0;r<t.length;r++){const n=t[r];_r(n),e+=n.length}const i=new Uint8Array(e);for(let r=0,n=0;r<t.length;r++){const s=t[r];i.set(s,n),n+=s.length}return i}function k1(t,e){if(t.length!==e.length)return!1;let i=0;for(let r=0;r<t.length;r++)i|=t[r]^e[r];return i===0}function M1(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}const Wn=t=>typeof t=="bigint"&&gn<=t;function mn(t,e,i){return Wn(t)&&Wn(e)&&Wn(i)&&e<=t&&t<i}function Ct(t,e,i,r){if(!mn(e,i,r))throw new Error("expected valid "+t+": "+i+" <= n < "+r+", got "+e)}function Cl(t){let e;for(e=0;t>gn;t>>=yn,e+=1);return e}function q1(t,e){return t>>BigInt(e)&yn}function j1(t,e,i){return t|(i?yn:gn)<<BigInt(e)}const go=t=>(L1<<BigInt(t-1))-yn,Gn=t=>new Uint8Array(t),Qa=t=>Uint8Array.from(t);function Rl(t,e,i){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof i!="function")throw new Error("hmacFn must be a function");let r=Gn(t),n=Gn(t),s=0;const o=()=>{r.fill(1),n.fill(0),s=0},a=(...l)=>i(n,r,...l),c=(l=Gn())=>{n=a(Qa([0]),l),r=a(),l.length!==0&&(n=a(Qa([1]),l),r=a())},u=()=>{if(s++>=1e3)throw new Error("drbg: tried 1000 values");let l=0;const h=[];for(;l<e;){r=a();const d=r.slice();h.push(d),l+=r.length}return ur(...h)};return(l,h)=>{o(),c(l);let d;for(;!(d=h(u()));)c();return o(),d}}const z1={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||ni(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function Bi(t,e,i={}){const r=(n,s,o)=>{const a=z1[s];if(typeof a!="function")throw new Error("invalid validator function");const c=t[n];if(!(o&&c===void 0)&&!a(c,t))throw new Error("param "+String(n)+" is invalid. Expected "+s+", got "+c)};for(const[n,s]of Object.entries(e))r(n,s,!1);for(const[n,s]of Object.entries(i))r(n,s,!0);return t}const V1=()=>{throw new Error("not implemented")};function Ps(t){const e=new WeakMap;return(i,...r)=>{const n=e.get(i);if(n!==void 0)return n;const s=t(i,...r);return e.set(i,s),s}}var K1=Object.freeze({__proto__:null,isBytes:ni,abytes:_r,abool:xi,bytesToHex:Oi,numberToHexUnpadded:Ei,hexToNumber:fo,hexToBytes:Ai,bytesToNumberBE:ei,bytesToNumberLE:cr,numberToBytesBE:Pi,numberToBytesLE:wn,numberToVarBytesBE:U1,ensureBytes:Ke,concatBytes:ur,equalBytes:k1,utf8ToBytes:M1,inRange:mn,aInRange:Ct,bitLen:Cl,bitGet:q1,bitSet:j1,bitMask:go,createHmacDrbg:Rl,validateObject:Bi,notImplemented:V1,memoized:Ps});const Ee=BigInt(0),le=BigInt(1),Yt=BigInt(2),H1=BigInt(3),Cs=BigInt(4),Xa=BigInt(5),ec=BigInt(8);function Me(t,e){const i=t%e;return i>=Ee?i:e+i}function Tl(t,e,i){if(e<Ee)throw new Error("invalid exponent, negatives unsupported");if(i<=Ee)throw new Error("invalid modulus");if(i===le)return Ee;let r=le;for(;e>Ee;)e&le&&(r=r*t%i),t=t*t%i,e>>=le;return r}function nt(t,e,i){let r=t;for(;e-- >Ee;)r*=r,r%=i;return r}function Rs(t,e){if(t===Ee)throw new Error("invert: expected non-zero number");if(e<=Ee)throw new Error("invert: expected positive modulus, got "+e);let i=Me(t,e),r=e,n=Ee,s=le;for(;i!==Ee;){const o=r/i,a=r%i,c=n-s*o;r=i,i=a,n=s,s=c}if(r!==le)throw new Error("invert: does not exist");return Me(n,e)}function W1(t){const e=(t-le)/Yt;let i,r,n;for(i=t-le,r=0;i%Yt===Ee;i/=Yt,r++);for(n=Yt;n<t&&Tl(n,e,t)!==t-le;n++)if(n>1e3)throw new Error("Cannot find square root: likely non-prime P");if(r===1){const o=(t+le)/Cs;return function(a,c){const u=a.pow(c,o);if(!a.eql(a.sqr(u),c))throw new Error("Cannot find square root");return u}}const s=(i+le)/Yt;return function(o,a){if(o.pow(a,e)===o.neg(o.ONE))throw new Error("Cannot find square root");let c=r,u=o.pow(o.mul(o.ONE,n),i),l=o.pow(a,s),h=o.pow(a,i);for(;!o.eql(h,o.ONE);){if(o.eql(h,o.ZERO))return o.ZERO;let d=1;for(let p=o.sqr(h);d<c&&!o.eql(p,o.ONE);d++)p=o.sqr(p);const f=o.pow(u,le<<BigInt(c-d-1));u=o.sqr(f),l=o.mul(l,f),h=o.mul(h,u),c=d}return l}}function G1(t){if(t%Cs===H1){const e=(t+le)/Cs;return function(i,r){const n=i.pow(r,e);if(!i.eql(i.sqr(n),r))throw new Error("Cannot find square root");return n}}if(t%ec===Xa){const e=(t-Xa)/ec;return function(i,r){const n=i.mul(r,Yt),s=i.pow(n,e),o=i.mul(r,s),a=i.mul(i.mul(o,Yt),s),c=i.mul(o,i.sub(a,i.ONE));if(!i.eql(i.sqr(c),r))throw new Error("Cannot find square root");return c}}return W1(t)}const Y1=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function J1(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},i=Y1.reduce((r,n)=>(r[n]="function",r),e);return Bi(t,i)}function Z1(t,e,i){if(i<Ee)throw new Error("invalid exponent, negatives unsupported");if(i===Ee)return t.ONE;if(i===le)return e;let r=t.ONE,n=e;for(;i>Ee;)i&le&&(r=t.mul(r,n)),n=t.sqr(n),i>>=le;return r}function Q1(t,e){const i=new Array(e.length),r=e.reduce((s,o,a)=>t.is0(o)?s:(i[a]=s,t.mul(s,o)),t.ONE),n=t.inv(r);return e.reduceRight((s,o,a)=>t.is0(o)?s:(i[a]=t.mul(s,i[a]),t.mul(s,o)),n),i}function Nl(t,e){const i=e!==void 0?e:t.toString(2).length,r=Math.ceil(i/8);return{nBitLength:i,nByteLength:r}}function Fl(t,e,i=!1,r={}){if(t<=Ee)throw new Error("invalid field: expected ORDER > 0, got "+t);const{nBitLength:n,nByteLength:s}=Nl(t,e);if(s>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:t,isLE:i,BITS:n,BYTES:s,MASK:go(n),ZERO:Ee,ONE:le,create:c=>Me(c,t),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return Ee<=c&&c<t},is0:c=>c===Ee,isOdd:c=>(c&le)===le,neg:c=>Me(-c,t),eql:(c,u)=>c===u,sqr:c=>Me(c*c,t),add:(c,u)=>Me(c+u,t),sub:(c,u)=>Me(c-u,t),mul:(c,u)=>Me(c*u,t),pow:(c,u)=>Z1(a,c,u),div:(c,u)=>Me(c*Rs(u,t),t),sqrN:c=>c*c,addN:(c,u)=>c+u,subN:(c,u)=>c-u,mulN:(c,u)=>c*u,inv:c=>Rs(c,t),sqrt:r.sqrt||(c=>(o||(o=G1(t)),o(a,c))),invertBatch:c=>Q1(a,c),cmov:(c,u,l)=>l?u:c,toBytes:c=>i?wn(c,s):Pi(c,s),fromBytes:c=>{if(c.length!==s)throw new Error("Field.fromBytes: expected "+s+" bytes, got "+c.length);return i?cr(c):ei(c)}});return Object.freeze(a)}function Ll(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function Bl(t){const e=Ll(t);return e+Math.ceil(e/2)}function X1(t,e,i=!1){const r=t.length,n=Ll(e),s=Bl(e);if(r<16||r<s||r>1024)throw new Error("expected "+s+"-1024 bytes of input, got "+r);const o=i?cr(t):ei(t),a=Me(o,e-le)+le;return i?wn(a,n):Pi(a,n)}const tc=BigInt(0),Lr=BigInt(1);function Yn(t,e){const i=e.negate();return t?i:e}function Ul(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function Jn(t,e){Ul(t,e);const i=Math.ceil(e/t)+1,r=2**(t-1);return{windows:i,windowSize:r}}function e0(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((i,r)=>{if(!(i instanceof e))throw new Error("invalid point at index "+r)})}function t0(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((i,r)=>{if(!e.isValid(i))throw new Error("invalid scalar at index "+r)})}const Zn=new WeakMap,kl=new WeakMap;function Qn(t){return kl.get(t)||1}function i0(t,e){return{constTimeNegate:Yn,hasPrecomputes(i){return Qn(i)!==1},unsafeLadder(i,r,n=t.ZERO){let s=i;for(;r>tc;)r&Lr&&(n=n.add(s)),s=s.double(),r>>=Lr;return n},precomputeWindow(i,r){const{windows:n,windowSize:s}=Jn(r,e),o=[];let a=i,c=a;for(let u=0;u<n;u++){c=a,o.push(c);for(let l=1;l<s;l++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(i,r,n){const{windows:s,windowSize:o}=Jn(i,e);let a=t.ZERO,c=t.BASE;const u=BigInt(2**i-1),l=2**i,h=BigInt(i);for(let d=0;d<s;d++){const f=d*o;let p=Number(n&u);n>>=h,p>o&&(p-=l,n+=Lr);const g=f,y=f+Math.abs(p)-1,m=d%2!==0,w=p<0;p===0?c=c.add(Yn(m,r[g])):a=a.add(Yn(w,r[y]))}return{p:a,f:c}},wNAFUnsafe(i,r,n,s=t.ZERO){const{windows:o,windowSize:a}=Jn(i,e),c=BigInt(2**i-1),u=2**i,l=BigInt(i);for(let h=0;h<o;h++){const d=h*a;if(n===tc)break;let f=Number(n&c);if(n>>=l,f>a&&(f-=u,n+=Lr),f===0)continue;let p=r[d+Math.abs(f)-1];f<0&&(p=p.negate()),s=s.add(p)}return s},getPrecomputes(i,r,n){let s=Zn.get(r);return s||(s=this.precomputeWindow(r,i),i!==1&&Zn.set(r,n(s))),s},wNAFCached(i,r,n){const s=Qn(i);return this.wNAF(s,this.getPrecomputes(s,i,n),r)},wNAFCachedUnsafe(i,r,n,s){const o=Qn(i);return o===1?this.unsafeLadder(i,r,s):this.wNAFUnsafe(o,this.getPrecomputes(o,i,n),r,s)},setWindowSize(i,r){Ul(r,e),kl.set(i,r),Zn.delete(i)}}}function r0(t,e,i,r){if(e0(i,t),t0(r,e),i.length!==r.length)throw new Error("arrays of points and scalars must have equal length");const n=t.ZERO,s=Cl(BigInt(i.length)),o=s>12?s-3:s>4?s-2:s?2:1,a=(1<<o)-1,c=new Array(a+1).fill(n),u=Math.floor((e.BITS-1)/o)*o;let l=n;for(let h=u;h>=0;h-=o){c.fill(n);for(let f=0;f<r.length;f++){const p=r[f],g=Number(p>>BigInt(h)&BigInt(a));c[g]=c[g].add(i[f])}let d=n;for(let f=c.length-1,p=n;f>0;f--)p=p.add(c[f]),d=d.add(p);if(l=l.add(d),h!==0)for(let f=0;f<o;f++)l=l.double()}return l}function Ml(t){return J1(t.Fp),Bi(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...Nl(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}BigInt(0),BigInt(1),BigInt(2),BigInt(8);const wi=BigInt(0),Xn=BigInt(1);function n0(t){return Bi(t,{a:"bigint"},{montgomeryBits:"isSafeInteger",nByteLength:"isSafeInteger",adjustScalarBytes:"function",domain:"function",powPminus2:"function",Gu:"bigint"}),Object.freeze({...t})}function s0(t){const e=n0(t),{P:i}=e,r=w=>Me(w,i),n=e.montgomeryBits,s=Math.ceil(n/8),o=e.nByteLength,a=e.adjustScalarBytes||(w=>w),c=e.powPminus2||(w=>Tl(w,i-BigInt(2),i));function u(w,b,E){const x=r(w*(b-E));return b=r(b-x),E=r(E+x),[b,E]}const l=(e.a-BigInt(2))/BigInt(4);function h(w,b){Ct("u",w,wi,i),Ct("scalar",b,wi,i);const E=b,x=w;let S=Xn,$=wi,A=w,I=Xn,M=wi,L;for(let q=BigInt(n-1);q>=wi;q--){const C=E>>q&Xn;M^=C,L=u(M,S,A),S=L[0],A=L[1],L=u(M,$,I),$=L[0],I=L[1],M=C;const _=S+$,v=r(_*_),O=S-$,P=r(O*O),D=v-P,N=A+I,B=A-I,k=r(B*_),j=r(N*O),z=k+j,H=k-j;A=r(z*z),I=r(x*r(H*H)),S=r(v*P),$=r(D*(v+r(l*D)))}L=u(M,S,A),S=L[0],A=L[1],L=u(M,$,I),$=L[0],I=L[1];const U=c($);return r(S*U)}function d(w){return wn(r(w),s)}function f(w){const b=Ke("u coordinate",w,s);return o===32&&(b[31]&=127),cr(b)}function p(w){const b=Ke("scalar",w),E=b.length;if(E!==s&&E!==o){let x=""+s+" or "+o;throw new Error("invalid scalar, expected "+x+" bytes, got "+E)}return cr(a(b))}function g(w,b){const E=f(b),x=p(w),S=h(E,x);if(S===wi)throw new Error("invalid private or public key received");return d(S)}const y=d(e.Gu);function m(w){return g(w,y)}return{scalarMult:g,scalarMultBase:m,getSharedSecret:(w,b)=>g(w,b),getPublicKey:w=>m(w),utils:{randomPrivateKey:()=>e.randomBytes(e.nByteLength)},GuBytes:y}}const Ts=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949");BigInt(0);const o0=BigInt(1),ic=BigInt(2),a0=BigInt(3),c0=BigInt(5);BigInt(8);function u0(t){const e=BigInt(10),i=BigInt(20),r=BigInt(40),n=BigInt(80),s=Ts,o=t*t%s*t%s,a=nt(o,ic,s)*o%s,c=nt(a,o0,s)*t%s,u=nt(c,c0,s)*c%s,l=nt(u,e,s)*u%s,h=nt(l,i,s)*l%s,d=nt(h,r,s)*h%s,f=nt(d,n,s)*d%s,p=nt(f,n,s)*d%s,g=nt(p,e,s)*u%s;return{pow_p_5_8:nt(g,ic,s)*t%s,b2:o}}function l0(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}const Ns=s0({P:Ts,a:BigInt(486662),montgomeryBits:255,nByteLength:32,Gu:BigInt(9),powPminus2:t=>{const e=Ts,{pow_p_5_8:i,b2:r}=u0(t);return Me(nt(i,a0,e)*r,e)},adjustScalarBytes:l0,randomBytes:Li});function rc(t){t.lowS!==void 0&&xi("lowS",t.lowS),t.prehash!==void 0&&xi("prehash",t.prehash)}function h0(t){const e=Ml(t);Bi(e,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:i,Fp:r,a:n}=e;if(i){if(!r.eql(n,r.ZERO))throw new Error("invalid endomorphism, can only be defined for Koblitz curves that have a=0");if(typeof i!="object"||typeof i.beta!="bigint"||typeof i.splitScalar!="function")throw new Error("invalid endomorphism, expected beta: bigint and splitScalar: function")}return Object.freeze({...e})}const{bytesToNumberBE:d0,hexToBytes:p0}=K1;class f0 extends Error{constructor(e=""){super(e)}}const At={Err:f0,_tlv:{encode:(t,e)=>{const{Err:i}=At;if(t<0||t>256)throw new i("tlv.encode: wrong tag");if(e.length&1)throw new i("tlv.encode: unpadded data");const r=e.length/2,n=Ei(r);if(n.length/2&128)throw new i("tlv.encode: long form length too big");const s=r>127?Ei(n.length/2|128):"";return Ei(t)+s+n+e},decode(t,e){const{Err:i}=At;let r=0;if(t<0||t>256)throw new i("tlv.encode: wrong tag");if(e.length<2||e[r++]!==t)throw new i("tlv.decode: wrong tlv");const n=e[r++],s=!!(n&128);let o=0;if(!s)o=n;else{const c=n&127;if(!c)throw new i("tlv.decode(long): indefinite length not supported");if(c>4)throw new i("tlv.decode(long): byte length is too big");const u=e.subarray(r,r+c);if(u.length!==c)throw new i("tlv.decode: length bytes not complete");if(u[0]===0)throw new i("tlv.decode(long): zero leftmost byte");for(const l of u)o=o<<8|l;if(r+=c,o<128)throw new i("tlv.decode(long): not minimal encoding")}const a=e.subarray(r,r+o);if(a.length!==o)throw new i("tlv.decode: wrong value length");return{v:a,l:e.subarray(r+o)}}},_int:{encode(t){const{Err:e}=At;if(t<Pt)throw new e("integer: negative integers are not allowed");let i=Ei(t);if(Number.parseInt(i[0],16)&8&&(i="00"+i),i.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return i},decode(t){const{Err:e}=At;if(t[0]&128)throw new e("invalid signature integer: negative");if(t[0]===0&&!(t[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return d0(t)}},toSig(t){const{Err:e,_int:i,_tlv:r}=At,n=typeof t=="string"?p0(t):t;_r(n);const{v:s,l:o}=r.decode(48,n);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:c}=r.decode(2,s),{v:u,l}=r.decode(2,c);if(l.length)throw new e("invalid signature: left bytes after parsing");return{r:i.decode(a),s:i.decode(u)}},hexFromSig(t){const{_tlv:e,_int:i}=At,r=e.encode(2,i.encode(t.r)),n=e.encode(2,i.encode(t.s)),s=r+n;return e.encode(48,s)}},Pt=BigInt(0),me=BigInt(1);BigInt(2);const nc=BigInt(3);BigInt(4);function g0(t){const e=h0(t),{Fp:i}=e,r=Fl(e.n,e.nBitLength),n=e.toBytes||((g,y,m)=>{const w=y.toAffine();return ur(Uint8Array.from([4]),i.toBytes(w.x),i.toBytes(w.y))}),s=e.fromBytes||(g=>{const y=g.subarray(1),m=i.fromBytes(y.subarray(0,i.BYTES)),w=i.fromBytes(y.subarray(i.BYTES,2*i.BYTES));return{x:m,y:w}});function o(g){const{a:y,b:m}=e,w=i.sqr(g),b=i.mul(w,g);return i.add(i.add(b,i.mul(g,y)),m)}if(!i.eql(i.sqr(e.Gy),o(e.Gx)))throw new Error("bad generator point: equation left != right");function a(g){return mn(g,me,e.n)}function c(g){const{allowedPrivateKeyLengths:y,nByteLength:m,wrapPrivateKey:w,n:b}=e;if(y&&typeof g!="bigint"){if(ni(g)&&(g=Oi(g)),typeof g!="string"||!y.includes(g.length))throw new Error("invalid private key");g=g.padStart(m*2,"0")}let E;try{E=typeof g=="bigint"?g:ei(Ke("private key",g,m))}catch{throw new Error("invalid private key, expected hex or "+m+" bytes, got "+typeof g)}return w&&(E=Me(E,b)),Ct("private key",E,me,b),E}function u(g){if(!(g instanceof d))throw new Error("ProjectivePoint expected")}const l=Ps((g,y)=>{const{px:m,py:w,pz:b}=g;if(i.eql(b,i.ONE))return{x:m,y:w};const E=g.is0();y==null&&(y=E?i.ONE:i.inv(b));const x=i.mul(m,y),S=i.mul(w,y),$=i.mul(b,y);if(E)return{x:i.ZERO,y:i.ZERO};if(!i.eql($,i.ONE))throw new Error("invZ was invalid");return{x,y:S}}),h=Ps(g=>{if(g.is0()){if(e.allowInfinityPoint&&!i.is0(g.py))return;throw new Error("bad point: ZERO")}const{x:y,y:m}=g.toAffine();if(!i.isValid(y)||!i.isValid(m))throw new Error("bad point: x or y not FE");const w=i.sqr(m),b=o(y);if(!i.eql(w,b))throw new Error("bad point: equation left != right");if(!g.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});class d{constructor(y,m,w){if(this.px=y,this.py=m,this.pz=w,y==null||!i.isValid(y))throw new Error("x required");if(m==null||!i.isValid(m))throw new Error("y required");if(w==null||!i.isValid(w))throw new Error("z required");Object.freeze(this)}static fromAffine(y){const{x:m,y:w}=y||{};if(!y||!i.isValid(m)||!i.isValid(w))throw new Error("invalid affine point");if(y instanceof d)throw new Error("projective point not allowed");const b=E=>i.eql(E,i.ZERO);return b(m)&&b(w)?d.ZERO:new d(m,w,i.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(y){const m=i.invertBatch(y.map(w=>w.pz));return y.map((w,b)=>w.toAffine(m[b])).map(d.fromAffine)}static fromHex(y){const m=d.fromAffine(s(Ke("pointHex",y)));return m.assertValidity(),m}static fromPrivateKey(y){return d.BASE.multiply(c(y))}static msm(y,m){return r0(d,r,y,m)}_setWindowSize(y){p.setWindowSize(this,y)}assertValidity(){h(this)}hasEvenY(){const{y}=this.toAffine();if(i.isOdd)return!i.isOdd(y);throw new Error("Field doesn't support isOdd")}equals(y){u(y);const{px:m,py:w,pz:b}=this,{px:E,py:x,pz:S}=y,$=i.eql(i.mul(m,S),i.mul(E,b)),A=i.eql(i.mul(w,S),i.mul(x,b));return $&&A}negate(){return new d(this.px,i.neg(this.py),this.pz)}double(){const{a:y,b:m}=e,w=i.mul(m,nc),{px:b,py:E,pz:x}=this;let S=i.ZERO,$=i.ZERO,A=i.ZERO,I=i.mul(b,b),M=i.mul(E,E),L=i.mul(x,x),U=i.mul(b,E);return U=i.add(U,U),A=i.mul(b,x),A=i.add(A,A),S=i.mul(y,A),$=i.mul(w,L),$=i.add(S,$),S=i.sub(M,$),$=i.add(M,$),$=i.mul(S,$),S=i.mul(U,S),A=i.mul(w,A),L=i.mul(y,L),U=i.sub(I,L),U=i.mul(y,U),U=i.add(U,A),A=i.add(I,I),I=i.add(A,I),I=i.add(I,L),I=i.mul(I,U),$=i.add($,I),L=i.mul(E,x),L=i.add(L,L),I=i.mul(L,U),S=i.sub(S,I),A=i.mul(L,M),A=i.add(A,A),A=i.add(A,A),new d(S,$,A)}add(y){u(y);const{px:m,py:w,pz:b}=this,{px:E,py:x,pz:S}=y;let $=i.ZERO,A=i.ZERO,I=i.ZERO;const M=e.a,L=i.mul(e.b,nc);let U=i.mul(m,E),q=i.mul(w,x),C=i.mul(b,S),_=i.add(m,w),v=i.add(E,x);_=i.mul(_,v),v=i.add(U,q),_=i.sub(_,v),v=i.add(m,b);let O=i.add(E,S);return v=i.mul(v,O),O=i.add(U,C),v=i.sub(v,O),O=i.add(w,b),$=i.add(x,S),O=i.mul(O,$),$=i.add(q,C),O=i.sub(O,$),I=i.mul(M,v),$=i.mul(L,C),I=i.add($,I),$=i.sub(q,I),I=i.add(q,I),A=i.mul($,I),q=i.add(U,U),q=i.add(q,U),C=i.mul(M,C),v=i.mul(L,v),q=i.add(q,C),C=i.sub(U,C),C=i.mul(M,C),v=i.add(v,C),U=i.mul(q,v),A=i.add(A,U),U=i.mul(O,v),$=i.mul(_,$),$=i.sub($,U),U=i.mul(_,q),I=i.mul(O,I),I=i.add(I,U),new d($,A,I)}subtract(y){return this.add(y.negate())}is0(){return this.equals(d.ZERO)}wNAF(y){return p.wNAFCached(this,y,d.normalizeZ)}multiplyUnsafe(y){const{endo:m,n:w}=e;Ct("scalar",y,Pt,w);const b=d.ZERO;if(y===Pt)return b;if(this.is0()||y===me)return this;if(!m||p.hasPrecomputes(this))return p.wNAFCachedUnsafe(this,y,d.normalizeZ);let{k1neg:E,k1:x,k2neg:S,k2:$}=m.splitScalar(y),A=b,I=b,M=this;for(;x>Pt||$>Pt;)x&me&&(A=A.add(M)),$&me&&(I=I.add(M)),M=M.double(),x>>=me,$>>=me;return E&&(A=A.negate()),S&&(I=I.negate()),I=new d(i.mul(I.px,m.beta),I.py,I.pz),A.add(I)}multiply(y){const{endo:m,n:w}=e;Ct("scalar",y,me,w);let b,E;if(m){const{k1neg:x,k1:S,k2neg:$,k2:A}=m.splitScalar(y);let{p:I,f:M}=this.wNAF(S),{p:L,f:U}=this.wNAF(A);I=p.constTimeNegate(x,I),L=p.constTimeNegate($,L),L=new d(i.mul(L.px,m.beta),L.py,L.pz),b=I.add(L),E=M.add(U)}else{const{p:x,f:S}=this.wNAF(y);b=x,E=S}return d.normalizeZ([b,E])[0]}multiplyAndAddUnsafe(y,m,w){const b=d.BASE,E=(S,$)=>$===Pt||$===me||!S.equals(b)?S.multiplyUnsafe($):S.multiply($),x=E(this,m).add(E(y,w));return x.is0()?void 0:x}toAffine(y){return l(this,y)}isTorsionFree(){const{h:y,isTorsionFree:m}=e;if(y===me)return!0;if(m)return m(d,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:y,clearCofactor:m}=e;return y===me?this:m?m(d,this):this.multiplyUnsafe(e.h)}toRawBytes(y=!0){return xi("isCompressed",y),this.assertValidity(),n(d,this,y)}toHex(y=!0){return xi("isCompressed",y),Oi(this.toRawBytes(y))}}d.BASE=new d(e.Gx,e.Gy,i.ONE),d.ZERO=new d(i.ZERO,i.ONE,i.ZERO);const f=e.nBitLength,p=i0(d,e.endo?Math.ceil(f/2):f);return{CURVE:e,ProjectivePoint:d,normPrivateKeyToScalar:c,weierstrassEquation:o,isWithinCurveOrder:a}}function y0(t){const e=Ml(t);return Bi(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}function w0(t){const e=y0(t),{Fp:i,n:r}=e,n=i.BYTES+1,s=2*i.BYTES+1;function o(C){return Me(C,r)}function a(C){return Rs(C,r)}const{ProjectivePoint:c,normPrivateKeyToScalar:u,weierstrassEquation:l,isWithinCurveOrder:h}=g0({...e,toBytes(C,_,v){const O=_.toAffine(),P=i.toBytes(O.x),D=ur;return xi("isCompressed",v),v?D(Uint8Array.from([_.hasEvenY()?2:3]),P):D(Uint8Array.from([4]),P,i.toBytes(O.y))},fromBytes(C){const _=C.length,v=C[0],O=C.subarray(1);if(_===n&&(v===2||v===3)){const P=ei(O);if(!mn(P,me,i.ORDER))throw new Error("Point is not on curve");const D=l(P);let N;try{N=i.sqrt(D)}catch(k){const j=k instanceof Error?": "+k.message:"";throw new Error("Point is not on curve"+j)}const B=(N&me)===me;return(v&1)===1!==B&&(N=i.neg(N)),{x:P,y:N}}else if(_===s&&v===4){const P=i.fromBytes(O.subarray(0,i.BYTES)),D=i.fromBytes(O.subarray(i.BYTES,2*i.BYTES));return{x:P,y:D}}else{const P=n,D=s;throw new Error("invalid Point, expected length of "+P+", or uncompressed "+D+", got "+_)}}}),d=C=>Oi(Pi(C,e.nByteLength));function f(C){const _=r>>me;return C>_}function p(C){return f(C)?o(-C):C}const g=(C,_,v)=>ei(C.slice(_,v));class y{constructor(_,v,O){this.r=_,this.s=v,this.recovery=O,this.assertValidity()}static fromCompact(_){const v=e.nByteLength;return _=Ke("compactSignature",_,v*2),new y(g(_,0,v),g(_,v,2*v))}static fromDER(_){const{r:v,s:O}=At.toSig(Ke("DER",_));return new y(v,O)}assertValidity(){Ct("r",this.r,me,r),Ct("s",this.s,me,r)}addRecoveryBit(_){return new y(this.r,this.s,_)}recoverPublicKey(_){const{r:v,s:O,recovery:P}=this,D=S(Ke("msgHash",_));if(P==null||![0,1,2,3].includes(P))throw new Error("recovery id invalid");const N=P===2||P===3?v+e.n:v;if(N>=i.ORDER)throw new Error("recovery id 2 or 3 invalid");const B=P&1?"03":"02",k=c.fromHex(B+d(N)),j=a(N),z=o(-D*j),H=o(O*j),Y=c.BASE.multiplyAndAddUnsafe(k,z,H);if(!Y)throw new Error("point at infinify");return Y.assertValidity(),Y}hasHighS(){return f(this.s)}normalizeS(){return this.hasHighS()?new y(this.r,o(-this.s),this.recovery):this}toDERRawBytes(){return Ai(this.toDERHex())}toDERHex(){return At.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return Ai(this.toCompactHex())}toCompactHex(){return d(this.r)+d(this.s)}}const m={isValidPrivateKey(C){try{return u(C),!0}catch{return!1}},normPrivateKeyToScalar:u,randomPrivateKey:()=>{const C=Bl(e.n);return X1(e.randomBytes(C),e.n)},precompute(C=8,_=c.BASE){return _._setWindowSize(C),_.multiply(BigInt(3)),_}};function w(C,_=!0){return c.fromPrivateKey(C).toRawBytes(_)}function b(C){const _=ni(C),v=typeof C=="string",O=(_||v)&&C.length;return _?O===n||O===s:v?O===2*n||O===2*s:C instanceof c}function E(C,_,v=!0){if(b(C))throw new Error("first arg must be private key");if(!b(_))throw new Error("second arg must be public key");return c.fromHex(_).multiply(u(C)).toRawBytes(v)}const x=e.bits2int||function(C){if(C.length>8192)throw new Error("input is too large");const _=ei(C),v=C.length*8-e.nBitLength;return v>0?_>>BigInt(v):_},S=e.bits2int_modN||function(C){return o(x(C))},$=go(e.nBitLength);function A(C){return Ct("num < 2^"+e.nBitLength,C,Pt,$),Pi(C,e.nByteLength)}function I(C,_,v=M){if(["recovered","canonical"].some(ee=>ee in v))throw new Error("sign() legacy options not supported");const{hash:O,randomBytes:P}=e;let{lowS:D,prehash:N,extraEntropy:B}=v;D==null&&(D=!0),C=Ke("msgHash",C),rc(v),N&&(C=Ke("prehashed msgHash",O(C)));const k=S(C),j=u(_),z=[A(j),A(k)];if(B!=null&&B!==!1){const ee=B===!0?P(i.BYTES):B;z.push(Ke("extraEntropy",ee))}const H=ur(...z),Y=k;function se(ee){const J=x(ee);if(!h(J))return;const Pe=a(J),_e=c.BASE.multiply(J).toAffine(),Re=o(_e.x);if(Re===Pt)return;const Ye=o(Pe*o(Y+Re*j));if(Ye===Pt)return;let vt=(_e.x===Re?0:2)|Number(_e.y&me),li=Ye;return D&&f(Ye)&&(li=p(Ye),vt^=1),new y(Re,li,vt)}return{seed:H,k2sig:se}}const M={lowS:e.lowS,prehash:!1},L={lowS:e.lowS,prehash:!1};function U(C,_,v=M){const{seed:O,k2sig:P}=I(C,_,v),D=e;return Rl(D.hash.outputLen,D.nByteLength,D.hmac)(O,P)}c.BASE._setWindowSize(8);function q(C,_,v,O=L){const P=C;_=Ke("msgHash",_),v=Ke("publicKey",v);const{lowS:D,prehash:N,format:B}=O;if(rc(O),"strict"in O)throw new Error("options.strict was renamed to lowS");if(B!==void 0&&B!=="compact"&&B!=="der")throw new Error("format must be compact or der");const k=typeof P=="string"||ni(P),j=!k&&!B&&typeof P=="object"&&P!==null&&typeof P.r=="bigint"&&typeof P.s=="bigint";if(!k&&!j)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let z,H;try{if(j&&(z=new y(P.r,P.s)),k){try{B!=="compact"&&(z=y.fromDER(P))}catch(Ye){if(!(Ye instanceof At.Err))throw Ye}!z&&B!=="der"&&(z=y.fromCompact(P))}H=c.fromHex(v)}catch{return!1}if(!z||D&&z.hasHighS())return!1;N&&(_=e.hash(_));const{r:Y,s:se}=z,ee=S(_),J=a(se),Pe=o(ee*J),_e=o(Y*J),Re=c.BASE.multiplyAndAddUnsafe(H,Pe,_e)?.toAffine();return Re?o(Re.x)===Y:!1}return{CURVE:e,getPublicKey:w,getSharedSecret:E,sign:U,verify:q,ProjectivePoint:c,Signature:y,utils:m}}function m0(t){return{hash:t,hmac:(e,...i)=>fn(t,e,_b(...i)),randomBytes:Li}}function b0(t,e){const i=r=>w0({...t,...m0(r)});return{...i(e),create:i}}const ql=Fl(BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff")),v0=ql.create(BigInt("-3")),E0=BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"),_0=b0({a:v0,b:E0,Fp:ql,n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5"),h:BigInt(1),lowS:!1},Er),jl="base10",Ne="base16",at="base64pad",Ut="base64url",Ir="utf8",zl=0,Rt=1,Dr=2,I0=0,sc=1,Qi=12,yo=32;function D0(){const t=Ns.utils.randomPrivateKey(),e=Ns.getPublicKey(t);return{privateKey:qe(t,Ne),publicKey:qe(e,Ne)}}function Fs(){const t=Li(yo);return qe(t,Ne)}function S0(t,e){const i=Ns.getSharedSecret(Xe(t,Ne),Xe(e,Ne)),r=A1(Er,i,void 0,void 0,yo);return qe(r,Ne)}function Kr(t){const e=Er(Xe(t,Ne));return qe(e,Ne)}function wt(t){const e=Er(Xe(t,Ir));return qe(e,Ne)}function Vl(t){return Xe(`${t}`,jl)}function si(t){return Number(qe(t,jl))}function Kl(t){return t.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function Hl(t){const e=t.replace(/-/g,"+").replace(/_/g,"/"),i=(4-e.length%4)%4;return e+"=".repeat(i)}function $0(t){const e=Vl(typeof t.type<"u"?t.type:zl);if(si(e)===Rt&&typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const i=typeof t.senderPublicKey<"u"?Xe(t.senderPublicKey,Ne):void 0,r=typeof t.iv<"u"?Xe(t.iv,Ne):Li(Qi),n=Xe(t.symKey,Ne),s=Al(n,r).encrypt(Xe(t.message,Ir)),o=Wl({type:e,sealed:s,iv:r,senderPublicKey:i});return t.encoding===Ut?Kl(o):o}function x0(t){const e=Xe(t.symKey,Ne),{sealed:i,iv:r}=lr({encoded:t.encoded,encoding:t.encoding}),n=Al(e,r).decrypt(i);if(n===null)throw new Error("Failed to decrypt");return qe(n,Ir)}function O0(t,e){const i=Vl(Dr),r=Li(Qi),n=Xe(t,Ir),s=Wl({type:i,sealed:n,iv:r});return e===Ut?Kl(s):s}function A0(t,e){const{sealed:i}=lr({encoded:t,encoding:e});return qe(i,Ir)}function Wl(t){if(si(t.type)===Dr)return qe(Zi([t.type,t.sealed]),at);if(si(t.type)===Rt){if(typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return qe(Zi([t.type,t.senderPublicKey,t.iv,t.sealed]),at)}return qe(Zi([t.type,t.iv,t.sealed]),at)}function lr(t){const e=(t.encoding||at)===Ut?Hl(t.encoded):t.encoded,i=Xe(e,at),r=i.slice(I0,sc),n=sc;if(si(r)===Rt){const c=n+yo,u=c+Qi,l=i.slice(n,c),h=i.slice(c,u),d=i.slice(u);return{type:r,sealed:d,iv:h,senderPublicKey:l}}if(si(r)===Dr){const c=i.slice(n),u=Li(Qi);return{type:r,sealed:c,iv:u}}const s=n+Qi,o=i.slice(n,s),a=i.slice(s);return{type:r,sealed:a,iv:o}}function P0(t,e){const i=lr({encoded:t,encoding:e?.encoding});return Gl({type:si(i.type),senderPublicKey:typeof i.senderPublicKey<"u"?qe(i.senderPublicKey,Ne):void 0,receiverPublicKey:e?.receiverPublicKey})}function Gl(t){const e=t?.type||zl;if(e===Rt){if(typeof t?.senderPublicKey>"u")throw new Error("missing sender public key");if(typeof t?.receiverPublicKey>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:t?.senderPublicKey,receiverPublicKey:t?.receiverPublicKey}}function oc(t){return t.type===Rt&&typeof t.senderPublicKey=="string"&&typeof t.receiverPublicKey=="string"}function ac(t){return t.type===Dr}function C0(t){const e=Buffer.from(t.x,"base64"),i=Buffer.from(t.y,"base64");return Zi([new Uint8Array([4]),e,i])}function R0(t,e){const[i,r,n]=t.split("."),s=Buffer.from(Hl(n),"base64");if(s.length!==64)throw new Error("Invalid signature length");const o=s.slice(0,32),a=s.slice(32,64),c=`${i}.${r}`,u=Er(c),l=C0(e);if(!_0.verify(Zi([o,a]),u,l))throw new Error("Invalid signature");return vs(t).payload}const T0="irn";function tn(t){return t?.relay||{protocol:T0}}function Yi(t){const e=Tm[t];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${t}`);return e}function N0(t,e="-"){const i={},r="relay"+e;return Object.keys(t).forEach(n=>{if(n.startsWith(r)){const s=n.replace(r,""),o=t[n];i[s]=o}}),i}function cc(t){if(!t.includes("wc:")){const u=yl(t);u!=null&&u.includes("wc:")&&(t=u)}t=t.includes("wc://")?t.replace("wc://",""):t,t=t.includes("wc:")?t.replace("wc:",""):t;const e=t.indexOf(":"),i=t.indexOf("?")!==-1?t.indexOf("?"):void 0,r=t.substring(0,e),n=t.substring(e+1,i).split("@"),s=typeof i<"u"?t.substring(i):"",o=new URLSearchParams(s),a={};o.forEach((u,l)=>{a[l]=u});const c=typeof a.methods=="string"?a.methods.split(","):void 0;return{protocol:r,topic:F0(n[0]),version:parseInt(n[1],10),symKey:a.symKey,relay:N0(a),methods:c,expiryTimestamp:a.expiryTimestamp?parseInt(a.expiryTimestamp,10):void 0}}function F0(t){return t.startsWith("//")?t.substring(2):t}function L0(t,e="-"){const i="relay",r={};return Object.keys(t).forEach(n=>{const s=n,o=i+e+s;t[s]&&(r[o]=t[s])}),r}function uc(t){const e=new URLSearchParams,i=L0(t.relay);Object.keys(i).sort().forEach(n=>{e.set(n,i[n])}),e.set("symKey",t.symKey),t.expiryTimestamp&&e.set("expiryTimestamp",t.expiryTimestamp.toString()),t.methods&&e.set("methods",t.methods.join(","));const r=e.toString();return`${t.protocol}:${t.topic}@${t.version}?${r}`}function Br(t,e,i){return`${t}?wc_ev=${i}&topic=${e}`}function Ui(t){const e=[];return t.forEach(i=>{const[r,n]=i.split(":");e.push(`${r}:${n}`)}),e}function B0(t){const e=[];return Object.values(t).forEach(i=>{e.push(...Ui(i.accounts))}),e}function U0(t,e){const i=[];return Object.values(t).forEach(r=>{Ui(r.accounts).includes(e)&&i.push(...r.methods)}),i}function k0(t,e){const i=[];return Object.values(t).forEach(r=>{Ui(r.accounts).includes(e)&&i.push(...r.events)}),i}function M0(t){const e={};return t?.forEach(i=>{var r;const[n,s]=i.split(":");e[n]||(e[n]={accounts:[],chains:[],events:[],methods:[]}),e[n].accounts.push(i),(r=e[n].chains)==null||r.push(`${n}:${s}`)}),e}function lc(t,e){e=e.map(r=>r.replace("did:pkh:",""));const i=M0(e);for(const[r,n]of Object.entries(i))n.methods?n.methods=rb(n.methods,t):n.methods=t,n.events=["chainChanged","accountsChanged"];return i}const q0={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},j0={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function F(t,e){const{message:i,code:r}=j0[t];return{message:e?`${i} ${e}`:i,code:r}}function ne(t,e){const{message:i,code:r}=q0[t];return{message:e?`${i} ${e}`:i,code:r}}function Sr(t,e){return Array.isArray(t)?typeof e<"u"&&t.length?t.every(e):!0:!1}function rn(t){return Object.getPrototypeOf(t)===Object.prototype&&Object.keys(t).length}function $e(t){return typeof t>"u"}function de(t,e){return e&&$e(t)?!0:typeof t=="string"&&!!t.trim().length}function wo(t,e){return e&&$e(t)?!0:typeof t=="number"&&!isNaN(t)}function z0(t,e){const{requiredNamespaces:i}=e,r=Object.keys(t.namespaces),n=Object.keys(i);let s=!0;return Zt(n,r)?(r.forEach(o=>{const{accounts:a,methods:c,events:u}=t.namespaces[o],l=Ui(a),h=i[o];(!Zt(co(o,h),l)||!Zt(h.methods,c)||!Zt(h.events,u))&&(s=!1)}),s):!1}function nn(t){return de(t,!1)&&t.includes(":")?t.split(":").length===2:!1}function V0(t){if(de(t,!1)&&t.includes(":")){const e=t.split(":");if(e.length===3){const i=e[0]+":"+e[1];return!!e[2]&&nn(i)}}return!1}function K0(t){function e(i){try{return typeof new URL(i)<"u"}catch{return!1}}try{if(de(t,!1)){if(e(t))return!0;const i=yl(t);return e(i)}}catch{}return!1}function H0(t){var e;return(e=t?.proposer)==null?void 0:e.publicKey}function W0(t){return t?.topic}function G0(t,e){let i=null;return de(t?.publicKey,!1)||(i=F("MISSING_OR_INVALID",`${e} controller public key should be a string`)),i}function hc(t){let e=!0;return Sr(t)?t.length&&(e=t.every(i=>de(i,!1))):e=!1,e}function Y0(t,e,i){let r=null;return Sr(e)&&e.length?e.forEach(n=>{r||nn(n)||(r=ne("UNSUPPORTED_CHAINS",`${i}, chain ${n} should be a string and conform to "namespace:chainId" format`))}):nn(t)||(r=ne("UNSUPPORTED_CHAINS",`${i}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),r}function J0(t,e,i){let r=null;return Object.entries(t).forEach(([n,s])=>{if(r)return;const o=Y0(n,co(n,s),`${e} ${i}`);o&&(r=o)}),r}function Z0(t,e){let i=null;return Sr(t)?t.forEach(r=>{i||V0(r)||(i=ne("UNSUPPORTED_ACCOUNTS",`${e}, account ${r} should be a string and conform to "namespace:chainId:address" format`))}):i=ne("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),i}function Q0(t,e){let i=null;return Object.values(t).forEach(r=>{if(i)return;const n=Z0(r?.accounts,`${e} namespace`);n&&(i=n)}),i}function X0(t,e){let i=null;return hc(t?.methods)?hc(t?.events)||(i=ne("UNSUPPORTED_EVENTS",`${e}, events should be an array of strings or empty array for no events`)):i=ne("UNSUPPORTED_METHODS",`${e}, methods should be an array of strings or empty array for no methods`),i}function Yl(t,e){let i=null;return Object.values(t).forEach(r=>{if(i)return;const n=X0(r,`${e}, namespace`);n&&(i=n)}),i}function ev(t,e,i){let r=null;if(t&&rn(t)){const n=Yl(t,e);n&&(r=n);const s=J0(t,e,i);s&&(r=s)}else r=F("MISSING_OR_INVALID",`${e}, ${i} should be an object with data`);return r}function es(t,e){let i=null;if(t&&rn(t)){const r=Yl(t,e);r&&(i=r);const n=Q0(t,e);n&&(i=n)}else i=F("MISSING_OR_INVALID",`${e}, namespaces should be an object with data`);return i}function Jl(t){return de(t.protocol,!0)}function tv(t,e){let i=!1;return e&&!t?i=!0:t&&Sr(t)&&t.length&&t.forEach(r=>{i=Jl(r)}),i}function iv(t){return typeof t=="number"}function ke(t){return typeof t<"u"&&typeof t!==null}function rv(t){return!(!t||typeof t!="object"||!t.code||!wo(t.code,!1)||!t.message||!de(t.message,!1))}function nv(t){return!($e(t)||!de(t.method,!1))}function sv(t){return!($e(t)||$e(t.result)&&$e(t.error)||!wo(t.id,!1)||!de(t.jsonrpc,!1))}function ov(t){return!($e(t)||!de(t.name,!1))}function dc(t,e){return!(!nn(e)||!B0(t).includes(e))}function av(t,e,i){return de(i,!1)?U0(t,e).includes(i):!1}function cv(t,e,i){return de(i,!1)?k0(t,e).includes(i):!1}function pc(t,e,i){let r=null;const n=uv(t),s=lv(e),o=Object.keys(n),a=Object.keys(s),c=fc(Object.keys(t)),u=fc(Object.keys(e)),l=c.filter(h=>!u.includes(h));return l.length&&(r=F("NON_CONFORMING_NAMESPACES",`${i} namespaces keys don't satisfy requiredNamespaces.
      Required: ${l.toString()}
      Received: ${Object.keys(e).toString()}`)),Zt(o,a)||(r=F("NON_CONFORMING_NAMESPACES",`${i} namespaces chains don't satisfy required namespaces.
      Required: ${o.toString()}
      Approved: ${a.toString()}`)),Object.keys(e).forEach(h=>{if(!h.includes(":")||r)return;const d=Ui(e[h].accounts);d.includes(h)||(r=F("NON_CONFORMING_NAMESPACES",`${i} namespaces accounts don't satisfy namespace accounts for ${h}
        Required: ${h}
        Approved: ${d.toString()}`))}),o.forEach(h=>{r||(Zt(n[h].methods,s[h].methods)?Zt(n[h].events,s[h].events)||(r=F("NON_CONFORMING_NAMESPACES",`${i} namespaces events don't satisfy namespace events for ${h}`)):r=F("NON_CONFORMING_NAMESPACES",`${i} namespaces methods don't satisfy namespace methods for ${h}`))}),r}function uv(t){const e={};return Object.keys(t).forEach(i=>{var r;i.includes(":")?e[i]=t[i]:(r=t[i].chains)==null||r.forEach(n=>{e[n]={methods:t[i].methods,events:t[i].events}})}),e}function fc(t){return[...new Set(t.map(e=>e.includes(":")?e.split(":")[0]:e))]}function lv(t){const e={};return Object.keys(t).forEach(i=>{i.includes(":")?e[i]=t[i]:Ui(t[i].accounts)?.forEach(n=>{e[n]={accounts:t[i].accounts.filter(s=>s.includes(`${n}:`)),methods:t[i].methods,events:t[i].events}})}),e}function hv(t,e){return wo(t,!1)&&t<=e.max&&t>=e.min}function gc(){const t=br();return new Promise(e=>{switch(t){case We.browser:e(dv());break;case We.reactNative:e(pv());break;case We.node:e(fv());break;default:e(!0)}})}function dv(){return mr()&&navigator?.onLine}async function pv(){return qt()&&typeof global<"u"&&global!=null&&global.NetInfo?(await(global==null?void 0:global.NetInfo.fetch()))?.isConnected:!0}function fv(){return!0}function gv(t){switch(br()){case We.browser:yv(t);break;case We.reactNative:wv(t);break}}function yv(t){!qt()&&mr()&&(window.addEventListener("online",()=>t(!0)),window.addEventListener("offline",()=>t(!1)))}function wv(t){qt()&&typeof global<"u"&&global!=null&&global.NetInfo&&global?.NetInfo.addEventListener(e=>t(e?.isConnected))}const ts={};class Vi{static get(e){return ts[e]}static set(e,i){ts[e]=i}static delete(e){delete ts[e]}}const mv="PARSE_ERROR",bv="INVALID_REQUEST",vv="METHOD_NOT_FOUND",Ev="INVALID_PARAMS",Zl="INTERNAL_ERROR",mo="SERVER_ERROR",_v=[-32700,-32600,-32601,-32602,-32603],Xi={[mv]:{code:-32700,message:"Parse error"},[bv]:{code:-32600,message:"Invalid Request"},[vv]:{code:-32601,message:"Method not found"},[Ev]:{code:-32602,message:"Invalid params"},[Zl]:{code:-32603,message:"Internal error"},[mo]:{code:-32e3,message:"Server error"}},Ql=mo;function Iv(t){return _v.includes(t)}function yc(t){return Object.keys(Xi).includes(t)?Xi[t]:Xi[Ql]}function Dv(t){const e=Object.values(Xi).find(i=>i.code===t);return e||Xi[Ql]}function Sv(t,e,i){return t.message.includes("getaddrinfo ENOTFOUND")||t.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${i} RPC url at ${e}`):t}var Xl={},St={},wc;function $v(){if(wc)return St;wc=1,Object.defineProperty(St,"__esModule",{value:!0}),St.isBrowserCryptoAvailable=St.getSubtleCrypto=St.getBrowerCrypto=void 0;function t(){return(Ot.commonjsGlobal===null||Ot.commonjsGlobal===void 0?void 0:Ot.commonjsGlobal.crypto)||(Ot.commonjsGlobal===null||Ot.commonjsGlobal===void 0?void 0:Ot.commonjsGlobal.msCrypto)||{}}St.getBrowerCrypto=t;function e(){const r=t();return r.subtle||r.webkitSubtle}St.getSubtleCrypto=e;function i(){return!!t()&&!!e()}return St.isBrowserCryptoAvailable=i,St}var $t={},mc;function xv(){if(mc)return $t;mc=1,Object.defineProperty($t,"__esModule",{value:!0}),$t.isBrowser=$t.isNode=$t.isReactNative=void 0;function t(){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"}$t.isReactNative=t;function e(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}$t.isNode=e;function i(){return!t()&&!e()}return $t.isBrowser=i,$t}(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=hr;e.__exportStar($v(),t),e.__exportStar(xv(),t)})(Xl);function pt(t=3){const e=Date.now()*Math.pow(10,t),i=Math.floor(Math.random()*Math.pow(10,t));return e+i}function Qt(t=6){return BigInt(pt(t))}function Xt(t,e,i){return{id:i||pt(),jsonrpc:"2.0",method:t,params:e}}function bn(t,e){return{id:t,jsonrpc:"2.0",result:e}}function vn(t,e,i){return{id:t,jsonrpc:"2.0",error:Ov(e,i)}}function Ov(t,e){return typeof t>"u"?yc(Zl):(typeof t=="string"&&(t=Object.assign(Object.assign({},yc(mo)),{message:t})),typeof e<"u"&&(t.data=e),Iv(t.code)&&(t=Dv(t.code)),t)}class eh{}let Av=class extends eh{constructor(e){super()}},Pv=class extends eh{constructor(){super()}};class Cv extends Pv{constructor(e){super()}}const Rv="^wss?:";function Tv(t){const e=t.match(new RegExp(/^\w+:/,"gi"));if(!(!e||!e.length))return e[0]}function Nv(t,e){const i=Tv(t);return typeof i>"u"?!1:new RegExp(e).test(i)}function bc(t){return Nv(t,Rv)}function Fv(t){return new RegExp("wss?://localhost(:d{2,5})?").test(t)}function th(t){return typeof t=="object"&&"id"in t&&"jsonrpc"in t&&t.jsonrpc==="2.0"}function bo(t){return th(t)&&"method"in t}function En(t){return th(t)&&(ft(t)||Qe(t))}function ft(t){return"result"in t}function Qe(t){return"error"in t}let ih=class extends Cv{constructor(e){super(e),this.events=new Ge.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(e),this.connection.connected&&this.registerEventListeners()}async connect(e=this.connection){await this.open(e)}async disconnect(){await this.close()}on(e,i){this.events.on(e,i)}once(e,i){this.events.once(e,i)}off(e,i){this.events.off(e,i)}removeListener(e,i){this.events.removeListener(e,i)}async request(e,i){return this.requestStrict(Xt(e.method,e.params||[],e.id||Qt().toString()),i)}async requestStrict(e,i){return new Promise(async(r,n)=>{if(!this.connection.connected)try{await this.open()}catch(s){n(s)}this.events.on(`${e.id}`,s=>{Qe(s)?n(s.error):r(s.result)});try{await this.connection.send(e,i)}catch(s){n(s)}})}setConnection(e=this.connection){return e}onPayload(e){this.events.emit("payload",e),En(e)?this.events.emit(`${e.id}`,e):this.events.emit("message",{type:e.method,data:e.params})}onClose(e){e&&e.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${e.code} ${e.reason?`(${e.reason})`:""}`)),this.events.emit("disconnect")}async open(e=this.connection){this.connection===e&&this.connection.connected||(this.connection.connected&&this.close(),typeof e=="string"&&(await this.connection.open(e),e=this.connection),this.connection=this.setConnection(e),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",e=>this.onPayload(e)),this.connection.on("close",e=>this.onClose(e)),this.connection.on("error",e=>this.events.emit("error",e)),this.connection.on("register_error",e=>this.onClose()),this.hasRegisteredEventListeners=!0)}};const Lv=()=>typeof WebSocket<"u"?WebSocket:typeof global<"u"&&typeof global.WebSocket<"u"?global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),Bv=()=>typeof WebSocket<"u"||typeof global<"u"&&typeof global.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",vc=t=>t.split("?")[0],Ec=10,Uv=Lv();let kv=class{constructor(e){if(this.url=e,this.events=new Ge.EventEmitter,this.registering=!1,!bc(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);this.url=e}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(e,i){this.events.on(e,i)}once(e,i){this.events.once(e,i)}off(e,i){this.events.off(e,i)}removeListener(e,i){this.events.removeListener(e,i)}async open(e=this.url){await this.register(e)}async close(){return new Promise((e,i)=>{if(typeof this.socket>"u"){i(new Error("Connection already closed"));return}this.socket.onclose=r=>{this.onClose(r),e()},this.socket.close()})}async send(e){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(ti(e))}catch(i){this.onError(e.id,i)}}register(e=this.url){if(!bc(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);if(this.registering){const i=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=i||this.events.listenerCount("open")>=i)&&this.events.setMaxListeners(i+1),new Promise((r,n)=>{this.events.once("register_error",s=>{this.resetMaxListeners(),n(s)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return n(new Error("WebSocket connection is missing or invalid"));r(this.socket)})})}return this.url=e,this.registering=!0,new Promise((i,r)=>{const n=Xl.isReactNative()?void 0:{rejectUnauthorized:!Fv(e)},s=new Uv(e,[],n);Bv()?s.onerror=o=>{const a=o;r(this.emitError(a.error))}:s.on("error",o=>{r(this.emitError(o))}),s.onopen=()=>{this.onOpen(s),i(s)}})}onOpen(e){e.onmessage=i=>this.onPayload(i),e.onclose=i=>this.onClose(i),this.socket=e,this.registering=!1,this.events.emit("open")}onClose(e){this.socket=void 0,this.registering=!1,this.events.emit("close",e)}onPayload(e){if(typeof e.data>"u")return;const i=typeof e.data=="string"?Ii(e.data):e.data;this.events.emit("payload",i)}onError(e,i){const r=this.parseError(i),n=r.message||r.toString(),s=vn(e,n);this.events.emit("payload",s)}parseError(e,i=this.url){return Sv(e,vc(i),"WS")}resetMaxListeners(){this.events.getMaxListeners()>Ec&&this.events.setMaxListeners(Ec)}emitError(e){const i=this.parseError(new Error(e?.message||`WebSocket connection failed for host: ${vc(this.url)}`));return this.events.emit("register_error",i),i}};const rh="wc",nh=2,sn="core",bt=`${rh}@2:${sn}:`,Mv={name:sn,logger:"error"},qv={database:":memory:"},jv="crypto",_c="client_ed25519_seed",zv=T.ONE_DAY,Vv="keychain",Kv="0.3",Hv="messages",Wv="0.3",Ic=T.SIX_HOURS,Gv="publisher",sh="irn",Yv="error",oh="wss://relay.walletconnect.org",Jv="relayer",be={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},Zv="_subscription",Je={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},Qv=.1,Ls="2.20.2",ce={link_mode:"link_mode",relay:"relay"},Hr={inbound:"inbound",outbound:"outbound"},Xv="0.3",eE="WALLETCONNECT_CLIENT_ID",Dc="WALLETCONNECT_LINK_MODE_APPS",Ve={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},tE="subscription",iE="0.3",rE="pairing",nE="0.3",Ki={wc_pairingDelete:{req:{ttl:T.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:T.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:T.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:T.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:T.ONE_DAY,prompt:!1,tag:0},res:{ttl:T.ONE_DAY,prompt:!1,tag:0}}},Jt={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},tt={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},sE="history",oE="0.3",aE="expirer",Ze={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},cE="0.3",uE="verify-api",lE="https://verify.walletconnect.com",ah="https://verify.walletconnect.org",er=ah,hE=`${er}/v3`,dE=[lE,ah],pE="echo",fE="https://echo.walletconnect.com",dt={pairing_started:"pairing_started",pairing_uri_validation_success:"pairing_uri_validation_success",pairing_uri_not_expired:"pairing_uri_not_expired",store_new_pairing:"store_new_pairing",subscribing_pairing_topic:"subscribing_pairing_topic",subscribe_pairing_topic_success:"subscribe_pairing_topic_success",existing_pairing:"existing_pairing",pairing_not_expired:"pairing_not_expired",emit_inactive_pairing:"emit_inactive_pairing",emit_session_proposal:"emit_session_proposal",subscribing_to_pairing_topic:"subscribing_to_pairing_topic"},xt={no_wss_connection:"no_wss_connection",no_internet_connection:"no_internet_connection",malformed_pairing_uri:"malformed_pairing_uri",active_pairing_already_exists:"active_pairing_already_exists",subscribe_pairing_topic_failure:"subscribe_pairing_topic_failure",pairing_expired:"pairing_expired",proposal_expired:"proposal_expired",proposal_listener_not_found:"proposal_listener_not_found"},it={session_approve_started:"session_approve_started",proposal_not_expired:"proposal_not_expired",session_namespaces_validation_success:"session_namespaces_validation_success",create_session_topic:"create_session_topic",subscribing_session_topic:"subscribing_session_topic",subscribe_session_topic_success:"subscribe_session_topic_success",publishing_session_approve:"publishing_session_approve",session_approve_publish_success:"session_approve_publish_success",store_session:"store_session",publishing_session_settle:"publishing_session_settle",session_settle_publish_success:"session_settle_publish_success"},Vt={no_internet_connection:"no_internet_connection",no_wss_connection:"no_wss_connection",proposal_expired:"proposal_expired",subscribe_session_topic_failure:"subscribe_session_topic_failure",session_approve_publish_failure:"session_approve_publish_failure",session_settle_publish_failure:"session_settle_publish_failure",session_approve_namespace_validation_failure:"session_approve_namespace_validation_failure",proposal_not_found:"proposal_not_found"},Kt={authenticated_session_approve_started:"authenticated_session_approve_started",authenticated_session_not_expired:"authenticated_session_not_expired",chains_caip2_compliant:"chains_caip2_compliant",chains_evm_compliant:"chains_evm_compliant",create_authenticated_session_topic:"create_authenticated_session_topic",cacaos_verified:"cacaos_verified",store_authenticated_session:"store_authenticated_session",subscribing_authenticated_session_topic:"subscribing_authenticated_session_topic",subscribe_authenticated_session_topic_success:"subscribe_authenticated_session_topic_success",publishing_authenticated_session_approve:"publishing_authenticated_session_approve",authenticated_session_approve_publish_success:"authenticated_session_approve_publish_success"},Hi={no_internet_connection:"no_internet_connection",no_wss_connection:"no_wss_connection",missing_session_authenticate_request:"missing_session_authenticate_request",session_authenticate_request_expired:"session_authenticate_request_expired",chains_caip2_compliant_failure:"chains_caip2_compliant_failure",chains_evm_compliant_failure:"chains_evm_compliant_failure",invalid_cacao:"invalid_cacao",subscribe_authenticated_session_topic_failure:"subscribe_authenticated_session_topic_failure",authenticated_session_approve_publish_failure:"authenticated_session_approve_publish_failure",authenticated_session_pending_request_not_found:"authenticated_session_pending_request_not_found"},gE=.1,yE="event-client",wE=86400,mE="https://pulse.walletconnect.org/batch";function bE(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var i=new Uint8Array(256),r=0;r<i.length;r++)i[r]=255;for(var n=0;n<t.length;n++){var s=t.charAt(n),o=s.charCodeAt(0);if(i[o]!==255)throw new TypeError(s+" is ambiguous");i[o]=n}var a=t.length,c=t.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(p){if(p instanceof Uint8Array||(ArrayBuffer.isView(p)?p=new Uint8Array(p.buffer,p.byteOffset,p.byteLength):Array.isArray(p)&&(p=Uint8Array.from(p))),!(p instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(p.length===0)return"";for(var g=0,y=0,m=0,w=p.length;m!==w&&p[m]===0;)m++,g++;for(var b=(w-m)*l+1>>>0,E=new Uint8Array(b);m!==w;){for(var x=p[m],S=0,$=b-1;(x!==0||S<y)&&$!==-1;$--,S++)x+=256*E[$]>>>0,E[$]=x%a>>>0,x=x/a>>>0;if(x!==0)throw new Error("Non-zero carry");y=S,m++}for(var A=b-y;A!==b&&E[A]===0;)A++;for(var I=c.repeat(g);A<b;++A)I+=t.charAt(E[A]);return I}function d(p){if(typeof p!="string")throw new TypeError("Expected String");if(p.length===0)return new Uint8Array;var g=0;if(p[g]!==" "){for(var y=0,m=0;p[g]===c;)y++,g++;for(var w=(p.length-g)*u+1>>>0,b=new Uint8Array(w);p[g];){var E=i[p.charCodeAt(g)];if(E===255)return;for(var x=0,S=w-1;(E!==0||x<m)&&S!==-1;S--,x++)E+=a*b[S]>>>0,b[S]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");m=x,g++}if(p[g]!==" "){for(var $=w-m;$!==w&&b[$]===0;)$++;for(var A=new Uint8Array(y+(w-$)),I=y;$!==w;)A[I++]=b[$++];return A}}}function f(p){var g=d(p);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:d,decode:f}}var vE=bE,EE=vE;const ch=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},_E=t=>new TextEncoder().encode(t),IE=t=>new TextDecoder().decode(t);class DE{constructor(e,i,r){this.name=e,this.prefix=i,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class SE{constructor(e,i,r){if(this.name=e,this.prefix=i,i.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i.codePointAt(0),this.baseDecode=r}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return uh(this,e)}}class $E{constructor(e){this.decoders=e}or(e){return uh(this,e)}decode(e){const i=e[0],r=this.decoders[i];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const uh=(t,e)=>new $E({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class xE{constructor(e,i,r,n){this.name=e,this.prefix=i,this.baseEncode=r,this.baseDecode=n,this.encoder=new DE(e,i,r),this.decoder=new SE(e,i,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const _n=({name:t,prefix:e,encode:i,decode:r})=>new xE(t,e,i,r),$r=({prefix:t,name:e,alphabet:i})=>{const{encode:r,decode:n}=EE(i,e);return _n({prefix:t,name:e,encode:r,decode:s=>ch(n(s))})},OE=(t,e,i,r)=>{const n={};for(let l=0;l<e.length;++l)n[e[l]]=l;let s=t.length;for(;t[s-1]==="=";)--s;const o=new Uint8Array(s*i/8|0);let a=0,c=0,u=0;for(let l=0;l<s;++l){const h=n[t[l]];if(h===void 0)throw new SyntaxError(`Non-${r} character`);c=c<<i|h,a+=i,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=i||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},AE=(t,e,i)=>{const r=e[e.length-1]==="=",n=(1<<i)-1;let s="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>i;)o-=i,s+=e[n&a>>o];if(o&&(s+=e[n&a<<i-o]),r)for(;s.length*i&7;)s+="=";return s},Ae=({name:t,prefix:e,bitsPerChar:i,alphabet:r})=>_n({prefix:e,name:t,encode(n){return AE(n,r,i)},decode(n){return OE(n,r,i,t)}}),PE=_n({prefix:"\0",name:"identity",encode:t=>IE(t),decode:t=>_E(t)});var CE=Object.freeze({__proto__:null,identity:PE});const RE=Ae({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var TE=Object.freeze({__proto__:null,base2:RE});const NE=Ae({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var FE=Object.freeze({__proto__:null,base8:NE});const LE=$r({prefix:"9",name:"base10",alphabet:"0123456789"});var BE=Object.freeze({__proto__:null,base10:LE});const UE=Ae({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),kE=Ae({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var ME=Object.freeze({__proto__:null,base16:UE,base16upper:kE});const qE=Ae({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),jE=Ae({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),zE=Ae({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),VE=Ae({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),KE=Ae({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),HE=Ae({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),WE=Ae({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),GE=Ae({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),YE=Ae({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var JE=Object.freeze({__proto__:null,base32:qE,base32upper:jE,base32pad:zE,base32padupper:VE,base32hex:KE,base32hexupper:HE,base32hexpad:WE,base32hexpadupper:GE,base32z:YE});const ZE=$r({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),QE=$r({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var XE=Object.freeze({__proto__:null,base36:ZE,base36upper:QE});const e_=$r({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),t_=$r({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var i_=Object.freeze({__proto__:null,base58btc:e_,base58flickr:t_});const r_=Ae({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),n_=Ae({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),s_=Ae({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),o_=Ae({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var a_=Object.freeze({__proto__:null,base64:r_,base64pad:n_,base64url:s_,base64urlpad:o_});const lh=Array.from(""),c_=lh.reduce((t,e,i)=>(t[i]=e,t),[]),u_=lh.reduce((t,e,i)=>(t[e.codePointAt(0)]=i,t),[]);function l_(t){return t.reduce((e,i)=>(e+=c_[i],e),"")}function h_(t){const e=[];for(const i of t){const r=u_[i.codePointAt(0)];if(r===void 0)throw new Error(`Non-base256emoji character: ${i}`);e.push(r)}return new Uint8Array(e)}const d_=_n({prefix:"",name:"base256emoji",encode:l_,decode:h_});var p_=Object.freeze({__proto__:null,base256emoji:d_}),f_=hh,Sc=128,g_=127,y_=~g_,w_=Math.pow(2,31);function hh(t,e,i){e=e||[],i=i||0;for(var r=i;t>=w_;)e[i++]=t&255|Sc,t/=128;for(;t&y_;)e[i++]=t&255|Sc,t>>>=7;return e[i]=t|0,hh.bytes=i-r+1,e}var m_=Bs,b_=128,$c=127;function Bs(t,r){var i=0,r=r||0,n=0,s=r,o,a=t.length;do{if(s>=a)throw Bs.bytes=0,new RangeError("Could not decode varint");o=t[s++],i+=n<28?(o&$c)<<n:(o&$c)*Math.pow(2,n),n+=7}while(o>=b_);return Bs.bytes=s-r,i}var v_=Math.pow(2,7),E_=Math.pow(2,14),__=Math.pow(2,21),I_=Math.pow(2,28),D_=Math.pow(2,35),S_=Math.pow(2,42),$_=Math.pow(2,49),x_=Math.pow(2,56),O_=Math.pow(2,63),A_=function(t){return t<v_?1:t<E_?2:t<__?3:t<I_?4:t<D_?5:t<S_?6:t<$_?7:t<x_?8:t<O_?9:10},P_={encode:f_,decode:m_,encodingLength:A_},dh=P_;const xc=(t,e,i=0)=>(dh.encode(t,e,i),e),Oc=t=>dh.encodingLength(t),Us=(t,e)=>{const i=e.byteLength,r=Oc(t),n=r+Oc(i),s=new Uint8Array(n+i);return xc(t,s,0),xc(i,s,r),s.set(e,n),new C_(t,i,e,s)};class C_{constructor(e,i,r,n){this.code=e,this.size=i,this.digest=r,this.bytes=n}}const ph=({name:t,code:e,encode:i})=>new R_(t,e,i);class R_{constructor(e,i,r){this.name=e,this.code=i,this.encode=r}digest(e){if(e instanceof Uint8Array){const i=this.encode(e);return i instanceof Uint8Array?Us(this.code,i):i.then(r=>Us(this.code,r))}else throw Error("Unknown type, must be binary type")}}const fh=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),T_=ph({name:"sha2-256",code:18,encode:fh("SHA-256")}),N_=ph({name:"sha2-512",code:19,encode:fh("SHA-512")});var F_=Object.freeze({__proto__:null,sha256:T_,sha512:N_});const gh=0,L_="identity",yh=ch,B_=t=>Us(gh,yh(t)),U_={code:gh,name:L_,encode:yh,digest:B_};var k_=Object.freeze({__proto__:null,identity:U_});new TextEncoder,new TextDecoder;const Ac={...CE,...TE,...FE,...BE,...ME,...JE,...XE,...i_,...a_,...p_};({...F_,...k_});function M_(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?globalThis.Buffer.allocUnsafe(t):new Uint8Array(t)}function wh(t,e,i,r){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:i},decoder:{decode:r}}}const Pc=wh("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),is=wh("ascii","a",t=>{let e="a";for(let i=0;i<t.length;i++)e+=String.fromCharCode(t[i]);return e},t=>{t=t.substring(1);const e=M_(t.length);for(let i=0;i<t.length;i++)e[i]=t.charCodeAt(i);return e}),q_={utf8:Pc,"utf-8":Pc,hex:Ac.base16,latin1:is,ascii:is,binary:is,...Ac};function j_(t,e="utf8"){const i=q_[e];if(!i)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t,"utf8"):i.decoder.decode(`${i.prefix}${t}`)}var z_=Object.defineProperty,V_=(t,e,i)=>e in t?z_(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,lt=(t,e,i)=>V_(t,typeof e!="symbol"?e+"":e,i);class K_{constructor(e,i){this.core=e,this.logger=i,lt(this,"keychain",new Map),lt(this,"name",Vv),lt(this,"version",Kv),lt(this,"initialized",!1),lt(this,"storagePrefix",bt),lt(this,"init",async()=>{if(!this.initialized){const r=await this.getKeyChain();typeof r<"u"&&(this.keychain=r),this.initialized=!0}}),lt(this,"has",r=>(this.isInitialized(),this.keychain.has(r))),lt(this,"set",async(r,n)=>{this.isInitialized(),this.keychain.set(r,n),await this.persist()}),lt(this,"get",r=>{this.isInitialized();const n=this.keychain.get(r);if(typeof n>"u"){const{message:s}=F("NO_MATCHING_KEY",`${this.name}: ${r}`);throw new Error(s)}return n}),lt(this,"del",async r=>{this.isInitialized(),this.keychain.delete(r),await this.persist()}),this.core=e,this.logger=Fe(i,this.name)}get context(){return je(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,Ds(e))}async getKeyChain(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?Ss(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:e}=F("NOT_INITIALIZED",this.name);throw new Error(e)}}}var H_=Object.defineProperty,W_=(t,e,i)=>e in t?H_(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,De=(t,e,i)=>W_(t,typeof e!="symbol"?e+"":e,i);class G_{constructor(e,i,r){this.core=e,this.logger=i,De(this,"name",jv),De(this,"keychain"),De(this,"randomSessionIdentifier",Fs()),De(this,"initialized",!1),De(this,"init",async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)}),De(this,"hasKeys",n=>(this.isInitialized(),this.keychain.has(n))),De(this,"getClientId",async()=>{this.isInitialized();const n=await this.getClientSeed(),s=ga(n);return ju(s.publicKey)}),De(this,"generateKeyPair",()=>{this.isInitialized();const n=D0();return this.setPrivateKey(n.publicKey,n.privateKey)}),De(this,"signJWT",async n=>{this.isInitialized();const s=await this.getClientSeed(),o=ga(s),a=this.randomSessionIdentifier;return await Ty(a,n,zv,o)}),De(this,"generateSharedKey",(n,s,o)=>{this.isInitialized();const a=this.getPrivateKey(n),c=S0(a,s);return this.setSymKey(c,o)}),De(this,"setSymKey",async(n,s)=>{this.isInitialized();const o=s||Kr(n);return await this.keychain.set(o,n),o}),De(this,"deleteKeyPair",async n=>{this.isInitialized(),await this.keychain.del(n)}),De(this,"deleteSymKey",async n=>{this.isInitialized(),await this.keychain.del(n)}),De(this,"encode",async(n,s,o)=>{this.isInitialized();const a=Gl(o),c=ti(s);if(ac(a))return O0(c,o?.encoding);if(oc(a)){const d=a.senderPublicKey,f=a.receiverPublicKey;n=await this.generateSharedKey(d,f)}const u=this.getSymKey(n),{type:l,senderPublicKey:h}=a;return $0({type:l,symKey:u,message:c,senderPublicKey:h,encoding:o?.encoding})}),De(this,"decode",async(n,s,o)=>{this.isInitialized();const a=P0(s,o);if(ac(a)){const c=A0(s,o?.encoding);return Ii(c)}if(oc(a)){const c=a.receiverPublicKey,u=a.senderPublicKey;n=await this.generateSharedKey(c,u)}try{const c=this.getSymKey(n),u=x0({symKey:c,encoded:s,encoding:o?.encoding});return Ii(u)}catch(c){this.logger.error(`Failed to decode message from topic: '${n}', clientId: '${await this.getClientId()}'`),this.logger.error(c)}}),De(this,"getPayloadType",(n,s=at)=>{const o=lr({encoded:n,encoding:s});return si(o.type)}),De(this,"getPayloadSenderPublicKey",(n,s=at)=>{const o=lr({encoded:n,encoding:s});return o.senderPublicKey?qe(o.senderPublicKey,Ne):void 0}),this.core=e,this.logger=Fe(i,this.name),this.keychain=r||new K_(this.core,this.logger)}get context(){return je(this.logger)}async setPrivateKey(e,i){return await this.keychain.set(e,i),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(_c)}catch{e=Fs(),await this.keychain.set(_c,e)}return j_(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=F("NOT_INITIALIZED",this.name);throw new Error(e)}}}var Y_=Object.defineProperty,J_=Object.defineProperties,Z_=Object.getOwnPropertyDescriptors,Cc=Object.getOwnPropertySymbols,Q_=Object.prototype.hasOwnProperty,X_=Object.prototype.propertyIsEnumerable,ks=(t,e,i)=>e in t?Y_(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,e2=(t,e)=>{for(var i in e||(e={}))Q_.call(e,i)&&ks(t,i,e[i]);if(Cc)for(var i of Cc(e))X_.call(e,i)&&ks(t,i,e[i]);return t},t2=(t,e)=>J_(t,Z_(e)),ze=(t,e,i)=>ks(t,typeof e!="symbol"?e+"":e,i);class i2 extends Ap{constructor(e,i){super(e,i),this.logger=e,this.core=i,ze(this,"messages",new Map),ze(this,"messagesWithoutClientAck",new Map),ze(this,"name",Hv),ze(this,"version",Wv),ze(this,"initialized",!1),ze(this,"storagePrefix",bt),ze(this,"init",async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const r=await this.getRelayerMessages();typeof r<"u"&&(this.messages=r);const n=await this.getRelayerMessagesWithoutClientAck();typeof n<"u"&&(this.messagesWithoutClientAck=n),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(r){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(r)}finally{this.initialized=!0}}}),ze(this,"set",async(r,n,s)=>{this.isInitialized();const o=wt(n);let a=this.messages.get(r);if(typeof a>"u"&&(a={}),typeof a[o]<"u")return o;if(a[o]=n,this.messages.set(r,a),s===Hr.inbound){const c=this.messagesWithoutClientAck.get(r)||{};this.messagesWithoutClientAck.set(r,t2(e2({},c),{[o]:n}))}return await this.persist(),o}),ze(this,"get",r=>{this.isInitialized();let n=this.messages.get(r);return typeof n>"u"&&(n={}),n}),ze(this,"getWithoutAck",r=>{this.isInitialized();const n={};for(const s of r){const o=this.messagesWithoutClientAck.get(s)||{};n[s]=Object.values(o)}return n}),ze(this,"has",(r,n)=>{this.isInitialized();const s=this.get(r),o=wt(n);return typeof s[o]<"u"}),ze(this,"ack",async(r,n)=>{this.isInitialized();const s=this.messagesWithoutClientAck.get(r);if(typeof s>"u")return;const o=wt(n);delete s[o],Object.keys(s).length===0?this.messagesWithoutClientAck.delete(r):this.messagesWithoutClientAck.set(r,s),await this.persist()}),ze(this,"del",async r=>{this.isInitialized(),this.messages.delete(r),this.messagesWithoutClientAck.delete(r),await this.persist()}),this.logger=Fe(e,this.name),this.core=i}get context(){return je(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get storageKeyWithoutClientAck(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name+"_withoutClientAck"}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,Ds(e))}async setRelayerMessagesWithoutClientAck(e){await this.core.storage.setItem(this.storageKeyWithoutClientAck,Ds(e))}async getRelayerMessages(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?Ss(e):void 0}async getRelayerMessagesWithoutClientAck(){const e=await this.core.storage.getItem(this.storageKeyWithoutClientAck);return typeof e<"u"?Ss(e):void 0}async persist(){await this.setRelayerMessages(this.messages),await this.setRelayerMessagesWithoutClientAck(this.messagesWithoutClientAck)}isInitialized(){if(!this.initialized){const{message:e}=F("NOT_INITIALIZED",this.name);throw new Error(e)}}}var r2=Object.defineProperty,n2=Object.defineProperties,s2=Object.getOwnPropertyDescriptors,Rc=Object.getOwnPropertySymbols,o2=Object.prototype.hasOwnProperty,a2=Object.prototype.propertyIsEnumerable,Ms=(t,e,i)=>e in t?r2(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,Ur=(t,e)=>{for(var i in e||(e={}))o2.call(e,i)&&Ms(t,i,e[i]);if(Rc)for(var i of Rc(e))a2.call(e,i)&&Ms(t,i,e[i]);return t},rs=(t,e)=>n2(t,s2(e)),rt=(t,e,i)=>Ms(t,typeof e!="symbol"?e+"":e,i);class c2 extends Pp{constructor(e,i){super(e,i),this.relayer=e,this.logger=i,rt(this,"events",new Ge.EventEmitter),rt(this,"name",Gv),rt(this,"queue",new Map),rt(this,"publishTimeout",T.toMiliseconds(T.ONE_MINUTE)),rt(this,"initialPublishTimeout",T.toMiliseconds(T.ONE_SECOND*15)),rt(this,"needsTransportRestart",!1),rt(this,"publish",async(r,n,s)=>{var o;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:r,message:n,opts:s}});const a=s?.ttl||Ic,c=tn(s),u=s?.prompt||!1,l=s?.tag||0,h=s?.id||Qt().toString(),d={topic:r,message:n,opts:{ttl:a,relay:c,prompt:u,tag:l,id:h,attestation:s?.attestation,tvf:s?.tvf}},f=`Failed to publish payload, please try again. id:${h} tag:${l}`;try{const p=new Promise(async g=>{const y=({id:w})=>{d.opts.id===w&&(this.removeRequestFromQueue(w),this.relayer.events.removeListener(be.publish,y),g(d))};this.relayer.events.on(be.publish,y);const m=kt(new Promise((w,b)=>{this.rpcPublish({topic:r,message:n,ttl:a,prompt:u,tag:l,id:h,attestation:s?.attestation,tvf:s?.tvf}).then(w).catch(E=>{this.logger.warn(E,E?.message),b(E)})}),this.initialPublishTimeout,`Failed initial publish, retrying.... id:${h} tag:${l}`);try{await m,this.events.removeListener(be.publish,y)}catch(w){this.queue.set(h,rs(Ur({},d),{attempt:1})),this.logger.warn(w,w?.message)}});this.logger.trace({type:"method",method:"publish",params:{id:h,topic:r,message:n,opts:s}}),await kt(p,this.publishTimeout,f)}catch(p){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(p),(o=s?.internal)!=null&&o.throwOnFailedPublish)throw p}finally{this.queue.delete(h)}}),rt(this,"on",(r,n)=>{this.events.on(r,n)}),rt(this,"once",(r,n)=>{this.events.once(r,n)}),rt(this,"off",(r,n)=>{this.events.off(r,n)}),rt(this,"removeListener",(r,n)=>{this.events.removeListener(r,n)}),this.relayer=e,this.logger=Fe(i,this.name),this.registerEventListeners()}get context(){return je(this.logger)}async rpcPublish(e){var i,r,n,s;const{topic:o,message:a,ttl:c=Ic,prompt:u,tag:l,id:h,attestation:d,tvf:f}=e,p={method:Yi(tn().protocol).publish,params:Ur({topic:o,message:a,ttl:c,prompt:u,tag:l,attestation:d},f),id:h};$e((i=p.params)==null?void 0:i.prompt)&&((r=p.params)==null||delete r.prompt),$e((n=p.params)==null?void 0:n.tag)&&((s=p.params)==null||delete s.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:p});const g=await this.relayer.request(p);return this.relayer.events.emit(be.publish,e),this.logger.debug("Successfully Published Payload"),g}removeRequestFromQueue(e){this.queue.delete(e)}checkQueue(){this.queue.forEach(async(e,i)=>{const r=e.attempt+1;this.queue.set(i,rs(Ur({},e),{attempt:r}));const{topic:n,message:s,opts:o,attestation:a}=e;this.logger.warn({},`Publisher: queue->publishing: ${e.opts.id}, tag: ${e.opts.tag}, attempt: ${r}`),await this.rpcPublish(rs(Ur({},e),{topic:n,message:s,ttl:o.ttl,prompt:o.prompt,tag:o.tag,id:o.id,attestation:a,tvf:o.tvf})),this.logger.warn({},`Publisher: queue->published: ${e.opts.id}`)})}registerEventListeners(){this.relayer.core.heartbeat.on(Ci.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(be.connection_stalled);return}this.checkQueue()}),this.relayer.on(be.message_ack,e=>{this.removeRequestFromQueue(e.id.toString())})}}var u2=Object.defineProperty,l2=(t,e,i)=>e in t?u2(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,mi=(t,e,i)=>l2(t,typeof e!="symbol"?e+"":e,i);class h2{constructor(){mi(this,"map",new Map),mi(this,"set",(e,i)=>{const r=this.get(e);this.exists(e,i)||this.map.set(e,[...r,i])}),mi(this,"get",e=>this.map.get(e)||[]),mi(this,"exists",(e,i)=>this.get(e).includes(i)),mi(this,"delete",(e,i)=>{if(typeof i>"u"){this.map.delete(e);return}if(!this.map.has(e))return;const r=this.get(e);if(!this.exists(e,i))return;const n=r.filter(s=>s!==i);if(!n.length){this.map.delete(e);return}this.map.set(e,n)}),mi(this,"clear",()=>{this.map.clear()})}get topics(){return Array.from(this.map.keys())}}var d2=Object.defineProperty,p2=Object.defineProperties,f2=Object.getOwnPropertyDescriptors,Tc=Object.getOwnPropertySymbols,g2=Object.prototype.hasOwnProperty,y2=Object.prototype.propertyIsEnumerable,qs=(t,e,i)=>e in t?d2(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,Wi=(t,e)=>{for(var i in e||(e={}))g2.call(e,i)&&qs(t,i,e[i]);if(Tc)for(var i of Tc(e))y2.call(e,i)&&qs(t,i,e[i]);return t},ns=(t,e)=>p2(t,f2(e)),ie=(t,e,i)=>qs(t,typeof e!="symbol"?e+"":e,i);class w2 extends Tp{constructor(e,i){super(e,i),this.relayer=e,this.logger=i,ie(this,"subscriptions",new Map),ie(this,"topicMap",new h2),ie(this,"events",new Ge.EventEmitter),ie(this,"name",tE),ie(this,"version",iE),ie(this,"pending",new Map),ie(this,"cached",[]),ie(this,"initialized",!1),ie(this,"storagePrefix",bt),ie(this,"subscribeTimeout",T.toMiliseconds(T.ONE_MINUTE)),ie(this,"initialSubscribeTimeout",T.toMiliseconds(T.ONE_SECOND*15)),ie(this,"clientId"),ie(this,"batchSubscribeTopicsLimit",500),ie(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),await this.restore()),this.initialized=!0}),ie(this,"subscribe",async(r,n)=>{this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:r,opts:n}});try{const s=tn(n),o={topic:r,relay:s,transportType:n?.transportType};this.pending.set(r,o);const a=await this.rpcSubscribe(r,s,n);return typeof a=="string"&&(this.onSubscribe(a,o),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:r,opts:n}})),a}catch(s){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(s),s}}),ie(this,"unsubscribe",async(r,n)=>{this.isInitialized(),typeof n?.id<"u"?await this.unsubscribeById(r,n.id,n):await this.unsubscribeByTopic(r,n)}),ie(this,"isSubscribed",r=>new Promise(n=>{n(this.topicMap.topics.includes(r))})),ie(this,"isKnownTopic",r=>new Promise(n=>{n(this.topicMap.topics.includes(r)||this.pending.has(r)||this.cached.some(s=>s.topic===r))})),ie(this,"on",(r,n)=>{this.events.on(r,n)}),ie(this,"once",(r,n)=>{this.events.once(r,n)}),ie(this,"off",(r,n)=>{this.events.off(r,n)}),ie(this,"removeListener",(r,n)=>{this.events.removeListener(r,n)}),ie(this,"start",async()=>{await this.onConnect()}),ie(this,"stop",async()=>{await this.onDisconnect()}),ie(this,"restart",async()=>{await this.restore(),await this.onRestart()}),ie(this,"checkPending",async()=>{if(this.pending.size===0&&(!this.initialized||!this.relayer.connected))return;const r=[];this.pending.forEach(n=>{r.push(n)}),await this.batchSubscribe(r)}),ie(this,"registerEventListeners",()=>{this.relayer.core.heartbeat.on(Ci.pulse,async()=>{await this.checkPending()}),this.events.on(Ve.created,async r=>{const n=Ve.created;this.logger.info(`Emitting ${n}`),this.logger.debug({type:"event",event:n,data:r}),await this.persist()}),this.events.on(Ve.deleted,async r=>{const n=Ve.deleted;this.logger.info(`Emitting ${n}`),this.logger.debug({type:"event",event:n,data:r}),await this.persist()})}),this.relayer=e,this.logger=Fe(i,this.name),this.clientId=""}get context(){return je(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}get hasAnyTopics(){return this.topicMap.topics.length>0||this.pending.size>0||this.cached.length>0||this.subscriptions.size>0}hasSubscription(e,i){let r=!1;try{r=this.getSubscription(e).topic===i}catch{}return r}reset(){this.cached=[],this.initialized=!0}onDisable(){this.values.length>0&&(this.cached=this.values),this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(e,i){const r=this.topicMap.get(e);await Promise.all(r.map(async n=>await this.unsubscribeById(e,n,i)))}async unsubscribeById(e,i,r){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:i,opts:r}});try{const n=tn(r);await this.restartToComplete({topic:e,id:i,relay:n}),await this.rpcUnsubscribe(e,i,n);const s=ne("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,i,s),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:i,opts:r}})}catch(n){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(n),n}}async rpcSubscribe(e,i,r){var n;(!r||r?.transportType===ce.relay)&&await this.restartToComplete({topic:e,id:e,relay:i});const s={method:Yi(i.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s});const o=(n=r?.internal)==null?void 0:n.throwOnFailedPublish;try{const a=await this.getSubscriptionId(e);if(r?.transportType===ce.link_mode)return setTimeout(()=>{(this.relayer.connected||this.relayer.connecting)&&this.relayer.request(s).catch(l=>this.logger.warn(l))},T.toMiliseconds(T.ONE_SECOND)),a;const c=new Promise(async l=>{const h=d=>{d.topic===e&&(this.events.removeListener(Ve.created,h),l(d.id))};this.events.on(Ve.created,h);try{const d=await kt(new Promise((f,p)=>{this.relayer.request(s).catch(g=>{this.logger.warn(g,g?.message),p(g)}).then(f)}),this.initialSubscribeTimeout,`Subscribing to ${e} failed, please try again`);this.events.removeListener(Ve.created,h),l(d)}catch{}}),u=await kt(c,this.subscribeTimeout,`Subscribing to ${e} failed, please try again`);if(!u&&o)throw new Error(`Subscribing to ${e} failed, please try again`);return u?a:null}catch(a){if(this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(be.connection_stalled),o)throw a}return null}async rpcBatchSubscribe(e){if(!e.length)return;const i=e[0].relay,r={method:Yi(i.protocol).batchSubscribe,params:{topics:e.map(n=>n.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:r});try{await await kt(new Promise(n=>{this.relayer.request(r).catch(s=>this.logger.warn(s)).then(n)}),this.subscribeTimeout,"rpcBatchSubscribe failed, please try again")}catch{this.relayer.events.emit(be.connection_stalled)}}async rpcBatchFetchMessages(e){if(!e.length)return;const i=e[0].relay,r={method:Yi(i.protocol).batchFetchMessages,params:{topics:e.map(s=>s.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:r});let n;try{n=await await kt(new Promise((s,o)=>{this.relayer.request(r).catch(a=>{this.logger.warn(a),o(a)}).then(s)}),this.subscribeTimeout,"rpcBatchFetchMessages failed, please try again")}catch{this.relayer.events.emit(be.connection_stalled)}return n}rpcUnsubscribe(e,i,r){const n={method:Yi(r.protocol).unsubscribe,params:{topic:e,id:i}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n}),this.relayer.request(n)}onSubscribe(e,i){this.setSubscription(e,ns(Wi({},i),{id:e})),this.pending.delete(i.topic)}onBatchSubscribe(e){e.length&&e.forEach(i=>{this.setSubscription(i.id,Wi({},i)),this.pending.delete(i.topic)})}async onUnsubscribe(e,i,r){this.events.removeAllListeners(i),this.hasSubscription(i,e)&&this.deleteSubscription(i,r),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,i){this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:i}),this.addSubscription(e,i)}addSubscription(e,i){this.subscriptions.set(e,Wi({},i)),this.topicMap.set(i.topic,e),this.events.emit(Ve.created,i)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const i=this.subscriptions.get(e);if(!i){const{message:r}=F("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(r)}return i}deleteSubscription(e,i){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:i});const r=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(r.topic,e),this.events.emit(Ve.deleted,ns(Wi({},r),{reason:i}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(Ve.sync)}async onRestart(){if(this.cached.length){const e=[...this.cached],i=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let r=0;r<i;r++){const n=e.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(n)}}this.events.emit(Ve.resubscribed)}async restore(){try{const e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size){const{message:i}=F("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(i),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(i)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async batchSubscribe(e){e.length&&(await this.rpcBatchSubscribe(e),this.onBatchSubscribe(await Promise.all(e.map(async i=>ns(Wi({},i),{id:await this.getSubscriptionId(i.topic)})))))}async batchFetchMessages(e){if(!e.length)return;this.logger.trace(`Fetching batch messages for ${e.length} subscriptions`);const i=await this.rpcBatchFetchMessages(e);i&&i.messages&&(await hb(T.toMiliseconds(T.ONE_SECOND)),await this.relayer.handleBatchMessageEvents(i.messages))}async onConnect(){await this.restart(),this.reset()}onDisconnect(){this.onDisable()}isInitialized(){if(!this.initialized){const{message:e}=F("NOT_INITIALIZED",this.name);throw new Error(e)}}async restartToComplete(e){!this.relayer.connected&&!this.relayer.connecting&&(this.cached.push(e),await this.relayer.transportOpen())}async getClientId(){return this.clientId||(this.clientId=await this.relayer.core.crypto.getClientId()),this.clientId}async getSubscriptionId(e){return wt(e+await this.getClientId())}}var m2=Object.defineProperty,Nc=Object.getOwnPropertySymbols,b2=Object.prototype.hasOwnProperty,v2=Object.prototype.propertyIsEnumerable,js=(t,e,i)=>e in t?m2(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,Fc=(t,e)=>{for(var i in e||(e={}))b2.call(e,i)&&js(t,i,e[i]);if(Nc)for(var i of Nc(e))v2.call(e,i)&&js(t,i,e[i]);return t},Q=(t,e,i)=>js(t,typeof e!="symbol"?e+"":e,i);class E2 extends Cp{constructor(e){super(e),Q(this,"protocol","wc"),Q(this,"version",2),Q(this,"core"),Q(this,"logger"),Q(this,"events",new Ge.EventEmitter),Q(this,"provider"),Q(this,"messages"),Q(this,"subscriber"),Q(this,"publisher"),Q(this,"name",Jv),Q(this,"transportExplicitlyClosed",!1),Q(this,"initialized",!1),Q(this,"connectionAttemptInProgress",!1),Q(this,"relayUrl"),Q(this,"projectId"),Q(this,"packageName"),Q(this,"bundleId"),Q(this,"hasExperiencedNetworkDisruption",!1),Q(this,"pingTimeout"),Q(this,"heartBeatTimeout",T.toMiliseconds(T.THIRTY_SECONDS+T.FIVE_SECONDS)),Q(this,"reconnectTimeout"),Q(this,"connectPromise"),Q(this,"reconnectInProgress",!1),Q(this,"requestsInFlight",[]),Q(this,"connectTimeout",T.toMiliseconds(T.ONE_SECOND*15)),Q(this,"request",async i=>{var r,n;this.logger.debug("Publishing Request Payload");const s=i.id||Qt().toString();await this.toEstablishConnection();try{this.logger.trace({id:s,method:i.method,topic:(r=i.params)==null?void 0:r.topic},"relayer.request - publishing...");const o=`${s}:${((n=i.params)==null?void 0:n.tag)||""}`;this.requestsInFlight.push(o);const a=await this.provider.request(i);return this.requestsInFlight=this.requestsInFlight.filter(c=>c!==o),a}catch(o){throw this.logger.debug(`Failed to Publish Request: ${s}`),o}}),Q(this,"resetPingTimeout",()=>{Xr()&&(clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(()=>{var i,r,n,s;try{this.logger.debug({},"pingTimeout: Connection stalled, terminating..."),(s=(n=(r=(i=this.provider)==null?void 0:i.connection)==null?void 0:r.socket)==null?void 0:n.terminate)==null||s.call(n)}catch(o){this.logger.warn(o,o?.message)}},this.heartBeatTimeout))}),Q(this,"onPayloadHandler",i=>{this.onProviderPayload(i),this.resetPingTimeout()}),Q(this,"onConnectHandler",()=>{this.logger.warn({},"Relayer connected "),this.startPingTimeout(),this.events.emit(be.connect)}),Q(this,"onDisconnectHandler",()=>{this.logger.warn({},"Relayer disconnected "),this.requestsInFlight=[],this.onProviderDisconnect()}),Q(this,"onProviderErrorHandler",i=>{this.logger.fatal(`Fatal socket error: ${i.message}`),this.events.emit(be.error,i),this.logger.fatal("Fatal socket error received, closing transport"),this.transportClose()}),Q(this,"registerProviderListeners",()=>{this.provider.on(Je.payload,this.onPayloadHandler),this.provider.on(Je.connect,this.onConnectHandler),this.provider.on(Je.disconnect,this.onDisconnectHandler),this.provider.on(Je.error,this.onProviderErrorHandler)}),this.core=e.core,this.logger=typeof e.logger<"u"&&typeof e.logger!="string"?Fe(e.logger,this.name):un(Ys({level:e.logger||Yv})),this.messages=new i2(this.logger,e.core),this.subscriber=new w2(this,this.logger),this.publisher=new c2(this,this.logger),this.relayUrl=e?.relayUrl||oh,this.projectId=e.projectId,Gm()?this.packageName=Pa():Ym()&&(this.bundleId=Pa()),this.provider={}}async init(){if(this.logger.trace("Initialized"),this.registerEventListeners(),await Promise.all([this.messages.init(),this.subscriber.init()]),this.initialized=!0,this.subscriber.hasAnyTopics)try{await this.transportOpen()}catch(e){this.logger.warn(e,e?.message)}}get context(){return je(this.logger)}get connected(){var e,i,r;return((r=(i=(e=this.provider)==null?void 0:e.connection)==null?void 0:i.socket)==null?void 0:r.readyState)===1||!1}get connecting(){var e,i,r;return((r=(i=(e=this.provider)==null?void 0:e.connection)==null?void 0:i.socket)==null?void 0:r.readyState)===0||this.connectPromise!==void 0||!1}async publish(e,i,r){this.isInitialized(),await this.publisher.publish(e,i,r),await this.recordMessageEvent({topic:e,message:i,publishedAt:Date.now(),transportType:ce.relay},Hr.outbound)}async subscribe(e,i){var r,n,s;this.isInitialized(),(!(i!=null&&i.transportType)||i?.transportType==="relay")&&await this.toEstablishConnection();const o=typeof((r=i?.internal)==null?void 0:r.throwOnFailedPublish)>"u"?!0:(n=i?.internal)==null?void 0:n.throwOnFailedPublish;let a=((s=this.subscriber.topicMap.get(e))==null?void 0:s[0])||"",c;const u=l=>{l.topic===e&&(this.subscriber.off(Ve.created,u),c())};return await Promise.all([new Promise(l=>{c=l,this.subscriber.on(Ve.created,u)}),new Promise(async(l,h)=>{a=await this.subscriber.subscribe(e,Fc({internal:{throwOnFailedPublish:o}},i)).catch(d=>{o&&h(d)})||a,l()})]),a}async unsubscribe(e,i){this.isInitialized(),await this.subscriber.unsubscribe(e,i)}on(e,i){this.events.on(e,i)}once(e,i){this.events.once(e,i)}off(e,i){this.events.off(e,i)}removeListener(e,i){this.events.removeListener(e,i)}async transportDisconnect(){this.provider.disconnect&&(this.hasExperiencedNetworkDisruption||this.connected)?await kt(this.provider.disconnect(),2e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.onProviderDisconnect()}async transportClose(){this.transportExplicitlyClosed=!0,await this.transportDisconnect()}async transportOpen(e){if(!this.subscriber.hasAnyTopics){this.logger.warn("Starting WS connection skipped because the client has no topics to work with.");return}if(this.connectPromise?(this.logger.debug({},"Waiting for existing connection attempt to resolve..."),await this.connectPromise,this.logger.debug({},"Existing connection attempt resolved")):(this.connectPromise=new Promise(async(i,r)=>{await this.connect(e).then(i).catch(r).finally(()=>{this.connectPromise=void 0})}),await this.connectPromise),!this.connected)throw new Error(`Couldn't establish socket connection to the relay server: ${this.relayUrl}`)}async restartTransport(e){this.logger.debug({},"Restarting transport..."),!this.connectionAttemptInProgress&&(this.relayUrl=e||this.relayUrl,await this.confirmOnlineStateOrThrow(),await this.transportClose(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await gc())throw new Error("No internet connection detected. Please restart your network and try again.")}async handleBatchMessageEvents(e){if(e?.length===0){this.logger.trace("Batch message events is empty. Ignoring...");return}const i=e.sort((r,n)=>r.publishedAt-n.publishedAt);this.logger.debug(`Batch of ${i.length} message events sorted`);for(const r of i)try{await this.onMessageEvent(r)}catch(n){this.logger.warn(n,"Error while processing batch message event: "+n?.message)}this.logger.trace(`Batch of ${i.length} message events processed`)}async onLinkMessageEvent(e,i){const{topic:r}=e;if(!i.sessionExists){const n=pe(T.FIVE_MINUTES),s={topic:r,expiry:n,relay:{protocol:"irn"},active:!1};await this.core.pairing.pairings.set(r,s)}this.events.emit(be.message,e),await this.recordMessageEvent(e,Hr.inbound)}async connect(e){await this.confirmOnlineStateOrThrow(),e&&e!==this.relayUrl&&(this.relayUrl=e,await this.transportDisconnect()),this.connectionAttemptInProgress=!0,this.transportExplicitlyClosed=!1;let i=1;for(;i<6;){try{if(this.transportExplicitlyClosed)break;this.logger.debug({},`Connecting to ${this.relayUrl}, attempt: ${i}...`),await this.createProvider(),await new Promise(async(r,n)=>{const s=()=>{n(new Error("Connection interrupted while trying to subscribe"))};this.provider.once(Je.disconnect,s),await kt(new Promise((o,a)=>{this.provider.connect().then(o).catch(a)}),this.connectTimeout,`Socket stalled when trying to connect to ${this.relayUrl}`).catch(o=>{n(o)}).finally(()=>{this.provider.off(Je.disconnect,s),clearTimeout(this.reconnectTimeout)}),await new Promise(async(o,a)=>{const c=()=>{a(new Error("Connection interrupted while trying to subscribe"))};this.provider.once(Je.disconnect,c),await this.subscriber.start().then(o).catch(a).finally(()=>{this.provider.off(Je.disconnect,c)})}),this.hasExperiencedNetworkDisruption=!1,r()})}catch(r){await this.subscriber.stop();const n=r;this.logger.warn({},n.message),this.hasExperiencedNetworkDisruption=!0}finally{this.connectionAttemptInProgress=!1}if(this.connected){this.logger.debug({},`Connected to ${this.relayUrl} successfully on attempt: ${i}`);break}await new Promise(r=>setTimeout(r,T.toMiliseconds(i*1))),i++}}startPingTimeout(){var e,i,r,n,s;if(Xr())try{(i=(e=this.provider)==null?void 0:e.connection)!=null&&i.socket&&((s=(n=(r=this.provider)==null?void 0:r.connection)==null?void 0:n.socket)==null||s.on("ping",()=>{this.resetPingTimeout()})),this.resetPingTimeout()}catch(o){this.logger.warn(o,o?.message)}}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const e=await this.core.crypto.signJWT(this.relayUrl);this.provider=new ih(new kv(eb({sdkVersion:Ls,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e,useOnCloseEvent:!0,bundleId:this.bundleId,packageName:this.packageName}))),this.registerProviderListeners()}async recordMessageEvent(e,i){const{topic:r,message:n}=e;await this.messages.set(r,n,i)}async shouldIgnoreMessageEvent(e){const{topic:i,message:r}=e;if(!r||r.length===0)return this.logger.warn(`Ignoring invalid/empty message: ${r}`),!0;if(!await this.subscriber.isKnownTopic(i))return this.logger.warn(`Ignoring message for unknown topic ${i}`),!0;const n=this.messages.has(i,r);return n&&this.logger.warn(`Ignoring duplicate message: ${r}`),n}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),bo(e)){if(!e.method.endsWith(Zv))return;const i=e.params,{topic:r,message:n,publishedAt:s,attestation:o}=i.data,a={topic:r,message:n,publishedAt:s,transportType:ce.relay,attestation:o};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(Fc({type:"event",event:i.id},a)),this.events.emit(i.id,a),await this.acknowledgePayload(e),await this.onMessageEvent(a)}else En(e)&&this.events.emit(be.message_ack,e)}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(await this.recordMessageEvent(e,Hr.inbound),this.events.emit(be.message,e))}async acknowledgePayload(e){const i=bn(e.id,!0);await this.provider.connection.send(i)}unregisterProviderListeners(){this.provider.off(Je.payload,this.onPayloadHandler),this.provider.off(Je.connect,this.onConnectHandler),this.provider.off(Je.disconnect,this.onDisconnectHandler),this.provider.off(Je.error,this.onProviderErrorHandler),clearTimeout(this.pingTimeout)}async registerEventListeners(){let e=await gc();gv(async i=>{e!==i&&(e=i,i?await this.transportOpen().catch(r=>this.logger.error(r,r?.message)):(this.hasExperiencedNetworkDisruption=!0,await this.transportDisconnect(),this.transportExplicitlyClosed=!1))})}async onProviderDisconnect(){clearTimeout(this.pingTimeout),this.events.emit(be.disconnect),this.connectionAttemptInProgress=!1,!this.reconnectInProgress&&(this.reconnectInProgress=!0,await this.subscriber.stop(),this.subscriber.hasAnyTopics&&(this.transportExplicitlyClosed||(this.reconnectTimeout=setTimeout(async()=>{await this.transportOpen().catch(e=>this.logger.error(e,e?.message)),this.reconnectTimeout=void 0,this.reconnectInProgress=!1},T.toMiliseconds(Qv)))))}isInitialized(){if(!this.initialized){const{message:e}=F("NOT_INITIALIZED",this.name);throw new Error(e)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectPromise){await this.connectPromise;return}await this.connect()}}}function _2(){}function Lc(t){if(!t||typeof t!="object")return!1;const e=Object.getPrototypeOf(t);return e===null||e===Object.prototype||Object.getPrototypeOf(e)===null?Object.prototype.toString.call(t)==="[object Object]":!1}function Bc(t){return Object.getOwnPropertySymbols(t).filter(e=>Object.prototype.propertyIsEnumerable.call(t,e))}function Uc(t){return t==null?t===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(t)}const I2="[object RegExp]",D2="[object String]",S2="[object Number]",$2="[object Boolean]",kc="[object Arguments]",x2="[object Symbol]",O2="[object Date]",A2="[object Map]",P2="[object Set]",C2="[object Array]",R2="[object Function]",T2="[object ArrayBuffer]",ss="[object Object]",N2="[object Error]",F2="[object DataView]",L2="[object Uint8Array]",B2="[object Uint8ClampedArray]",U2="[object Uint16Array]",k2="[object Uint32Array]",M2="[object BigUint64Array]",q2="[object Int8Array]",j2="[object Int16Array]",z2="[object Int32Array]",V2="[object BigInt64Array]",K2="[object Float32Array]",H2="[object Float64Array]";function W2(t,e){return t===e||Number.isNaN(t)&&Number.isNaN(e)}function G2(t,e,i){return Ji(t,e,void 0,void 0,void 0,void 0,i)}function Ji(t,e,i,r,n,s,o){const a=o(t,e,i,r,n,s);if(a!==void 0)return a;if(typeof t==typeof e)switch(typeof t){case"bigint":case"string":case"boolean":case"symbol":case"undefined":return t===e;case"number":return t===e||Object.is(t,e);case"function":return t===e;case"object":return tr(t,e,s,o)}return tr(t,e,s,o)}function tr(t,e,i,r){if(Object.is(t,e))return!0;let n=Uc(t),s=Uc(e);if(n===kc&&(n=ss),s===kc&&(s=ss),n!==s)return!1;switch(n){case D2:return t.toString()===e.toString();case S2:{const c=t.valueOf(),u=e.valueOf();return W2(c,u)}case $2:case O2:case x2:return Object.is(t.valueOf(),e.valueOf());case I2:return t.source===e.source&&t.flags===e.flags;case R2:return t===e}i=i??new Map;const o=i.get(t),a=i.get(e);if(o!=null&&a!=null)return o===e;i.set(t,e),i.set(e,t);try{switch(n){case A2:{if(t.size!==e.size)return!1;for(const[c,u]of t.entries())if(!e.has(c)||!Ji(u,e.get(c),c,t,e,i,r))return!1;return!0}case P2:{if(t.size!==e.size)return!1;const c=Array.from(t.values()),u=Array.from(e.values());for(let l=0;l<c.length;l++){const h=c[l],d=u.findIndex(f=>Ji(h,f,void 0,t,e,i,r));if(d===-1)return!1;u.splice(d,1)}return!0}case C2:case L2:case B2:case U2:case k2:case M2:case q2:case j2:case z2:case V2:case K2:case H2:{if(typeof Buffer<"u"&&Buffer.isBuffer(t)!==Buffer.isBuffer(e)||t.length!==e.length)return!1;for(let c=0;c<t.length;c++)if(!Ji(t[c],e[c],c,t,e,i,r))return!1;return!0}case T2:return t.byteLength!==e.byteLength?!1:tr(new Uint8Array(t),new Uint8Array(e),i,r);case F2:return t.byteLength!==e.byteLength||t.byteOffset!==e.byteOffset?!1:tr(new Uint8Array(t),new Uint8Array(e),i,r);case N2:return t.name===e.name&&t.message===e.message;case ss:{if(!(tr(t.constructor,e.constructor,i,r)||Lc(t)&&Lc(e)))return!1;const c=[...Object.keys(t),...Bc(t)],u=[...Object.keys(e),...Bc(e)];if(c.length!==u.length)return!1;for(let l=0;l<c.length;l++){const h=c[l],d=t[h];if(!Object.hasOwn(e,h))return!1;const f=e[h];if(!Ji(d,f,h,t,e,i,r))return!1}return!0}default:return!1}}finally{i.delete(t),i.delete(e)}}function Y2(t,e){return G2(t,e,_2)}var J2=Object.defineProperty,Mc=Object.getOwnPropertySymbols,Z2=Object.prototype.hasOwnProperty,Q2=Object.prototype.propertyIsEnumerable,zs=(t,e,i)=>e in t?J2(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,qc=(t,e)=>{for(var i in e||(e={}))Z2.call(e,i)&&zs(t,i,e[i]);if(Mc)for(var i of Mc(e))Q2.call(e,i)&&zs(t,i,e[i]);return t},Be=(t,e,i)=>zs(t,typeof e!="symbol"?e+"":e,i);class ui extends Rp{constructor(e,i,r,n=bt,s=void 0){super(e,i,r,n),this.core=e,this.logger=i,this.name=r,Be(this,"map",new Map),Be(this,"version",Xv),Be(this,"cached",[]),Be(this,"initialized",!1),Be(this,"getKey"),Be(this,"storagePrefix",bt),Be(this,"recentlyDeleted",[]),Be(this,"recentlyDeletedLimit",200),Be(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(o=>{this.getKey&&o!==null&&!$e(o)?this.map.set(this.getKey(o),o):H0(o)?this.map.set(o.id,o):W0(o)&&this.map.set(o.topic,o)}),this.cached=[],this.initialized=!0)}),Be(this,"set",async(o,a)=>{this.isInitialized(),this.map.has(o)?await this.update(o,a):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:o,value:a}),this.map.set(o,a),await this.persist())}),Be(this,"get",o=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:o}),this.getData(o))),Be(this,"getAll",o=>(this.isInitialized(),o?this.values.filter(a=>Object.keys(o).every(c=>Y2(a[c],o[c]))):this.values)),Be(this,"update",async(o,a)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:o,update:a});const c=qc(qc({},this.getData(o)),a);this.map.set(o,c),await this.persist()}),Be(this,"delete",async(o,a)=>{this.isInitialized(),this.map.has(o)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:o,reason:a}),this.map.delete(o),this.addToRecentlyDeleted(o),await this.persist())}),this.logger=Fe(i,this.name),this.storagePrefix=n,this.getKey=s}get context(){return je(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}addToRecentlyDeleted(e){this.recentlyDeleted.push(e),this.recentlyDeleted.length>=this.recentlyDeletedLimit&&this.recentlyDeleted.splice(0,this.recentlyDeletedLimit/2)}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){const i=this.map.get(e);if(!i){if(this.recentlyDeleted.includes(e)){const{message:n}=F("MISSING_OR_INVALID",`Record was recently deleted - ${this.name}: ${e}`);throw this.logger.error(n),new Error(n)}const{message:r}=F("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(r),new Error(r)}return i}async persist(){await this.setDataStore(this.values)}async restore(){try{const e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){const{message:i}=F("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(i),new Error(i)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){const{message:e}=F("NOT_INITIALIZED",this.name);throw new Error(e)}}}var X2=Object.defineProperty,eI=(t,e,i)=>e in t?X2(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,W=(t,e,i)=>eI(t,typeof e!="symbol"?e+"":e,i);class tI{constructor(e,i){this.core=e,this.logger=i,W(this,"name",rE),W(this,"version",nE),W(this,"events",new ou),W(this,"pairings"),W(this,"initialized",!1),W(this,"storagePrefix",bt),W(this,"ignoredPayloadTypes",[Rt]),W(this,"registeredMethods",[]),W(this,"init",async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))}),W(this,"register",({methods:r})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...r])]}),W(this,"create",async r=>{this.isInitialized();const n=Fs(),s=await this.core.crypto.setSymKey(n),o=pe(T.FIVE_MINUTES),a={protocol:sh},c={topic:s,expiry:o,relay:a,active:!1,methods:r?.methods},u=uc({protocol:this.core.protocol,version:this.core.version,topic:s,symKey:n,relay:a,expiryTimestamp:o,methods:r?.methods});return this.events.emit(Jt.create,c),this.core.expirer.set(s,o),await this.pairings.set(s,c),await this.core.relayer.subscribe(s,{transportType:r?.transportType}),{topic:s,uri:u}}),W(this,"pair",async r=>{this.isInitialized();const n=this.core.eventClient.createEvent({properties:{topic:r?.uri,trace:[dt.pairing_started]}});this.isValidPair(r,n);const{topic:s,symKey:o,relay:a,expiryTimestamp:c,methods:u}=cc(r.uri);n.props.properties.topic=s,n.addTrace(dt.pairing_uri_validation_success),n.addTrace(dt.pairing_uri_not_expired);let l;if(this.pairings.keys.includes(s)){if(l=this.pairings.get(s),n.addTrace(dt.existing_pairing),l.active)throw n.setError(xt.active_pairing_already_exists),new Error(`Pairing already exists: ${s}. Please try again with a new connection URI.`);n.addTrace(dt.pairing_not_expired)}const h=c||pe(T.FIVE_MINUTES),d={topic:s,relay:a,expiry:h,active:!1,methods:u};this.core.expirer.set(s,h),await this.pairings.set(s,d),n.addTrace(dt.store_new_pairing),r.activatePairing&&await this.activate({topic:s}),this.events.emit(Jt.create,d),n.addTrace(dt.emit_inactive_pairing),this.core.crypto.keychain.has(s)||await this.core.crypto.setSymKey(o,s),n.addTrace(dt.subscribing_pairing_topic);try{await this.core.relayer.confirmOnlineStateOrThrow()}catch{n.setError(xt.no_internet_connection)}try{await this.core.relayer.subscribe(s,{relay:a})}catch(f){throw n.setError(xt.subscribe_pairing_topic_failure),f}return n.addTrace(dt.subscribe_pairing_topic_success),d}),W(this,"activate",async({topic:r})=>{this.isInitialized();const n=pe(T.FIVE_MINUTES);this.core.expirer.set(r,n),await this.pairings.update(r,{active:!0,expiry:n})}),W(this,"ping",async r=>{this.isInitialized(),await this.isValidPing(r),this.logger.warn("ping() is deprecated and will be removed in the next major release.");const{topic:n}=r;if(this.pairings.keys.includes(n)){const s=await this.sendRequest(n,"wc_pairingPing",{}),{done:o,resolve:a,reject:c}=Wt();this.events.once(X("pairing_ping",s),({error:u})=>{u?c(u):a()}),await o()}}),W(this,"updateExpiry",async({topic:r,expiry:n})=>{this.isInitialized(),await this.pairings.update(r,{expiry:n})}),W(this,"updateMetadata",async({topic:r,metadata:n})=>{this.isInitialized(),await this.pairings.update(r,{peerMetadata:n})}),W(this,"getPairings",()=>(this.isInitialized(),this.pairings.values)),W(this,"disconnect",async r=>{this.isInitialized(),await this.isValidDisconnect(r);const{topic:n}=r;this.pairings.keys.includes(n)&&(await this.sendRequest(n,"wc_pairingDelete",ne("USER_DISCONNECTED")),await this.deletePairing(n))}),W(this,"formatUriFromPairing",r=>{this.isInitialized();const{topic:n,relay:s,expiry:o,methods:a}=r,c=this.core.crypto.keychain.get(n);return uc({protocol:this.core.protocol,version:this.core.version,topic:n,symKey:c,relay:s,expiryTimestamp:o,methods:a})}),W(this,"sendRequest",async(r,n,s)=>{const o=Xt(n,s),a=await this.core.crypto.encode(r,o),c=Ki[n].req;return this.core.history.set(r,o),this.core.relayer.publish(r,a,c),o.id}),W(this,"sendResult",async(r,n,s)=>{const o=bn(r,s),a=await this.core.crypto.encode(n,o),c=(await this.core.history.get(n,r)).request.method,u=Ki[c].res;await this.core.relayer.publish(n,a,u),await this.core.history.resolve(o)}),W(this,"sendError",async(r,n,s)=>{const o=vn(r,s),a=await this.core.crypto.encode(n,o),c=(await this.core.history.get(n,r)).request.method,u=Ki[c]?Ki[c].res:Ki.unregistered_method.res;await this.core.relayer.publish(n,a,u),await this.core.history.resolve(o)}),W(this,"deletePairing",async(r,n)=>{await this.core.relayer.unsubscribe(r),await Promise.all([this.pairings.delete(r,ne("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(r),n?Promise.resolve():this.core.expirer.del(r)])}),W(this,"cleanup",async()=>{const r=this.pairings.getAll().filter(n=>Bt(n.expiry));await Promise.all(r.map(n=>this.deletePairing(n.topic)))}),W(this,"onRelayEventRequest",async r=>{const{topic:n,payload:s}=r;switch(s.method){case"wc_pairingPing":return await this.onPairingPingRequest(n,s);case"wc_pairingDelete":return await this.onPairingDeleteRequest(n,s);default:return await this.onUnknownRpcMethodRequest(n,s)}}),W(this,"onRelayEventResponse",async r=>{const{topic:n,payload:s}=r,o=(await this.core.history.get(n,s.id)).request.method;switch(o){case"wc_pairingPing":return this.onPairingPingResponse(n,s);default:return this.onUnknownRpcMethodResponse(o)}}),W(this,"onPairingPingRequest",async(r,n)=>{const{id:s}=n;try{this.isValidPing({topic:r}),await this.sendResult(s,r,!0),this.events.emit(Jt.ping,{id:s,topic:r})}catch(o){await this.sendError(s,r,o),this.logger.error(o)}}),W(this,"onPairingPingResponse",(r,n)=>{const{id:s}=n;setTimeout(()=>{ft(n)?this.events.emit(X("pairing_ping",s),{}):Qe(n)&&this.events.emit(X("pairing_ping",s),{error:n.error})},500)}),W(this,"onPairingDeleteRequest",async(r,n)=>{const{id:s}=n;try{this.isValidDisconnect({topic:r}),await this.deletePairing(r),this.events.emit(Jt.delete,{id:s,topic:r})}catch(o){await this.sendError(s,r,o),this.logger.error(o)}}),W(this,"onUnknownRpcMethodRequest",async(r,n)=>{const{id:s,method:o}=n;try{if(this.registeredMethods.includes(o))return;const a=ne("WC_METHOD_UNSUPPORTED",o);await this.sendError(s,r,a),this.logger.error(a)}catch(a){await this.sendError(s,r,a),this.logger.error(a)}}),W(this,"onUnknownRpcMethodResponse",r=>{this.registeredMethods.includes(r)||this.logger.error(ne("WC_METHOD_UNSUPPORTED",r))}),W(this,"isValidPair",(r,n)=>{var s;if(!ke(r)){const{message:a}=F("MISSING_OR_INVALID",`pair() params: ${r}`);throw n.setError(xt.malformed_pairing_uri),new Error(a)}if(!K0(r.uri)){const{message:a}=F("MISSING_OR_INVALID",`pair() uri: ${r.uri}`);throw n.setError(xt.malformed_pairing_uri),new Error(a)}const o=cc(r?.uri);if(!((s=o?.relay)!=null&&s.protocol)){const{message:a}=F("MISSING_OR_INVALID","pair() uri#relay-protocol");throw n.setError(xt.malformed_pairing_uri),new Error(a)}if(!(o!=null&&o.symKey)){const{message:a}=F("MISSING_OR_INVALID","pair() uri#symKey");throw n.setError(xt.malformed_pairing_uri),new Error(a)}if(o!=null&&o.expiryTimestamp&&T.toMiliseconds(o?.expiryTimestamp)<Date.now()){n.setError(xt.pairing_expired);const{message:a}=F("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw new Error(a)}}),W(this,"isValidPing",async r=>{if(!ke(r)){const{message:s}=F("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(s)}const{topic:n}=r;await this.isValidPairingTopic(n)}),W(this,"isValidDisconnect",async r=>{if(!ke(r)){const{message:s}=F("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(s)}const{topic:n}=r;await this.isValidPairingTopic(n)}),W(this,"isValidPairingTopic",async r=>{if(!de(r,!1)){const{message:n}=F("MISSING_OR_INVALID",`pairing topic should be a string: ${r}`);throw new Error(n)}if(!this.pairings.keys.includes(r)){const{message:n}=F("NO_MATCHING_KEY",`pairing topic doesn't exist: ${r}`);throw new Error(n)}if(Bt(this.pairings.get(r).expiry)){await this.deletePairing(r);const{message:n}=F("EXPIRED",`pairing topic: ${r}`);throw new Error(n)}}),this.core=e,this.logger=Fe(i,this.name),this.pairings=new ui(this.core,this.logger,this.name,this.storagePrefix)}get context(){return je(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=F("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(be.message,async e=>{const{topic:i,message:r,transportType:n}=e;if(this.pairings.keys.includes(i)&&n!==ce.link_mode&&!this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(r)))try{const s=await this.core.crypto.decode(i,r);bo(s)?(this.core.history.set(i,s),await this.onRelayEventRequest({topic:i,payload:s})):En(s)&&(await this.core.history.resolve(s),await this.onRelayEventResponse({topic:i,payload:s}),this.core.history.delete(i,s.id)),await this.core.relayer.messages.ack(i,r)}catch(s){this.logger.error(s)}})}registerExpirerEvents(){this.core.expirer.on(Ze.expired,async e=>{const{topic:i}=gl(e.target);i&&this.pairings.keys.includes(i)&&(await this.deletePairing(i,!0),this.events.emit(Jt.expire,{topic:i}))})}}var iI=Object.defineProperty,rI=(t,e,i)=>e in t?iI(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,Se=(t,e,i)=>rI(t,typeof e!="symbol"?e+"":e,i);class nI extends Op{constructor(e,i){super(e,i),this.core=e,this.logger=i,Se(this,"records",new Map),Se(this,"events",new Ge.EventEmitter),Se(this,"name",sE),Se(this,"version",oE),Se(this,"cached",[]),Se(this,"initialized",!1),Se(this,"storagePrefix",bt),Se(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(r=>this.records.set(r.id,r)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),Se(this,"set",(r,n,s)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:r,request:n,chainId:s}),this.records.has(n.id))return;const o={id:n.id,topic:r,request:{method:n.method,params:n.params||null},chainId:s,expiry:pe(T.THIRTY_DAYS)};this.records.set(o.id,o),this.persist(),this.events.emit(tt.created,o)}),Se(this,"resolve",async r=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:r}),!this.records.has(r.id))return;const n=await this.getRecord(r.id);typeof n.response>"u"&&(n.response=Qe(r)?{error:r.error}:{result:r.result},this.records.set(n.id,n),this.persist(),this.events.emit(tt.updated,n))}),Se(this,"get",async(r,n)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:r,id:n}),await this.getRecord(n))),Se(this,"delete",(r,n)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:n}),this.values.forEach(s=>{if(s.topic===r){if(typeof n<"u"&&s.id!==n)return;this.records.delete(s.id),this.events.emit(tt.deleted,s)}}),this.persist()}),Se(this,"exists",async(r,n)=>(this.isInitialized(),this.records.has(n)?(await this.getRecord(n)).topic===r:!1)),Se(this,"on",(r,n)=>{this.events.on(r,n)}),Se(this,"once",(r,n)=>{this.events.once(r,n)}),Se(this,"off",(r,n)=>{this.events.off(r,n)}),Se(this,"removeListener",(r,n)=>{this.events.removeListener(r,n)}),this.logger=Fe(i,this.name)}get context(){return je(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(i=>{if(typeof i.response<"u")return;const r={topic:i.topic,request:Xt(i.request.method,i.request.params,i.id),chainId:i.chainId};return e.push(r)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();const i=this.records.get(e);if(!i){const{message:r}=F("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(r)}return i}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(tt.sync)}async restore(){try{const e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){const{message:i}=F("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(i),new Error(i)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(tt.created,e=>{const i=tt.created;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,record:e})}),this.events.on(tt.updated,e=>{const i=tt.updated;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,record:e})}),this.events.on(tt.deleted,e=>{const i=tt.deleted;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,record:e})}),this.core.heartbeat.on(Ci.pulse,()=>{this.cleanup()})}cleanup(){try{this.isInitialized();let e=!1;this.records.forEach(i=>{T.toMiliseconds(i.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${i.id}`),this.records.delete(i.id),this.events.emit(tt.deleted,i,!1),e=!0)}),e&&this.persist()}catch(e){this.logger.warn(e)}}isInitialized(){if(!this.initialized){const{message:e}=F("NOT_INITIALIZED",this.name);throw new Error(e)}}}var sI=Object.defineProperty,oI=(t,e,i)=>e in t?sI(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,Ce=(t,e,i)=>oI(t,typeof e!="symbol"?e+"":e,i);class aI extends Np{constructor(e,i){super(e,i),this.core=e,this.logger=i,Ce(this,"expirations",new Map),Ce(this,"events",new Ge.EventEmitter),Ce(this,"name",aE),Ce(this,"version",cE),Ce(this,"cached",[]),Ce(this,"initialized",!1),Ce(this,"storagePrefix",bt),Ce(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(r=>this.expirations.set(r.target,r)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),Ce(this,"has",r=>{try{const n=this.formatTarget(r);return typeof this.getExpiration(n)<"u"}catch{return!1}}),Ce(this,"set",(r,n)=>{this.isInitialized();const s=this.formatTarget(r),o={target:s,expiry:n};this.expirations.set(s,o),this.checkExpiry(s,o),this.events.emit(Ze.created,{target:s,expiration:o})}),Ce(this,"get",r=>{this.isInitialized();const n=this.formatTarget(r);return this.getExpiration(n)}),Ce(this,"del",r=>{if(this.isInitialized(),this.has(r)){const n=this.formatTarget(r),s=this.getExpiration(n);this.expirations.delete(n),this.events.emit(Ze.deleted,{target:n,expiration:s})}}),Ce(this,"on",(r,n)=>{this.events.on(r,n)}),Ce(this,"once",(r,n)=>{this.events.once(r,n)}),Ce(this,"off",(r,n)=>{this.events.off(r,n)}),Ce(this,"removeListener",(r,n)=>{this.events.removeListener(r,n)}),this.logger=Fe(i,this.name)}get context(){return je(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e=="string")return tb(e);if(typeof e=="number")return ib(e);const{message:i}=F("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw new Error(i)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(Ze.sync)}async restore(){try{const e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){const{message:i}=F("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(i),new Error(i)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){const i=this.expirations.get(e);if(!i){const{message:r}=F("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.warn(r),new Error(r)}return i}checkExpiry(e,i){const{expiry:r}=i;T.toMiliseconds(r)-Date.now()<=0&&this.expire(e,i)}expire(e,i){this.expirations.delete(e),this.events.emit(Ze.expired,{target:e,expiration:i})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((e,i)=>this.checkExpiry(i,e))}registerEventListeners(){this.core.heartbeat.on(Ci.pulse,()=>this.checkExpirations()),this.events.on(Ze.created,e=>{const i=Ze.created;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:e}),this.persist()}),this.events.on(Ze.expired,e=>{const i=Ze.expired;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:e}),this.persist()}),this.events.on(Ze.deleted,e=>{const i=Ze.deleted;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=F("NOT_INITIALIZED",this.name);throw new Error(e)}}}var cI=Object.defineProperty,uI=(t,e,i)=>e in t?cI(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,he=(t,e,i)=>uI(t,typeof e!="symbol"?e+"":e,i);class lI extends Fp{constructor(e,i,r){super(e,i,r),this.core=e,this.logger=i,this.store=r,he(this,"name",uE),he(this,"abortController"),he(this,"isDevEnv"),he(this,"verifyUrlV3",hE),he(this,"storagePrefix",bt),he(this,"version",nh),he(this,"publicKey"),he(this,"fetchPromise"),he(this,"init",async()=>{var n;this.isDevEnv||(this.publicKey=await this.store.getItem(this.storeKey),this.publicKey&&T.toMiliseconds((n=this.publicKey)==null?void 0:n.expiresAt)<Date.now()&&(this.logger.debug("verify v2 public key expired"),await this.removePublicKey()))}),he(this,"register",async n=>{if(!mr()||this.isDevEnv)return;const s=window.location.origin,{id:o,decryptedId:a}=n,c=`${this.verifyUrlV3}/attestation?projectId=${this.core.projectId}&origin=${s}&id=${o}&decryptedId=${a}`;try{const u=gr(),l=this.startAbortTimer(T.ONE_SECOND*5),h=await new Promise((d,f)=>{const p=()=>{window.removeEventListener("message",y),u.body.removeChild(g),f("attestation aborted")};this.abortController.signal.addEventListener("abort",p);const g=u.createElement("iframe");g.src=c,g.style.display="none",g.addEventListener("error",p,{signal:this.abortController.signal});const y=m=>{if(m.data&&typeof m.data=="string")try{const w=JSON.parse(m.data);if(w.type==="verify_attestation"){if(vs(w.attestation).payload.id!==o)return;clearInterval(l),u.body.removeChild(g),this.abortController.signal.removeEventListener("abort",p),window.removeEventListener("message",y),d(w.attestation===null?"":w.attestation)}}catch(w){this.logger.warn(w)}};u.body.appendChild(g),window.addEventListener("message",y,{signal:this.abortController.signal})});return this.logger.debug("jwt attestation",h),h}catch(u){this.logger.warn(u)}return""}),he(this,"resolve",async n=>{if(this.isDevEnv)return"";const{attestationId:s,hash:o,encryptedId:a}=n;if(s===""){this.logger.debug("resolve: attestationId is empty, skipping");return}if(s){if(vs(s).payload.id!==a)return;const u=await this.isValidJwtAttestation(s);if(u){if(!u.isVerified){this.logger.warn("resolve: jwt attestation: origin url not verified");return}return u}}if(!o)return;const c=this.getVerifyUrl(n?.verifyUrl);return this.fetchAttestation(o,c)}),he(this,"fetchAttestation",async(n,s)=>{this.logger.debug(`resolving attestation: ${n} from url: ${s}`);const o=this.startAbortTimer(T.ONE_SECOND*5),a=await fetch(`${s}/attestation/${n}?v2Supported=true`,{signal:this.abortController.signal});return clearTimeout(o),a.status===200?await a.json():void 0}),he(this,"getVerifyUrl",n=>{let s=n||er;return dE.includes(s)||(this.logger.info(`verify url: ${s}, not included in trusted list, assigning default: ${er}`),s=er),s}),he(this,"fetchPublicKey",async()=>{try{this.logger.debug(`fetching public key from: ${this.verifyUrlV3}`);const n=this.startAbortTimer(T.FIVE_SECONDS),s=await fetch(`${this.verifyUrlV3}/public-key`,{signal:this.abortController.signal});return clearTimeout(n),await s.json()}catch(n){this.logger.warn(n)}}),he(this,"persistPublicKey",async n=>{this.logger.debug("persisting public key to local storage",n),await this.store.setItem(this.storeKey,n),this.publicKey=n}),he(this,"removePublicKey",async()=>{this.logger.debug("removing verify v2 public key from storage"),await this.store.removeItem(this.storeKey),this.publicKey=void 0}),he(this,"isValidJwtAttestation",async n=>{const s=await this.getPublicKey();try{if(s)return this.validateAttestation(n,s)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}const o=await this.fetchAndPersistPublicKey();try{if(o)return this.validateAttestation(n,o)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}}),he(this,"getPublicKey",async()=>this.publicKey?this.publicKey:await this.fetchAndPersistPublicKey()),he(this,"fetchAndPersistPublicKey",async()=>{if(this.fetchPromise)return await this.fetchPromise,this.publicKey;this.fetchPromise=new Promise(async s=>{const o=await this.fetchPublicKey();o&&(await this.persistPublicKey(o),s(o))});const n=await this.fetchPromise;return this.fetchPromise=void 0,n}),he(this,"validateAttestation",(n,s)=>{const o=R0(n,s.publicKey),a={hasExpired:T.toMiliseconds(o.exp)<Date.now(),payload:o};if(a.hasExpired)throw this.logger.warn("resolve: jwt attestation expired"),new Error("JWT attestation expired");return{origin:a.payload.origin,isScam:a.payload.isScam,isVerified:a.payload.isVerified}}),this.logger=Fe(i,this.name),this.abortController=new AbortController,this.isDevEnv=uo(),this.init()}get storeKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//verify:public:key"}get context(){return je(this.logger)}startAbortTimer(e){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),T.toMiliseconds(e))}}var hI=Object.defineProperty,dI=(t,e,i)=>e in t?hI(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,jc=(t,e,i)=>dI(t,typeof e!="symbol"?e+"":e,i);class pI extends Lp{constructor(e,i){super(e,i),this.projectId=e,this.logger=i,jc(this,"context",pE),jc(this,"registerDeviceToken",async r=>{const{clientId:n,token:s,notificationType:o,enableEncrypted:a=!1}=r,c=`${fE}/${this.projectId}/clients`;await fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:n,type:o,token:s,always_raw:a})})}),this.logger=Fe(i,this.context)}}var fI=Object.defineProperty,zc=Object.getOwnPropertySymbols,gI=Object.prototype.hasOwnProperty,yI=Object.prototype.propertyIsEnumerable,Vs=(t,e,i)=>e in t?fI(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,Gi=(t,e)=>{for(var i in e||(e={}))gI.call(e,i)&&Vs(t,i,e[i]);if(zc)for(var i of zc(e))yI.call(e,i)&&Vs(t,i,e[i]);return t},ge=(t,e,i)=>Vs(t,typeof e!="symbol"?e+"":e,i);class wI extends Bp{constructor(e,i,r=!0){super(e,i,r),this.core=e,this.logger=i,ge(this,"context",yE),ge(this,"storagePrefix",bt),ge(this,"storageVersion",gE),ge(this,"events",new Map),ge(this,"shouldPersist",!1),ge(this,"init",async()=>{if(!uo())try{const n={eventId:Ra(),timestamp:Date.now(),domain:this.getAppDomain(),props:{event:"INIT",type:"",properties:{client_id:await this.core.crypto.getClientId(),user_agent:pl(this.core.relayer.protocol,this.core.relayer.version,Ls)}}};await this.sendEvent([n])}catch(n){this.logger.warn(n)}}),ge(this,"createEvent",n=>{const{event:s="ERROR",type:o="",properties:{topic:a,trace:c}}=n,u=Ra(),l=this.core.projectId||"",h=Date.now(),d=Gi({eventId:u,timestamp:h,props:{event:s,type:o,properties:{topic:a,trace:c}},bundleId:l,domain:this.getAppDomain()},this.setMethods(u));return this.telemetryEnabled&&(this.events.set(u,d),this.shouldPersist=!0),d}),ge(this,"getEvent",n=>{const{eventId:s,topic:o}=n;if(s)return this.events.get(s);const a=Array.from(this.events.values()).find(c=>c.props.properties.topic===o);if(a)return Gi(Gi({},a),this.setMethods(a.eventId))}),ge(this,"deleteEvent",n=>{const{eventId:s}=n;this.events.delete(s),this.shouldPersist=!0}),ge(this,"setEventListeners",()=>{this.core.heartbeat.on(Ci.pulse,async()=>{this.shouldPersist&&await this.persist(),this.events.forEach(n=>{T.fromMiliseconds(Date.now())-T.fromMiliseconds(n.timestamp)>wE&&(this.events.delete(n.eventId),this.shouldPersist=!0)})})}),ge(this,"setMethods",n=>({addTrace:s=>this.addTrace(n,s),setError:s=>this.setError(n,s)})),ge(this,"addTrace",(n,s)=>{const o=this.events.get(n);o&&(o.props.properties.trace.push(s),this.events.set(n,o),this.shouldPersist=!0)}),ge(this,"setError",(n,s)=>{const o=this.events.get(n);o&&(o.props.type=s,o.timestamp=Date.now(),this.events.set(n,o),this.shouldPersist=!0)}),ge(this,"persist",async()=>{await this.core.storage.setItem(this.storageKey,Array.from(this.events.values())),this.shouldPersist=!1}),ge(this,"restore",async()=>{try{const n=await this.core.storage.getItem(this.storageKey)||[];if(!n.length)return;n.forEach(s=>{this.events.set(s.eventId,Gi(Gi({},s),this.setMethods(s.eventId)))})}catch(n){this.logger.warn(n)}}),ge(this,"submit",async()=>{if(!this.telemetryEnabled||this.events.size===0)return;const n=[];for(const[s,o]of this.events)o.props.type&&n.push(o);if(n.length!==0)try{if((await this.sendEvent(n)).ok)for(const s of n)this.events.delete(s.eventId),this.shouldPersist=!0}catch(s){this.logger.warn(s)}}),ge(this,"sendEvent",async n=>{const s=this.getAppDomain()?"":"&sp=desktop";return await fetch(`${mE}?projectId=${this.core.projectId}&st=events_sdk&sv=js-${Ls}${s}`,{method:"POST",body:JSON.stringify(n)})}),ge(this,"getAppDomain",()=>dl().url),this.logger=Fe(i,this.context),this.telemetryEnabled=r,r?this.restore().then(async()=>{await this.submit(),this.setEventListeners()}):this.persist()}get storageKey(){return this.storagePrefix+this.storageVersion+this.core.customStoragePrefix+"//"+this.context}}var mI=Object.defineProperty,Vc=Object.getOwnPropertySymbols,bI=Object.prototype.hasOwnProperty,vI=Object.prototype.propertyIsEnumerable,Ks=(t,e,i)=>e in t?mI(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,Kc=(t,e)=>{for(var i in e||(e={}))bI.call(e,i)&&Ks(t,i,e[i]);if(Vc)for(var i of Vc(e))vI.call(e,i)&&Ks(t,i,e[i]);return t},oe=(t,e,i)=>Ks(t,typeof e!="symbol"?e+"":e,i);class vo extends Dp{constructor(e){var i;super(e),oe(this,"protocol",rh),oe(this,"version",nh),oe(this,"name",sn),oe(this,"relayUrl"),oe(this,"projectId"),oe(this,"customStoragePrefix"),oe(this,"events",new Ge.EventEmitter),oe(this,"logger"),oe(this,"heartbeat"),oe(this,"relayer"),oe(this,"crypto"),oe(this,"storage"),oe(this,"history"),oe(this,"expirer"),oe(this,"pairing"),oe(this,"verify"),oe(this,"echoClient"),oe(this,"linkModeSupportedApps"),oe(this,"eventClient"),oe(this,"initialized",!1),oe(this,"logChunkController"),oe(this,"on",(a,c)=>this.events.on(a,c)),oe(this,"once",(a,c)=>this.events.once(a,c)),oe(this,"off",(a,c)=>this.events.off(a,c)),oe(this,"removeListener",(a,c)=>this.events.removeListener(a,c)),oe(this,"dispatchEnvelope",({topic:a,message:c,sessionExists:u})=>{if(!a||!c)return;const l={topic:a,message:c,publishedAt:Date.now(),transportType:ce.link_mode};this.relayer.onLinkMessageEvent(l,{sessionExists:u})});const r=this.getGlobalCore(e?.customStoragePrefix);if(r)try{return this.customStoragePrefix=r.customStoragePrefix,this.logger=r.logger,this.heartbeat=r.heartbeat,this.crypto=r.crypto,this.history=r.history,this.expirer=r.expirer,this.storage=r.storage,this.relayer=r.relayer,this.pairing=r.pairing,this.verify=r.verify,this.echoClient=r.echoClient,this.linkModeSupportedApps=r.linkModeSupportedApps,this.eventClient=r.eventClient,this.initialized=r.initialized,this.logChunkController=r.logChunkController,r}catch(a){console.warn("Failed to copy global core",a)}this.projectId=e?.projectId,this.relayUrl=e?.relayUrl||oh,this.customStoragePrefix=e!=null&&e.customStoragePrefix?`:${e.customStoragePrefix}`:"";const n=Ys({level:typeof e?.logger=="string"&&e.logger?e.logger:Mv.logger,name:sn}),{logger:s,chunkLoggerController:o}=Ep({opts:n,maxSizeInBytes:e?.maxLogBlobSizeInBytes,loggerOverride:e?.logger});this.logChunkController=o,(i=this.logChunkController)!=null&&i.downloadLogsBlobInBrowser&&(window.downloadLogsBlobInBrowser=async()=>{var a,c;(a=this.logChunkController)!=null&&a.downloadLogsBlobInBrowser&&((c=this.logChunkController)==null||c.downloadLogsBlobInBrowser({clientId:await this.crypto.getClientId()}))}),this.logger=Fe(s,this.name),this.heartbeat=new hd,this.crypto=new G_(this,this.logger,e?.keychain),this.history=new nI(this,this.logger),this.expirer=new aI(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new Wd(Kc(Kc({},qv),e?.storageOptions)),this.relayer=new E2({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new tI(this,this.logger),this.verify=new lI(this,this.logger,this.storage),this.echoClient=new pI(this.projectId||"",this.logger),this.linkModeSupportedApps=[],this.eventClient=new wI(this,this.logger,e?.telemetryEnabled),this.setGlobalCore(this)}static async init(e){const i=new vo(e);await i.initialize();const r=await i.crypto.getClientId();return await i.storage.setItem(eE,r),i}get context(){return je(this.logger)}async start(){this.initialized||await this.initialize()}async getLogsBlob(){var e;return(e=this.logChunkController)==null?void 0:e.logsToBlob({clientId:await this.crypto.getClientId()})}async addLinkModeSupportedApp(e){this.linkModeSupportedApps.includes(e)||(this.linkModeSupportedApps.push(e),await this.storage.setItem(Dc,this.linkModeSupportedApps))}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.linkModeSupportedApps=await this.storage.getItem(Dc)||[],this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,e),this.logger.error(e.message),e}}getGlobalCore(e=""){try{if(this.isGlobalCoreDisabled())return;const i=`_walletConnectCore_${e}`,r=`${i}_count`;return globalThis[r]=(globalThis[r]||0)+1,globalThis[r]>1&&console.warn(`WalletConnect Core is already initialized. This is probably a mistake and can lead to unexpected behavior. Init() was called ${globalThis[r]} times.`),globalThis[i]}catch(i){console.warn("Failed to get global WalletConnect core",i);return}}setGlobalCore(e){var i;try{if(this.isGlobalCoreDisabled())return;const r=`_walletConnectCore_${((i=e.opts)==null?void 0:i.customStoragePrefix)||""}`;globalThis[r]=e}catch(r){console.warn("Failed to set global WalletConnect core",r)}}isGlobalCoreDisabled(){try{return typeof process<"u"&&process.env.DISABLE_GLOBAL_CORE==="true"}catch{return!0}}}const EI=vo,mh="wc",bh=2,vh="client",Eo=`${mh}@${bh}:${vh}:`,os={name:vh,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.org"},Hc="WALLETCONNECT_DEEPLINK_CHOICE",_I="proposal",Wc="Proposal expired",II="session",bi=T.SEVEN_DAYS,DI="engine",ye={wc_sessionPropose:{req:{ttl:T.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:T.FIVE_MINUTES,prompt:!1,tag:1101},reject:{ttl:T.FIVE_MINUTES,prompt:!1,tag:1120},autoReject:{ttl:T.FIVE_MINUTES,prompt:!1,tag:1121}},wc_sessionSettle:{req:{ttl:T.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:T.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:T.ONE_DAY,prompt:!1,tag:1104},res:{ttl:T.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:T.ONE_DAY,prompt:!1,tag:1106},res:{ttl:T.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:T.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:T.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:T.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:T.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:T.ONE_DAY,prompt:!1,tag:1112},res:{ttl:T.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:T.ONE_DAY,prompt:!1,tag:1114},res:{ttl:T.ONE_DAY,prompt:!1,tag:1115}},wc_sessionAuthenticate:{req:{ttl:T.ONE_HOUR,prompt:!0,tag:1116},res:{ttl:T.ONE_HOUR,prompt:!1,tag:1117},reject:{ttl:T.FIVE_MINUTES,prompt:!1,tag:1118},autoReject:{ttl:T.FIVE_MINUTES,prompt:!1,tag:1119}}},as={min:T.FIVE_MINUTES,max:T.SEVEN_DAYS},ht={idle:"IDLE",active:"ACTIVE"},Gc={eth_sendTransaction:{key:""},eth_sendRawTransaction:{key:""},wallet_sendCalls:{key:""},solana_signTransaction:{key:"signature"},solana_signAllTransactions:{key:"transactions"},solana_signAndSendTransaction:{key:"signature"}},SI="request",$I=["wc_sessionPropose","wc_sessionRequest","wc_authRequest","wc_sessionAuthenticate"],xI="wc",OI="auth",AI="authKeys",PI="pairingTopics",CI="requests",In=`${xI}@${1.5}:${OI}:`,Wr=`${In}:PUB_KEY`;var RI=Object.defineProperty,TI=Object.defineProperties,NI=Object.getOwnPropertyDescriptors,Yc=Object.getOwnPropertySymbols,FI=Object.prototype.hasOwnProperty,LI=Object.prototype.propertyIsEnumerable,Hs=(t,e,i)=>e in t?RI(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,re=(t,e)=>{for(var i in e||(e={}))FI.call(e,i)&&Hs(t,i,e[i]);if(Yc)for(var i of Yc(e))LI.call(e,i)&&Hs(t,i,e[i]);return t},Te=(t,e)=>TI(t,NI(e)),R=(t,e,i)=>Hs(t,typeof e!="symbol"?e+"":e,i);class BI extends qp{constructor(e){super(e),R(this,"name",DI),R(this,"events",new ou),R(this,"initialized",!1),R(this,"requestQueue",{state:ht.idle,queue:[]}),R(this,"sessionRequestQueue",{state:ht.idle,queue:[]}),R(this,"requestQueueDelay",T.ONE_SECOND),R(this,"expectedPairingMethodMap",new Map),R(this,"recentlyDeletedMap",new Map),R(this,"recentlyDeletedLimit",200),R(this,"relayMessageCache",[]),R(this,"pendingSessions",new Map),R(this,"init",async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),await this.registerLinkModeListeners(),this.client.core.pairing.register({methods:Object.keys(ye)}),this.initialized=!0,setTimeout(async()=>{await this.processPendingMessageEvents(),this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},T.toMiliseconds(this.requestQueueDelay)))}),R(this,"connect",async i=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();const r=Te(re({},i),{requiredNamespaces:i.requiredNamespaces||{},optionalNamespaces:i.optionalNamespaces||{}});await this.isValidConnect(r);const{pairingTopic:n,requiredNamespaces:s,optionalNamespaces:o,sessionProperties:a,scopedProperties:c,relays:u}=r;let l=n,h,d=!1;try{if(l){const S=this.client.core.pairing.pairings.get(l);this.client.logger.warn("connect() with existing pairing topic is deprecated and will be removed in the next major release."),d=S.active}}catch(S){throw this.client.logger.error(`connect() -> pairing.get(${l}) failed`),S}if(!l||!d){const{topic:S,uri:$}=await this.client.core.pairing.create();l=S,h=$}if(!l){const{message:S}=F("NO_MATCHING_KEY",`connect() pairing topic: ${l}`);throw new Error(S)}const f=await this.client.core.crypto.generateKeyPair(),p=ye.wc_sessionPropose.req.ttl||T.FIVE_MINUTES,g=pe(p),y=Te(re(re({requiredNamespaces:s,optionalNamespaces:o,relays:u??[{protocol:sh}],proposer:{publicKey:f,metadata:this.client.metadata},expiryTimestamp:g,pairingTopic:l},a&&{sessionProperties:a}),c&&{scopedProperties:c}),{id:pt()}),m=X("session_connect",y.id),{reject:w,resolve:b,done:E}=Wt(p,Wc),x=({id:S})=>{S===y.id&&(this.client.events.off("proposal_expire",x),this.pendingSessions.delete(y.id),this.events.emit(m,{error:{message:Wc,code:0}}))};return this.client.events.on("proposal_expire",x),this.events.once(m,({error:S,session:$})=>{this.client.events.off("proposal_expire",x),S?w(S):$&&b($)}),await this.sendRequest({topic:l,method:"wc_sessionPropose",params:y,throwOnFailedPublish:!0,clientRpcId:y.id}),await this.setProposal(y.id,y),{uri:h,approval:E}}),R(this,"pair",async i=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{return await this.client.core.pairing.pair(i)}catch(r){throw this.client.logger.error("pair() failed"),r}}),R(this,"approve",async i=>{var r,n,s;const o=this.client.core.eventClient.createEvent({properties:{topic:(r=i?.id)==null?void 0:r.toString(),trace:[it.session_approve_started]}});try{this.isInitialized(),await this.confirmOnlineStateOrThrow()}catch(I){throw o.setError(Vt.no_internet_connection),I}try{await this.isValidProposalId(i?.id)}catch(I){throw this.client.logger.error(`approve() -> proposal.get(${i?.id}) failed`),o.setError(Vt.proposal_not_found),I}try{await this.isValidApprove(i)}catch(I){throw this.client.logger.error("approve() -> isValidApprove() failed"),o.setError(Vt.session_approve_namespace_validation_failure),I}const{id:a,relayProtocol:c,namespaces:u,sessionProperties:l,scopedProperties:h,sessionConfig:d}=i,f=this.client.proposal.get(a);this.client.core.eventClient.deleteEvent({eventId:o.eventId});const{pairingTopic:p,proposer:g,requiredNamespaces:y,optionalNamespaces:m}=f;let w=(n=this.client.core.eventClient)==null?void 0:n.getEvent({topic:p});w||(w=(s=this.client.core.eventClient)==null?void 0:s.createEvent({type:it.session_approve_started,properties:{topic:p,trace:[it.session_approve_started,it.session_namespaces_validation_success]}}));const b=await this.client.core.crypto.generateKeyPair(),E=g.publicKey,x=await this.client.core.crypto.generateSharedKey(b,E),S=re(re(re({relay:{protocol:c??"irn"},namespaces:u,controller:{publicKey:b,metadata:this.client.metadata},expiry:pe(bi)},l&&{sessionProperties:l}),h&&{scopedProperties:h}),d&&{sessionConfig:d}),$=ce.relay;w.addTrace(it.subscribing_session_topic);try{await this.client.core.relayer.subscribe(x,{transportType:$})}catch(I){throw w.setError(Vt.subscribe_session_topic_failure),I}w.addTrace(it.subscribe_session_topic_success);const A=Te(re({},S),{topic:x,requiredNamespaces:y,optionalNamespaces:m,pairingTopic:p,acknowledged:!1,self:S.controller,peer:{publicKey:g.publicKey,metadata:g.metadata},controller:b,transportType:ce.relay});await this.client.session.set(x,A),w.addTrace(it.store_session);try{w.addTrace(it.publishing_session_settle),await this.sendRequest({topic:x,method:"wc_sessionSettle",params:S,throwOnFailedPublish:!0}).catch(I=>{throw w?.setError(Vt.session_settle_publish_failure),I}),w.addTrace(it.session_settle_publish_success),w.addTrace(it.publishing_session_approve),await this.sendResult({id:a,topic:p,result:{relay:{protocol:c??"irn"},responderPublicKey:b},throwOnFailedPublish:!0}).catch(I=>{throw w?.setError(Vt.session_approve_publish_failure),I}),w.addTrace(it.session_approve_publish_success)}catch(I){throw this.client.logger.error(I),this.client.session.delete(x,ne("USER_DISCONNECTED")),await this.client.core.relayer.unsubscribe(x),I}return this.client.core.eventClient.deleteEvent({eventId:w.eventId}),await this.client.core.pairing.updateMetadata({topic:p,metadata:g.metadata}),await this.client.proposal.delete(a,ne("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:p}),await this.setExpiry(x,pe(bi)),{topic:x,acknowledged:()=>Promise.resolve(this.client.session.get(x))}}),R(this,"reject",async i=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidReject(i)}catch(o){throw this.client.logger.error("reject() -> isValidReject() failed"),o}const{id:r,reason:n}=i;let s;try{s=this.client.proposal.get(r).pairingTopic}catch(o){throw this.client.logger.error(`reject() -> proposal.get(${r}) failed`),o}s&&(await this.sendError({id:r,topic:s,error:n,rpcOpts:ye.wc_sessionPropose.reject}),await this.client.proposal.delete(r,ne("USER_DISCONNECTED")))}),R(this,"update",async i=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidUpdate(i)}catch(h){throw this.client.logger.error("update() -> isValidUpdate() failed"),h}const{topic:r,namespaces:n}=i,{done:s,resolve:o,reject:a}=Wt(),c=pt(),u=Qt().toString(),l=this.client.session.get(r).namespaces;return this.events.once(X("session_update",c),({error:h})=>{h?a(h):o()}),await this.client.session.update(r,{namespaces:n}),await this.sendRequest({topic:r,method:"wc_sessionUpdate",params:{namespaces:n},throwOnFailedPublish:!0,clientRpcId:c,relayRpcId:u}).catch(h=>{this.client.logger.error(h),this.client.session.update(r,{namespaces:l}),a(h)}),{acknowledged:s}}),R(this,"extend",async i=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidExtend(i)}catch(c){throw this.client.logger.error("extend() -> isValidExtend() failed"),c}const{topic:r}=i,n=pt(),{done:s,resolve:o,reject:a}=Wt();return this.events.once(X("session_extend",n),({error:c})=>{c?a(c):o()}),await this.setExpiry(r,pe(bi)),this.sendRequest({topic:r,method:"wc_sessionExtend",params:{},clientRpcId:n,throwOnFailedPublish:!0}).catch(c=>{a(c)}),{acknowledged:s}}),R(this,"request",async i=>{this.isInitialized();try{await this.isValidRequest(i)}catch(m){throw this.client.logger.error("request() -> isValidRequest() failed"),m}const{chainId:r,request:n,topic:s,expiry:o=ye.wc_sessionRequest.req.ttl}=i,a=this.client.session.get(s);a?.transportType===ce.relay&&await this.confirmOnlineStateOrThrow();const c=pt(),u=Qt().toString(),{done:l,resolve:h,reject:d}=Wt(o,"Request expired. Please try again.");this.events.once(X("session_request",c),({error:m,result:w})=>{m?d(m):h(w)});const f="wc_sessionRequest",p=this.getAppLinkIfEnabled(a.peer.metadata,a.transportType);if(p)return await this.sendRequest({clientRpcId:c,relayRpcId:u,topic:s,method:f,params:{request:Te(re({},n),{expiryTimestamp:pe(o)}),chainId:r},expiry:o,throwOnFailedPublish:!0,appLink:p}).catch(m=>d(m)),this.client.events.emit("session_request_sent",{topic:s,request:n,chainId:r,id:c}),await l();const g={request:Te(re({},n),{expiryTimestamp:pe(o)}),chainId:r},y=this.shouldSetTVF(f,g);return await Promise.all([new Promise(async m=>{await this.sendRequest(re({clientRpcId:c,relayRpcId:u,topic:s,method:f,params:g,expiry:o,throwOnFailedPublish:!0},y&&{tvf:this.getTVFParams(c,g)})).catch(w=>d(w)),this.client.events.emit("session_request_sent",{topic:s,request:n,chainId:r,id:c}),m()}),new Promise(async m=>{var w;if(!((w=a.sessionConfig)!=null&&w.disableDeepLink)){const b=await ab(this.client.core.storage,Hc);await nb({id:c,topic:s,wcDeepLink:b})}m()}),l()]).then(m=>m[2])}),R(this,"respond",async i=>{this.isInitialized(),await this.isValidRespond(i);const{topic:r,response:n}=i,{id:s}=n,o=this.client.session.get(r);o.transportType===ce.relay&&await this.confirmOnlineStateOrThrow();const a=this.getAppLinkIfEnabled(o.peer.metadata,o.transportType);ft(n)?await this.sendResult({id:s,topic:r,result:n.result,throwOnFailedPublish:!0,appLink:a}):Qe(n)&&await this.sendError({id:s,topic:r,error:n.error,appLink:a}),this.cleanupAfterResponse(i)}),R(this,"ping",async i=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidPing(i)}catch(n){throw this.client.logger.error("ping() -> isValidPing() failed"),n}const{topic:r}=i;if(this.client.session.keys.includes(r)){const n=pt(),s=Qt().toString(),{done:o,resolve:a,reject:c}=Wt();this.events.once(X("session_ping",n),({error:u})=>{u?c(u):a()}),await Promise.all([this.sendRequest({topic:r,method:"wc_sessionPing",params:{},throwOnFailedPublish:!0,clientRpcId:n,relayRpcId:s}),o()])}else this.client.core.pairing.pairings.keys.includes(r)&&(this.client.logger.warn("ping() on pairing topic is deprecated and will be removed in the next major release."),await this.client.core.pairing.ping({topic:r}))}),R(this,"emit",async i=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidEmit(i);const{topic:r,event:n,chainId:s}=i,o=Qt().toString(),a=pt();await this.sendRequest({topic:r,method:"wc_sessionEvent",params:{event:n,chainId:s},throwOnFailedPublish:!0,relayRpcId:o,clientRpcId:a})}),R(this,"disconnect",async i=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidDisconnect(i);const{topic:r}=i;if(this.client.session.keys.includes(r))await this.sendRequest({topic:r,method:"wc_sessionDelete",params:ne("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession({topic:r,emitEvent:!1});else if(this.client.core.pairing.pairings.keys.includes(r))await this.client.core.pairing.disconnect({topic:r});else{const{message:n}=F("MISMATCHED_TOPIC",`Session or pairing topic not found: ${r}`);throw new Error(n)}}),R(this,"find",i=>(this.isInitialized(),this.client.session.getAll().filter(r=>z0(r,i)))),R(this,"getPendingSessionRequests",()=>this.client.pendingRequest.getAll()),R(this,"authenticate",async(i,r)=>{var n;this.isInitialized(),this.isValidAuthenticate(i);const s=r&&this.client.core.linkModeSupportedApps.includes(r)&&((n=this.client.metadata.redirect)==null?void 0:n.linkMode),o=s?ce.link_mode:ce.relay;o===ce.relay&&await this.confirmOnlineStateOrThrow();const{chains:a,statement:c="",uri:u,domain:l,nonce:h,type:d,exp:f,nbf:p,methods:g=[],expiry:y}=i,m=[...i.resources||[]],{topic:w,uri:b}=await this.client.core.pairing.create({methods:["wc_sessionAuthenticate"],transportType:o});this.client.logger.info({message:"Generated new pairing",pairing:{topic:w,uri:b}});const E=await this.client.core.crypto.generateKeyPair(),x=Kr(E);if(await Promise.all([this.client.auth.authKeys.set(Wr,{responseTopic:x,publicKey:E}),this.client.auth.pairingTopics.set(x,{topic:x,pairingTopic:w})]),await this.client.core.relayer.subscribe(x,{transportType:o}),this.client.logger.info(`sending request to new pairing topic: ${w}`),g.length>0){const{namespace:D}=zr(a[0]);let N=Xb(D,"request",g);Vr(m)&&(N=t1(N,m.pop())),m.push(N)}const S=y&&y>ye.wc_sessionAuthenticate.req.ttl?y:ye.wc_sessionAuthenticate.req.ttl,$={authPayload:{type:d??"caip122",chains:a,statement:c,aud:u,domain:l,version:"1",nonce:h,iat:new Date().toISOString(),exp:f,nbf:p,resources:m},requester:{publicKey:E,metadata:this.client.metadata},expiryTimestamp:pe(S)},A={eip155:{chains:a,methods:[...new Set(["personal_sign",...g])],events:["chainChanged","accountsChanged"]}},I={requiredNamespaces:{},optionalNamespaces:A,relays:[{protocol:"irn"}],pairingTopic:w,proposer:{publicKey:E,metadata:this.client.metadata},expiryTimestamp:pe(ye.wc_sessionPropose.req.ttl),id:pt()},{done:M,resolve:L,reject:U}=Wt(S,"Request expired"),q=pt(),C=X("session_connect",I.id),_=X("session_request",q),v=async({error:D,session:N})=>{this.events.off(_,O),D?U(D):N&&L({session:N})},O=async D=>{var N,B,k;if(await this.deletePendingAuthRequest(q,{message:"fulfilled",code:0}),D.error){const J=ne("WC_METHOD_UNSUPPORTED","wc_sessionAuthenticate");return D.error.code===J.code?void 0:(this.events.off(C,v),U(D.error.message))}await this.deleteProposal(I.id),this.events.off(C,v);const{cacaos:j,responder:z}=D.result,H=[],Y=[];for(const J of j){await Ma({cacao:J,projectId:this.client.core.projectId})||(this.client.logger.error(J,"Signature verification failed"),U(ne("SESSION_SETTLEMENT_FAILED","Signature verification failed")));const{p:Pe}=J,_e=Vr(Pe.resources),Re=[$s(Pe.iss)],Ye=en(Pe.iss);if(_e){const vt=qa(_e),li=ja(_e);H.push(...vt),Re.push(...li)}for(const vt of Re)Y.push(`${vt}:${Ye}`)}const se=await this.client.core.crypto.generateSharedKey(E,z.publicKey);let ee;H.length>0&&(ee={topic:se,acknowledged:!0,self:{publicKey:E,metadata:this.client.metadata},peer:z,controller:z.publicKey,expiry:pe(bi),requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:w,namespaces:lc([...new Set(H)],[...new Set(Y)]),transportType:o},await this.client.core.relayer.subscribe(se,{transportType:o}),await this.client.session.set(se,ee),w&&await this.client.core.pairing.updateMetadata({topic:w,metadata:z.metadata}),ee=this.client.session.get(se)),(N=this.client.metadata.redirect)!=null&&N.linkMode&&(B=z.metadata.redirect)!=null&&B.linkMode&&(k=z.metadata.redirect)!=null&&k.universal&&r&&(this.client.core.addLinkModeSupportedApp(z.metadata.redirect.universal),this.client.session.update(se,{transportType:ce.link_mode})),L({auths:j,session:ee})};this.events.once(C,v),this.events.once(_,O);let P;try{if(s){const D=Xt("wc_sessionAuthenticate",$,q);this.client.core.history.set(w,D);const N=await this.client.core.crypto.encode("",D,{type:Dr,encoding:Ut});P=Br(r,w,N)}else await Promise.all([this.sendRequest({topic:w,method:"wc_sessionAuthenticate",params:$,expiry:i.expiry,throwOnFailedPublish:!0,clientRpcId:q}),this.sendRequest({topic:w,method:"wc_sessionPropose",params:I,expiry:ye.wc_sessionPropose.req.ttl,throwOnFailedPublish:!0,clientRpcId:I.id})])}catch(D){throw this.events.off(C,v),this.events.off(_,O),D}return await this.setProposal(I.id,I),await this.setAuthRequest(q,{request:Te(re({},$),{verifyContext:{}}),pairingTopic:w,transportType:o}),{uri:P??b,response:M}}),R(this,"approveSessionAuthenticate",async i=>{const{id:r,auths:n}=i,s=this.client.core.eventClient.createEvent({properties:{topic:r.toString(),trace:[Kt.authenticated_session_approve_started]}});try{this.isInitialized()}catch(y){throw s.setError(Hi.no_internet_connection),y}const o=this.getPendingAuthRequest(r);if(!o)throw s.setError(Hi.authenticated_session_pending_request_not_found),new Error(`Could not find pending auth request with id ${r}`);const a=o.transportType||ce.relay;a===ce.relay&&await this.confirmOnlineStateOrThrow();const c=o.requester.publicKey,u=await this.client.core.crypto.generateKeyPair(),l=Kr(c),h={type:Rt,receiverPublicKey:c,senderPublicKey:u},d=[],f=[];for(const y of n){if(!await Ma({cacao:y,projectId:this.client.core.projectId})){s.setError(Hi.invalid_cacao);const x=ne("SESSION_SETTLEMENT_FAILED","Signature verification failed");throw await this.sendError({id:r,topic:l,error:x,encodeOpts:h}),new Error(x.message)}s.addTrace(Kt.cacaos_verified);const{p:m}=y,w=Vr(m.resources),b=[$s(m.iss)],E=en(m.iss);if(w){const x=qa(w),S=ja(w);d.push(...x),b.push(...S)}for(const x of b)f.push(`${x}:${E}`)}const p=await this.client.core.crypto.generateSharedKey(u,c);s.addTrace(Kt.create_authenticated_session_topic);let g;if(d?.length>0){g={topic:p,acknowledged:!0,self:{publicKey:u,metadata:this.client.metadata},peer:{publicKey:c,metadata:o.requester.metadata},controller:c,expiry:pe(bi),authentication:n,requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:o.pairingTopic,namespaces:lc([...new Set(d)],[...new Set(f)]),transportType:a},s.addTrace(Kt.subscribing_authenticated_session_topic);try{await this.client.core.relayer.subscribe(p,{transportType:a})}catch(y){throw s.setError(Hi.subscribe_authenticated_session_topic_failure),y}s.addTrace(Kt.subscribe_authenticated_session_topic_success),await this.client.session.set(p,g),s.addTrace(Kt.store_authenticated_session),await this.client.core.pairing.updateMetadata({topic:o.pairingTopic,metadata:o.requester.metadata})}s.addTrace(Kt.publishing_authenticated_session_approve);try{await this.sendResult({topic:l,id:r,result:{cacaos:n,responder:{publicKey:u,metadata:this.client.metadata}},encodeOpts:h,throwOnFailedPublish:!0,appLink:this.getAppLinkIfEnabled(o.requester.metadata,a)})}catch(y){throw s.setError(Hi.authenticated_session_approve_publish_failure),y}return await this.client.auth.requests.delete(r,{message:"fulfilled",code:0}),await this.client.core.pairing.activate({topic:o.pairingTopic}),this.client.core.eventClient.deleteEvent({eventId:s.eventId}),{session:g}}),R(this,"rejectSessionAuthenticate",async i=>{this.isInitialized();const{id:r,reason:n}=i,s=this.getPendingAuthRequest(r);if(!s)throw new Error(`Could not find pending auth request with id ${r}`);s.transportType===ce.relay&&await this.confirmOnlineStateOrThrow();const o=s.requester.publicKey,a=await this.client.core.crypto.generateKeyPair(),c=Kr(o),u={type:Rt,receiverPublicKey:o,senderPublicKey:a};await this.sendError({id:r,topic:c,error:n,encodeOpts:u,rpcOpts:ye.wc_sessionAuthenticate.reject,appLink:this.getAppLinkIfEnabled(s.requester.metadata,s.transportType)}),await this.client.auth.requests.delete(r,{message:"rejected",code:0}),await this.client.proposal.delete(r,ne("USER_DISCONNECTED"))}),R(this,"formatAuthMessage",i=>{this.isInitialized();const{request:r,iss:n}=i;return Dl(r,n)}),R(this,"processRelayMessageCache",()=>{setTimeout(async()=>{if(this.relayMessageCache.length!==0)for(;this.relayMessageCache.length>0;)try{const i=this.relayMessageCache.shift();i&&await this.onRelayMessage(i)}catch(i){this.client.logger.error(i)}},50)}),R(this,"cleanupDuplicatePairings",async i=>{if(i.pairingTopic)try{const r=this.client.core.pairing.pairings.get(i.pairingTopic),n=this.client.core.pairing.pairings.getAll().filter(s=>{var o,a;return((o=s.peerMetadata)==null?void 0:o.url)&&((a=s.peerMetadata)==null?void 0:a.url)===i.peer.metadata.url&&s.topic&&s.topic!==r.topic});if(n.length===0)return;this.client.logger.info(`Cleaning up ${n.length} duplicate pairing(s)`),await Promise.all(n.map(s=>this.client.core.pairing.disconnect({topic:s.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(r){this.client.logger.error(r)}}),R(this,"deleteSession",async i=>{var r;const{topic:n,expirerHasDeleted:s=!1,emitEvent:o=!0,id:a=0}=i,{self:c}=this.client.session.get(n);await this.client.core.relayer.unsubscribe(n),await this.client.session.delete(n,ne("USER_DISCONNECTED")),this.addToRecentlyDeleted(n,"session"),this.client.core.crypto.keychain.has(c.publicKey)&&await this.client.core.crypto.deleteKeyPair(c.publicKey),this.client.core.crypto.keychain.has(n)&&await this.client.core.crypto.deleteSymKey(n),s||this.client.core.expirer.del(n),this.client.core.storage.removeItem(Hc).catch(u=>this.client.logger.warn(u)),this.getPendingSessionRequests().forEach(u=>{u.topic===n&&this.deletePendingSessionRequest(u.id,ne("USER_DISCONNECTED"))}),n===((r=this.sessionRequestQueue.queue[0])==null?void 0:r.topic)&&(this.sessionRequestQueue.state=ht.idle),o&&this.client.events.emit("session_delete",{id:a,topic:n})}),R(this,"deleteProposal",async(i,r)=>{if(r)try{const n=this.client.proposal.get(i);this.client.core.eventClient.getEvent({topic:n.pairingTopic})?.setError(Vt.proposal_expired)}catch{}await Promise.all([this.client.proposal.delete(i,ne("USER_DISCONNECTED")),r?Promise.resolve():this.client.core.expirer.del(i)]),this.addToRecentlyDeleted(i,"proposal")}),R(this,"deletePendingSessionRequest",async(i,r,n=!1)=>{await Promise.all([this.client.pendingRequest.delete(i,r),n?Promise.resolve():this.client.core.expirer.del(i)]),this.addToRecentlyDeleted(i,"request"),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(s=>s.id!==i),n&&(this.sessionRequestQueue.state=ht.idle,this.client.events.emit("session_request_expire",{id:i}))}),R(this,"deletePendingAuthRequest",async(i,r,n=!1)=>{await Promise.all([this.client.auth.requests.delete(i,r),n?Promise.resolve():this.client.core.expirer.del(i)])}),R(this,"setExpiry",async(i,r)=>{this.client.session.keys.includes(i)&&(this.client.core.expirer.set(i,r),await this.client.session.update(i,{expiry:r}))}),R(this,"setProposal",async(i,r)=>{this.client.core.expirer.set(i,pe(ye.wc_sessionPropose.req.ttl)),await this.client.proposal.set(i,r)}),R(this,"setAuthRequest",async(i,r)=>{const{request:n,pairingTopic:s,transportType:o=ce.relay}=r;this.client.core.expirer.set(i,n.expiryTimestamp),await this.client.auth.requests.set(i,{authPayload:n.authPayload,requester:n.requester,expiryTimestamp:n.expiryTimestamp,id:i,pairingTopic:s,verifyContext:n.verifyContext,transportType:o})}),R(this,"setPendingSessionRequest",async i=>{const{id:r,topic:n,params:s,verifyContext:o}=i,a=s.request.expiryTimestamp||pe(ye.wc_sessionRequest.req.ttl);this.client.core.expirer.set(r,a),await this.client.pendingRequest.set(r,{id:r,topic:n,params:s,verifyContext:o})}),R(this,"sendRequest",async i=>{const{topic:r,method:n,params:s,expiry:o,relayRpcId:a,clientRpcId:c,throwOnFailedPublish:u,appLink:l,tvf:h}=i,d=Xt(n,s,c);let f;const p=!!l;try{const m=p?Ut:at;f=await this.client.core.crypto.encode(r,d,{encoding:m})}catch(m){throw await this.cleanup(),this.client.logger.error(`sendRequest() -> core.crypto.encode() for topic ${r} failed`),m}let g;if($I.includes(n)){const m=wt(JSON.stringify(d)),w=wt(f);g=await this.client.core.verify.register({id:w,decryptedId:m})}const y=ye[n].req;if(y.attestation=g,o&&(y.ttl=o),a&&(y.id=a),this.client.core.history.set(r,d),p){const m=Br(l,r,f);await global.Linking.openURL(m,this.client.name)}else{const m=ye[n].req;o&&(m.ttl=o),a&&(m.id=a),m.tvf=Te(re({},h),{correlationId:d.id}),u?(m.internal=Te(re({},m.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(r,f,m)):this.client.core.relayer.publish(r,f,m).catch(w=>this.client.logger.error(w))}return d.id}),R(this,"sendResult",async i=>{const{id:r,topic:n,result:s,throwOnFailedPublish:o,encodeOpts:a,appLink:c}=i,u=bn(r,s);let l;const h=c&&typeof(global==null?void 0:global.Linking)<"u";try{const p=h?Ut:at;l=await this.client.core.crypto.encode(n,u,Te(re({},a||{}),{encoding:p}))}catch(p){throw await this.cleanup(),this.client.logger.error(`sendResult() -> core.crypto.encode() for topic ${n} failed`),p}let d,f;try{d=await this.client.core.history.get(n,r);const p=d.request;try{this.shouldSetTVF(p.method,p.params)&&(f=this.getTVFParams(r,p.params,s))}catch(g){this.client.logger.warn("sendResult() -> getTVFParams() failed",g)}}catch(p){throw this.client.logger.error(`sendResult() -> history.get(${n}, ${r}) failed`),p}if(h){const p=Br(c,n,l);await global.Linking.openURL(p,this.client.name)}else{const p=d.request.method,g=ye[p].res;g.tvf=Te(re({},f),{correlationId:r}),o?(g.internal=Te(re({},g.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(n,l,g)):this.client.core.relayer.publish(n,l,g).catch(y=>this.client.logger.error(y))}await this.client.core.history.resolve(u)}),R(this,"sendError",async i=>{const{id:r,topic:n,error:s,encodeOpts:o,rpcOpts:a,appLink:c}=i,u=vn(r,s);let l;const h=c&&typeof(global==null?void 0:global.Linking)<"u";try{const f=h?Ut:at;l=await this.client.core.crypto.encode(n,u,Te(re({},o||{}),{encoding:f}))}catch(f){throw await this.cleanup(),this.client.logger.error(`sendError() -> core.crypto.encode() for topic ${n} failed`),f}let d;try{d=await this.client.core.history.get(n,r)}catch(f){throw this.client.logger.error(`sendError() -> history.get(${n}, ${r}) failed`),f}if(h){const f=Br(c,n,l);await global.Linking.openURL(f,this.client.name)}else{const f=d.request.method,p=a||ye[f].res;this.client.core.relayer.publish(n,l,p)}await this.client.core.history.resolve(u)}),R(this,"cleanup",async()=>{const i=[],r=[];this.client.session.getAll().forEach(n=>{let s=!1;Bt(n.expiry)&&(s=!0),this.client.core.crypto.keychain.has(n.topic)||(s=!0),s&&i.push(n.topic)}),this.client.proposal.getAll().forEach(n=>{Bt(n.expiryTimestamp)&&r.push(n.id)}),await Promise.all([...i.map(n=>this.deleteSession({topic:n})),...r.map(n=>this.deleteProposal(n))])}),R(this,"onProviderMessageEvent",async i=>{!this.initialized||this.relayMessageCache.length>0?this.relayMessageCache.push(i):await this.onRelayMessage(i)}),R(this,"onRelayEventRequest",async i=>{this.requestQueue.queue.push(i),await this.processRequestsQueue()}),R(this,"processRequestsQueue",async()=>{if(this.requestQueue.state===ht.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=ht.active;const i=this.requestQueue.queue.shift();if(i)try{await this.processRequest(i)}catch(r){this.client.logger.warn(r)}}this.requestQueue.state=ht.idle}),R(this,"processRequest",async i=>{const{topic:r,payload:n,attestation:s,transportType:o,encryptedId:a}=i,c=n.method;if(!this.shouldIgnorePairingRequest({topic:r,requestMethod:c}))switch(c){case"wc_sessionPropose":return await this.onSessionProposeRequest({topic:r,payload:n,attestation:s,encryptedId:a});case"wc_sessionSettle":return await this.onSessionSettleRequest(r,n);case"wc_sessionUpdate":return await this.onSessionUpdateRequest(r,n);case"wc_sessionExtend":return await this.onSessionExtendRequest(r,n);case"wc_sessionPing":return await this.onSessionPingRequest(r,n);case"wc_sessionDelete":return await this.onSessionDeleteRequest(r,n);case"wc_sessionRequest":return await this.onSessionRequest({topic:r,payload:n,attestation:s,encryptedId:a,transportType:o});case"wc_sessionEvent":return await this.onSessionEventRequest(r,n);case"wc_sessionAuthenticate":return await this.onSessionAuthenticateRequest({topic:r,payload:n,attestation:s,encryptedId:a,transportType:o});default:return this.client.logger.info(`Unsupported request method ${c}`)}}),R(this,"onRelayEventResponse",async i=>{const{topic:r,payload:n,transportType:s}=i,o=(await this.client.core.history.get(r,n.id)).request.method;switch(o){case"wc_sessionPropose":return this.onSessionProposeResponse(r,n,s);case"wc_sessionSettle":return this.onSessionSettleResponse(r,n);case"wc_sessionUpdate":return this.onSessionUpdateResponse(r,n);case"wc_sessionExtend":return this.onSessionExtendResponse(r,n);case"wc_sessionPing":return this.onSessionPingResponse(r,n);case"wc_sessionRequest":return this.onSessionRequestResponse(r,n);case"wc_sessionAuthenticate":return this.onSessionAuthenticateResponse(r,n);default:return this.client.logger.info(`Unsupported response method ${o}`)}}),R(this,"onRelayEventUnknownPayload",i=>{const{topic:r}=i,{message:n}=F("MISSING_OR_INVALID",`Decoded payload on topic ${r} is not identifiable as a JSON-RPC request or a response.`);throw new Error(n)}),R(this,"shouldIgnorePairingRequest",i=>{const{topic:r,requestMethod:n}=i,s=this.expectedPairingMethodMap.get(r);return!s||s.includes(n)?!1:!!(s.includes("wc_sessionAuthenticate")&&this.client.events.listenerCount("session_authenticate")>0)}),R(this,"onSessionProposeRequest",async i=>{const{topic:r,payload:n,attestation:s,encryptedId:o}=i,{params:a,id:c}=n;try{const u=this.client.core.eventClient.getEvent({topic:r});this.client.events.listenerCount("session_proposal")===0&&(console.warn("No listener for session_proposal event"),u?.setError(xt.proposal_listener_not_found)),this.isValidConnect(re({},n.params));const l=a.expiryTimestamp||pe(ye.wc_sessionPropose.req.ttl),h=re({id:c,pairingTopic:r,expiryTimestamp:l},a);await this.setProposal(c,h);const d=await this.getVerifyContext({attestationId:s,hash:wt(JSON.stringify(n)),encryptedId:o,metadata:h.proposer.metadata});u?.addTrace(dt.emit_session_proposal),this.client.events.emit("session_proposal",{id:c,params:h,verifyContext:d})}catch(u){await this.sendError({id:c,topic:r,error:u,rpcOpts:ye.wc_sessionPropose.autoReject}),this.client.logger.error(u)}}),R(this,"onSessionProposeResponse",async(i,r,n)=>{const{id:s}=r;if(ft(r)){const{result:o}=r;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:o});const a=this.client.proposal.get(s);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:a});const c=a.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:c});const u=o.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:u});const l=await this.client.core.crypto.generateSharedKey(c,u);this.pendingSessions.set(s,{sessionTopic:l,pairingTopic:i,proposalId:s,publicKey:c});const h=await this.client.core.relayer.subscribe(l,{transportType:n});this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:h}),await this.client.core.pairing.activate({topic:i})}else if(Qe(r)){await this.client.proposal.delete(s,ne("USER_DISCONNECTED"));const o=X("session_connect",s);if(this.events.listenerCount(o)===0)throw new Error(`emitting ${o} without any listeners, 954`);this.events.emit(o,{error:r.error})}}),R(this,"onSessionSettleRequest",async(i,r)=>{const{id:n,params:s}=r;try{this.isValidSessionSettleRequest(s);const{relay:o,controller:a,expiry:c,namespaces:u,sessionProperties:l,scopedProperties:h,sessionConfig:d}=r.params,f=[...this.pendingSessions.values()].find(y=>y.sessionTopic===i);if(!f)return this.client.logger.error(`Pending session not found for topic ${i}`);const p=this.client.proposal.get(f.proposalId),g=Te(re(re(re({topic:i,relay:o,expiry:c,namespaces:u,acknowledged:!0,pairingTopic:f.pairingTopic,requiredNamespaces:p.requiredNamespaces,optionalNamespaces:p.optionalNamespaces,controller:a.publicKey,self:{publicKey:f.publicKey,metadata:this.client.metadata},peer:{publicKey:a.publicKey,metadata:a.metadata}},l&&{sessionProperties:l}),h&&{scopedProperties:h}),d&&{sessionConfig:d}),{transportType:ce.relay});await this.client.session.set(g.topic,g),await this.setExpiry(g.topic,g.expiry),await this.client.core.pairing.updateMetadata({topic:f.pairingTopic,metadata:g.peer.metadata}),this.client.events.emit("session_connect",{session:g}),this.events.emit(X("session_connect",f.proposalId),{session:g}),this.pendingSessions.delete(f.proposalId),this.deleteProposal(f.proposalId,!1),this.cleanupDuplicatePairings(g),await this.sendResult({id:r.id,topic:i,result:!0,throwOnFailedPublish:!0})}catch(o){await this.sendError({id:n,topic:i,error:o}),this.client.logger.error(o)}}),R(this,"onSessionSettleResponse",async(i,r)=>{const{id:n}=r;ft(r)?(await this.client.session.update(i,{acknowledged:!0}),this.events.emit(X("session_approve",n),{})):Qe(r)&&(await this.client.session.delete(i,ne("USER_DISCONNECTED")),this.events.emit(X("session_approve",n),{error:r.error}))}),R(this,"onSessionUpdateRequest",async(i,r)=>{const{params:n,id:s}=r;try{const o=`${i}_session_update`,a=Vi.get(o);if(a&&this.isRequestOutOfSync(a,s)){this.client.logger.warn(`Discarding out of sync request - ${s}`),this.sendError({id:s,topic:i,error:ne("INVALID_UPDATE_REQUEST")});return}this.isValidUpdate(re({topic:i},n));try{Vi.set(o,s),await this.client.session.update(i,{namespaces:n.namespaces}),await this.sendResult({id:s,topic:i,result:!0,throwOnFailedPublish:!0})}catch(c){throw Vi.delete(o),c}this.client.events.emit("session_update",{id:s,topic:i,params:n})}catch(o){await this.sendError({id:s,topic:i,error:o}),this.client.logger.error(o)}}),R(this,"isRequestOutOfSync",(i,r)=>r.toString().slice(0,-3)<i.toString().slice(0,-3)),R(this,"onSessionUpdateResponse",(i,r)=>{const{id:n}=r,s=X("session_update",n);if(this.events.listenerCount(s)===0)throw new Error(`emitting ${s} without any listeners`);ft(r)?this.events.emit(X("session_update",n),{}):Qe(r)&&this.events.emit(X("session_update",n),{error:r.error})}),R(this,"onSessionExtendRequest",async(i,r)=>{const{id:n}=r;try{this.isValidExtend({topic:i}),await this.setExpiry(i,pe(bi)),await this.sendResult({id:n,topic:i,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_extend",{id:n,topic:i})}catch(s){await this.sendError({id:n,topic:i,error:s}),this.client.logger.error(s)}}),R(this,"onSessionExtendResponse",(i,r)=>{const{id:n}=r,s=X("session_extend",n);if(this.events.listenerCount(s)===0)throw new Error(`emitting ${s} without any listeners`);ft(r)?this.events.emit(X("session_extend",n),{}):Qe(r)&&this.events.emit(X("session_extend",n),{error:r.error})}),R(this,"onSessionPingRequest",async(i,r)=>{const{id:n}=r;try{this.isValidPing({topic:i}),await this.sendResult({id:n,topic:i,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_ping",{id:n,topic:i})}catch(s){await this.sendError({id:n,topic:i,error:s}),this.client.logger.error(s)}}),R(this,"onSessionPingResponse",(i,r)=>{const{id:n}=r,s=X("session_ping",n);setTimeout(()=>{if(this.events.listenerCount(s)===0)throw new Error(`emitting ${s} without any listeners 2176`);ft(r)?this.events.emit(X("session_ping",n),{}):Qe(r)&&this.events.emit(X("session_ping",n),{error:r.error})},500)}),R(this,"onSessionDeleteRequest",async(i,r)=>{const{id:n}=r;try{this.isValidDisconnect({topic:i,reason:r.params}),Promise.all([new Promise(s=>{this.client.core.relayer.once(be.publish,async()=>{s(await this.deleteSession({topic:i,id:n}))})}),this.sendResult({id:n,topic:i,result:!0,throwOnFailedPublish:!0}),this.cleanupPendingSentRequestsForTopic({topic:i,error:ne("USER_DISCONNECTED")})]).catch(s=>this.client.logger.error(s))}catch(s){this.client.logger.error(s)}}),R(this,"onSessionRequest",async i=>{var r,n,s;const{topic:o,payload:a,attestation:c,encryptedId:u,transportType:l}=i,{id:h,params:d}=a;try{await this.isValidRequest(re({topic:o},d));const f=this.client.session.get(o),p=await this.getVerifyContext({attestationId:c,hash:wt(JSON.stringify(Xt("wc_sessionRequest",d,h))),encryptedId:u,metadata:f.peer.metadata,transportType:l}),g={id:h,topic:o,params:d,verifyContext:p};await this.setPendingSessionRequest(g),l===ce.link_mode&&(r=f.peer.metadata.redirect)!=null&&r.universal&&this.client.core.addLinkModeSupportedApp((n=f.peer.metadata.redirect)==null?void 0:n.universal),(s=this.client.signConfig)!=null&&s.disableRequestQueue?this.emitSessionRequest(g):(this.addSessionRequestToSessionRequestQueue(g),this.processSessionRequestQueue())}catch(f){await this.sendError({id:h,topic:o,error:f}),this.client.logger.error(f)}}),R(this,"onSessionRequestResponse",(i,r)=>{const{id:n}=r,s=X("session_request",n);if(this.events.listenerCount(s)===0)throw new Error(`emitting ${s} without any listeners`);ft(r)?this.events.emit(X("session_request",n),{result:r.result}):Qe(r)&&this.events.emit(X("session_request",n),{error:r.error})}),R(this,"onSessionEventRequest",async(i,r)=>{const{id:n,params:s}=r;try{const o=`${i}_session_event_${s.event.name}`,a=Vi.get(o);if(a&&this.isRequestOutOfSync(a,n)){this.client.logger.info(`Discarding out of sync request - ${n}`);return}this.isValidEmit(re({topic:i},s)),this.client.events.emit("session_event",{id:n,topic:i,params:s}),Vi.set(o,n)}catch(o){await this.sendError({id:n,topic:i,error:o}),this.client.logger.error(o)}}),R(this,"onSessionAuthenticateResponse",(i,r)=>{const{id:n}=r;this.client.logger.trace({type:"method",method:"onSessionAuthenticateResponse",topic:i,payload:r}),ft(r)?this.events.emit(X("session_request",n),{result:r.result}):Qe(r)&&this.events.emit(X("session_request",n),{error:r.error})}),R(this,"onSessionAuthenticateRequest",async i=>{var r;const{topic:n,payload:s,attestation:o,encryptedId:a,transportType:c}=i;try{const{requester:u,authPayload:l,expiryTimestamp:h}=s.params,d=await this.getVerifyContext({attestationId:o,hash:wt(JSON.stringify(s)),encryptedId:a,metadata:u.metadata,transportType:c}),f={requester:u,pairingTopic:n,id:s.id,authPayload:l,verifyContext:d,expiryTimestamp:h};await this.setAuthRequest(s.id,{request:f,pairingTopic:n,transportType:c}),c===ce.link_mode&&(r=u.metadata.redirect)!=null&&r.universal&&this.client.core.addLinkModeSupportedApp(u.metadata.redirect.universal),this.client.events.emit("session_authenticate",{topic:n,params:s.params,id:s.id,verifyContext:d})}catch(u){this.client.logger.error(u);const l=s.params.requester.publicKey,h=await this.client.core.crypto.generateKeyPair(),d=this.getAppLinkIfEnabled(s.params.requester.metadata,c),f={type:Rt,receiverPublicKey:l,senderPublicKey:h};await this.sendError({id:s.id,topic:n,error:u,encodeOpts:f,rpcOpts:ye.wc_sessionAuthenticate.autoReject,appLink:d})}}),R(this,"addSessionRequestToSessionRequestQueue",i=>{this.sessionRequestQueue.queue.push(i)}),R(this,"cleanupAfterResponse",i=>{this.deletePendingSessionRequest(i.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=ht.idle,this.processSessionRequestQueue()},T.toMiliseconds(this.requestQueueDelay))}),R(this,"cleanupPendingSentRequestsForTopic",({topic:i,error:r})=>{const n=this.client.core.history.pending;n.length>0&&n.filter(s=>s.topic===i&&s.request.method==="wc_sessionRequest").forEach(s=>{const o=s.request.id,a=X("session_request",o);if(this.events.listenerCount(a)===0)throw new Error(`emitting ${a} without any listeners`);this.events.emit(X("session_request",s.request.id),{error:r})})}),R(this,"processSessionRequestQueue",()=>{if(this.sessionRequestQueue.state===ht.active){this.client.logger.info("session request queue is already active.");return}const i=this.sessionRequestQueue.queue[0];if(!i){this.client.logger.info("session request queue is empty.");return}try{this.sessionRequestQueue.state=ht.active,this.emitSessionRequest(i)}catch(r){this.client.logger.error(r)}}),R(this,"emitSessionRequest",i=>{this.client.events.emit("session_request",i)}),R(this,"onPairingCreated",i=>{if(i.methods&&this.expectedPairingMethodMap.set(i.topic,i.methods),i.active)return;const r=this.client.proposal.getAll().find(n=>n.pairingTopic===i.topic);r&&this.onSessionProposeRequest({topic:i.topic,payload:Xt("wc_sessionPropose",Te(re({},r),{requiredNamespaces:r.requiredNamespaces,optionalNamespaces:r.optionalNamespaces,relays:r.relays,proposer:r.proposer,sessionProperties:r.sessionProperties,scopedProperties:r.scopedProperties}),r.id)})}),R(this,"isValidConnect",async i=>{if(!ke(i)){const{message:u}=F("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(i)}`);throw new Error(u)}const{pairingTopic:r,requiredNamespaces:n,optionalNamespaces:s,sessionProperties:o,scopedProperties:a,relays:c}=i;if($e(r)||await this.isValidPairingTopic(r),!tv(c,!0)){const{message:u}=F("MISSING_OR_INVALID",`connect() relays: ${c}`);throw new Error(u)}if(!$e(n)&&rn(n)!==0&&this.validateNamespaces(n,"requiredNamespaces"),!$e(s)&&rn(s)!==0&&this.validateNamespaces(s,"optionalNamespaces"),$e(o)||this.validateSessionProps(o,"sessionProperties"),!$e(a)){this.validateSessionProps(a,"scopedProperties");const u=Object.keys(n||{}).concat(Object.keys(s||{}));if(!Object.keys(a).every(l=>u.includes(l)))throw new Error(`Scoped properties must be a subset of required/optional namespaces, received: ${JSON.stringify(a)}, required/optional namespaces: ${JSON.stringify(u)}`)}}),R(this,"validateNamespaces",(i,r)=>{const n=ev(i,"connect()",r);if(n)throw new Error(n.message)}),R(this,"isValidApprove",async i=>{if(!ke(i))throw new Error(F("MISSING_OR_INVALID",`approve() params: ${i}`).message);const{id:r,namespaces:n,relayProtocol:s,sessionProperties:o,scopedProperties:a}=i;this.checkRecentlyDeleted(r),await this.isValidProposalId(r);const c=this.client.proposal.get(r),u=es(n,"approve()");if(u)throw new Error(u.message);const l=pc(c.requiredNamespaces,n,"approve()");if(l)throw new Error(l.message);if(!de(s,!0)){const{message:h}=F("MISSING_OR_INVALID",`approve() relayProtocol: ${s}`);throw new Error(h)}if($e(o)||this.validateSessionProps(o,"sessionProperties"),!$e(a)){this.validateSessionProps(a,"scopedProperties");const h=new Set(Object.keys(n));if(!Object.keys(a).every(d=>h.has(d)))throw new Error(`Scoped properties must be a subset of approved namespaces, received: ${JSON.stringify(a)}, approved namespaces: ${Array.from(h).join(", ")}`)}}),R(this,"isValidReject",async i=>{if(!ke(i)){const{message:s}=F("MISSING_OR_INVALID",`reject() params: ${i}`);throw new Error(s)}const{id:r,reason:n}=i;if(this.checkRecentlyDeleted(r),await this.isValidProposalId(r),!rv(n)){const{message:s}=F("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(n)}`);throw new Error(s)}}),R(this,"isValidSessionSettleRequest",i=>{if(!ke(i)){const{message:u}=F("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${i}`);throw new Error(u)}const{relay:r,controller:n,namespaces:s,expiry:o}=i;if(!Jl(r)){const{message:u}=F("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(u)}const a=G0(n,"onSessionSettleRequest()");if(a)throw new Error(a.message);const c=es(s,"onSessionSettleRequest()");if(c)throw new Error(c.message);if(Bt(o)){const{message:u}=F("EXPIRED","onSessionSettleRequest()");throw new Error(u)}}),R(this,"isValidUpdate",async i=>{if(!ke(i)){const{message:c}=F("MISSING_OR_INVALID",`update() params: ${i}`);throw new Error(c)}const{topic:r,namespaces:n}=i;this.checkRecentlyDeleted(r),await this.isValidSessionTopic(r);const s=this.client.session.get(r),o=es(n,"update()");if(o)throw new Error(o.message);const a=pc(s.requiredNamespaces,n,"update()");if(a)throw new Error(a.message)}),R(this,"isValidExtend",async i=>{if(!ke(i)){const{message:n}=F("MISSING_OR_INVALID",`extend() params: ${i}`);throw new Error(n)}const{topic:r}=i;this.checkRecentlyDeleted(r),await this.isValidSessionTopic(r)}),R(this,"isValidRequest",async i=>{if(!ke(i)){const{message:c}=F("MISSING_OR_INVALID",`request() params: ${i}`);throw new Error(c)}const{topic:r,request:n,chainId:s,expiry:o}=i;this.checkRecentlyDeleted(r),await this.isValidSessionTopic(r);const{namespaces:a}=this.client.session.get(r);if(!dc(a,s)){const{message:c}=F("MISSING_OR_INVALID",`request() chainId: ${s}`);throw new Error(c)}if(!nv(n)){const{message:c}=F("MISSING_OR_INVALID",`request() ${JSON.stringify(n)}`);throw new Error(c)}if(!av(a,s,n.method)){const{message:c}=F("MISSING_OR_INVALID",`request() method: ${n.method}`);throw new Error(c)}if(o&&!hv(o,as)){const{message:c}=F("MISSING_OR_INVALID",`request() expiry: ${o}. Expiry must be a number (in seconds) between ${as.min} and ${as.max}`);throw new Error(c)}}),R(this,"isValidRespond",async i=>{var r;if(!ke(i)){const{message:o}=F("MISSING_OR_INVALID",`respond() params: ${i}`);throw new Error(o)}const{topic:n,response:s}=i;try{await this.isValidSessionTopic(n)}catch(o){throw(r=i?.response)!=null&&r.id&&this.cleanupAfterResponse(i),o}if(!sv(s)){const{message:o}=F("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(s)}`);throw new Error(o)}}),R(this,"isValidPing",async i=>{if(!ke(i)){const{message:n}=F("MISSING_OR_INVALID",`ping() params: ${i}`);throw new Error(n)}const{topic:r}=i;await this.isValidSessionOrPairingTopic(r)}),R(this,"isValidEmit",async i=>{if(!ke(i)){const{message:a}=F("MISSING_OR_INVALID",`emit() params: ${i}`);throw new Error(a)}const{topic:r,event:n,chainId:s}=i;await this.isValidSessionTopic(r);const{namespaces:o}=this.client.session.get(r);if(!dc(o,s)){const{message:a}=F("MISSING_OR_INVALID",`emit() chainId: ${s}`);throw new Error(a)}if(!ov(n)){const{message:a}=F("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(n)}`);throw new Error(a)}if(!cv(o,s,n.name)){const{message:a}=F("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(n)}`);throw new Error(a)}}),R(this,"isValidDisconnect",async i=>{if(!ke(i)){const{message:n}=F("MISSING_OR_INVALID",`disconnect() params: ${i}`);throw new Error(n)}const{topic:r}=i;await this.isValidSessionOrPairingTopic(r)}),R(this,"isValidAuthenticate",i=>{const{chains:r,uri:n,domain:s,nonce:o}=i;if(!Array.isArray(r)||r.length===0)throw new Error("chains is required and must be a non-empty array");if(!de(n,!1))throw new Error("uri is required parameter");if(!de(s,!1))throw new Error("domain is required parameter");if(!de(o,!1))throw new Error("nonce is required parameter");if([...new Set(r.map(c=>zr(c).namespace))].length>1)throw new Error("Multi-namespace requests are not supported. Please request single namespace only.");const{namespace:a}=zr(r[0]);if(a!=="eip155")throw new Error("Only eip155 namespace is supported for authenticated sessions. Please use .connect() for non-eip155 chains.")}),R(this,"getVerifyContext",async i=>{const{attestationId:r,hash:n,encryptedId:s,metadata:o,transportType:a}=i,c={verified:{verifyUrl:o.verifyUrl||er,validation:"UNKNOWN",origin:o.url||""}};try{if(a===ce.link_mode){const l=this.getAppLinkIfEnabled(o,a);return c.verified.validation=l&&new URL(l).origin===new URL(o.url).origin?"VALID":"INVALID",c}const u=await this.client.core.verify.resolve({attestationId:r,hash:n,encryptedId:s,verifyUrl:o.verifyUrl});u&&(c.verified.origin=u.origin,c.verified.isScam=u.isScam,c.verified.validation=u.origin===new URL(o.url).origin?"VALID":"INVALID")}catch(u){this.client.logger.warn(u)}return this.client.logger.debug(`Verify context: ${JSON.stringify(c)}`),c}),R(this,"validateSessionProps",(i,r)=>{Object.values(i).forEach((n,s)=>{if(n==null){const{message:o}=F("MISSING_OR_INVALID",`${r} must contain an existing value for each key. Received: ${n} for key ${Object.keys(i)[s]}`);throw new Error(o)}})}),R(this,"getPendingAuthRequest",i=>{const r=this.client.auth.requests.get(i);return typeof r=="object"?r:void 0}),R(this,"addToRecentlyDeleted",(i,r)=>{if(this.recentlyDeletedMap.set(i,r),this.recentlyDeletedMap.size>=this.recentlyDeletedLimit){let n=0;const s=this.recentlyDeletedLimit/2;for(const o of this.recentlyDeletedMap.keys()){if(n++>=s)break;this.recentlyDeletedMap.delete(o)}}}),R(this,"checkRecentlyDeleted",i=>{const r=this.recentlyDeletedMap.get(i);if(r){const{message:n}=F("MISSING_OR_INVALID",`Record was recently deleted - ${r}: ${i}`);throw new Error(n)}}),R(this,"isLinkModeEnabled",(i,r)=>{var n,s,o,a,c,u,l,h,d;return!i||r!==ce.link_mode?!1:((s=(n=this.client.metadata)==null?void 0:n.redirect)==null?void 0:s.linkMode)===!0&&((a=(o=this.client.metadata)==null?void 0:o.redirect)==null?void 0:a.universal)!==void 0&&((u=(c=this.client.metadata)==null?void 0:c.redirect)==null?void 0:u.universal)!==""&&((l=i?.redirect)==null?void 0:l.universal)!==void 0&&((h=i?.redirect)==null?void 0:h.universal)!==""&&((d=i?.redirect)==null?void 0:d.linkMode)===!0&&this.client.core.linkModeSupportedApps.includes(i.redirect.universal)&&typeof(global==null?void 0:global.Linking)<"u"}),R(this,"getAppLinkIfEnabled",(i,r)=>{var n;return this.isLinkModeEnabled(i,r)?(n=i?.redirect)==null?void 0:n.universal:void 0}),R(this,"handleLinkModeMessage",({url:i})=>{if(!i||!i.includes("wc_ev")||!i.includes("topic"))return;const r=Ca(i,"topic")||"",n=decodeURIComponent(Ca(i,"wc_ev")||""),s=this.client.session.keys.includes(r);s&&this.client.session.update(r,{transportType:ce.link_mode}),this.client.core.dispatchEnvelope({topic:r,message:n,sessionExists:s})}),R(this,"registerLinkModeListeners",async()=>{var i;if(uo()||qt()&&(i=this.client.metadata.redirect)!=null&&i.linkMode){const r=global==null?void 0:global.Linking;if(typeof r<"u"){r.addEventListener("url",this.handleLinkModeMessage,this.client.name);const n=await r.getInitialURL();n&&setTimeout(()=>{this.handleLinkModeMessage({url:n})},50)}}}),R(this,"shouldSetTVF",(i,r)=>{if(!r||i!=="wc_sessionRequest")return!1;const{request:n}=r;return Object.keys(Gc).includes(n.method)}),R(this,"getTVFParams",(i,r,n)=>{var s,o;try{const a=r.request.method,c=this.extractTxHashesFromResult(a,n);return Te(re({correlationId:i,rpcMethods:[a],chainId:r.chainId},this.isValidContractData(r.request.params)&&{contractAddresses:[(o=(s=r.request.params)==null?void 0:s[0])==null?void 0:o.to]}),{txHashes:c})}catch(a){this.client.logger.warn("Error getting TVF params",a)}return{}}),R(this,"isValidContractData",i=>{var r;if(!i)return!1;try{const n=i?.data||((r=i?.[0])==null?void 0:r.data);if(!n.startsWith("0x"))return!1;const s=n.slice(2);return/^[0-9a-fA-F]*$/.test(s)?s.length%2===0:!1}catch{}return!1}),R(this,"extractTxHashesFromResult",(i,r)=>{try{const n=Gc[i];if(typeof r=="string")return[r];const s=r[n.key];if(Sr(s))return i==="solana_signAllTransactions"?s.map(o=>kb(o)):s;if(typeof s=="string")return[s]}catch(n){this.client.logger.warn("Error extracting tx hashes from result",n)}return[]})}async processPendingMessageEvents(){try{const e=this.client.session.keys,i=this.client.core.relayer.messages.getWithoutAck(e);for(const[r,n]of Object.entries(i))for(const s of n)try{await this.onProviderMessageEvent({topic:r,message:s,publishedAt:Date.now()})}catch{this.client.logger.warn(`Error processing pending message event for topic: ${r}, message: ${s}`)}}catch(e){this.client.logger.warn("processPendingMessageEvents failed",e)}}isInitialized(){if(!this.initialized){const{message:e}=F("NOT_INITIALIZED",this.name);throw new Error(e)}}async confirmOnlineStateOrThrow(){await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(be.message,e=>{this.onProviderMessageEvent(e)})}async onRelayMessage(e){const{topic:i,message:r,attestation:n,transportType:s}=e,{publicKey:o}=this.client.auth.authKeys.keys.includes(Wr)?this.client.auth.authKeys.get(Wr):{responseTopic:void 0,publicKey:void 0};try{const a=await this.client.core.crypto.decode(i,r,{receiverPublicKey:o,encoding:s===ce.link_mode?Ut:at});bo(a)?(this.client.core.history.set(i,a),await this.onRelayEventRequest({topic:i,payload:a,attestation:n,transportType:s,encryptedId:wt(r)})):En(a)?(await this.client.core.history.resolve(a),await this.onRelayEventResponse({topic:i,payload:a,transportType:s}),this.client.core.history.delete(i,a.id)):await this.onRelayEventUnknownPayload({topic:i,payload:a,transportType:s}),await this.client.core.relayer.messages.ack(i,r)}catch(a){this.client.logger.error(a)}}registerExpirerEvents(){this.client.core.expirer.on(Ze.expired,async e=>{const{topic:i,id:r}=gl(e.target);if(r&&this.client.pendingRequest.keys.includes(r))return await this.deletePendingSessionRequest(r,F("EXPIRED"),!0);if(r&&this.client.auth.requests.keys.includes(r))return await this.deletePendingAuthRequest(r,F("EXPIRED"),!0);i?this.client.session.keys.includes(i)&&(await this.deleteSession({topic:i,expirerHasDeleted:!0}),this.client.events.emit("session_expire",{topic:i})):r&&(await this.deleteProposal(r,!0),this.client.events.emit("proposal_expire",{id:r}))})}registerPairingEvents(){this.client.core.pairing.events.on(Jt.create,e=>this.onPairingCreated(e)),this.client.core.pairing.events.on(Jt.delete,e=>{this.addToRecentlyDeleted(e.topic,"pairing")})}isValidPairingTopic(e){if(!de(e,!1)){const{message:i}=F("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw new Error(i)}if(!this.client.core.pairing.pairings.keys.includes(e)){const{message:i}=F("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw new Error(i)}if(Bt(this.client.core.pairing.pairings.get(e).expiry)){const{message:i}=F("EXPIRED",`pairing topic: ${e}`);throw new Error(i)}}async isValidSessionTopic(e){if(!de(e,!1)){const{message:i}=F("MISSING_OR_INVALID",`session topic should be a string: ${e}`);throw new Error(i)}if(this.checkRecentlyDeleted(e),!this.client.session.keys.includes(e)){const{message:i}=F("NO_MATCHING_KEY",`session topic doesn't exist: ${e}`);throw new Error(i)}if(Bt(this.client.session.get(e).expiry)){await this.deleteSession({topic:e});const{message:i}=F("EXPIRED",`session topic: ${e}`);throw new Error(i)}if(!this.client.core.crypto.keychain.has(e)){const{message:i}=F("MISSING_OR_INVALID",`session topic does not exist in keychain: ${e}`);throw await this.deleteSession({topic:e}),new Error(i)}}async isValidSessionOrPairingTopic(e){if(this.checkRecentlyDeleted(e),this.client.session.keys.includes(e))await this.isValidSessionTopic(e);else if(this.client.core.pairing.pairings.keys.includes(e))this.isValidPairingTopic(e);else if(de(e,!1)){const{message:i}=F("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${e}`);throw new Error(i)}else{const{message:i}=F("MISSING_OR_INVALID",`session or pairing topic should be a string: ${e}`);throw new Error(i)}}async isValidProposalId(e){if(!iv(e)){const{message:i}=F("MISSING_OR_INVALID",`proposal id should be a number: ${e}`);throw new Error(i)}if(!this.client.proposal.keys.includes(e)){const{message:i}=F("NO_MATCHING_KEY",`proposal id doesn't exist: ${e}`);throw new Error(i)}if(Bt(this.client.proposal.get(e).expiryTimestamp)){await this.deleteProposal(e);const{message:i}=F("EXPIRED",`proposal id: ${e}`);throw new Error(i)}}}class UI extends ui{constructor(e,i){super(e,i,_I,Eo),this.core=e,this.logger=i}}class kI extends ui{constructor(e,i){super(e,i,II,Eo),this.core=e,this.logger=i}}class MI extends ui{constructor(e,i){super(e,i,SI,Eo,r=>r.id),this.core=e,this.logger=i}}class qI extends ui{constructor(e,i){super(e,i,AI,In,()=>Wr),this.core=e,this.logger=i}}class jI extends ui{constructor(e,i){super(e,i,PI,In),this.core=e,this.logger=i}}class zI extends ui{constructor(e,i){super(e,i,CI,In,r=>r.id),this.core=e,this.logger=i}}var VI=Object.defineProperty,KI=(t,e,i)=>e in t?VI(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,cs=(t,e,i)=>KI(t,typeof e!="symbol"?e+"":e,i);class HI{constructor(e,i){this.core=e,this.logger=i,cs(this,"authKeys"),cs(this,"pairingTopics"),cs(this,"requests"),this.authKeys=new qI(this.core,this.logger),this.pairingTopics=new jI(this.core,this.logger),this.requests=new zI(this.core,this.logger)}async init(){await this.authKeys.init(),await this.pairingTopics.init(),await this.requests.init()}}var WI=Object.defineProperty,GI=(t,e,i)=>e in t?WI(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,G=(t,e,i)=>GI(t,typeof e!="symbol"?e+"":e,i);class Dn extends Mp{constructor(e){super(e),G(this,"protocol",mh),G(this,"version",bh),G(this,"name",os.name),G(this,"metadata"),G(this,"core"),G(this,"logger"),G(this,"events",new Ge.EventEmitter),G(this,"engine"),G(this,"session"),G(this,"proposal"),G(this,"pendingRequest"),G(this,"auth"),G(this,"signConfig"),G(this,"on",(r,n)=>this.events.on(r,n)),G(this,"once",(r,n)=>this.events.once(r,n)),G(this,"off",(r,n)=>this.events.off(r,n)),G(this,"removeListener",(r,n)=>this.events.removeListener(r,n)),G(this,"removeAllListeners",r=>this.events.removeAllListeners(r)),G(this,"connect",async r=>{try{return await this.engine.connect(r)}catch(n){throw this.logger.error(n.message),n}}),G(this,"pair",async r=>{try{return await this.engine.pair(r)}catch(n){throw this.logger.error(n.message),n}}),G(this,"approve",async r=>{try{return await this.engine.approve(r)}catch(n){throw this.logger.error(n.message),n}}),G(this,"reject",async r=>{try{return await this.engine.reject(r)}catch(n){throw this.logger.error(n.message),n}}),G(this,"update",async r=>{try{return await this.engine.update(r)}catch(n){throw this.logger.error(n.message),n}}),G(this,"extend",async r=>{try{return await this.engine.extend(r)}catch(n){throw this.logger.error(n.message),n}}),G(this,"request",async r=>{try{return await this.engine.request(r)}catch(n){throw this.logger.error(n.message),n}}),G(this,"respond",async r=>{try{return await this.engine.respond(r)}catch(n){throw this.logger.error(n.message),n}}),G(this,"ping",async r=>{try{return await this.engine.ping(r)}catch(n){throw this.logger.error(n.message),n}}),G(this,"emit",async r=>{try{return await this.engine.emit(r)}catch(n){throw this.logger.error(n.message),n}}),G(this,"disconnect",async r=>{try{return await this.engine.disconnect(r)}catch(n){throw this.logger.error(n.message),n}}),G(this,"find",r=>{try{return this.engine.find(r)}catch(n){throw this.logger.error(n.message),n}}),G(this,"getPendingSessionRequests",()=>{try{return this.engine.getPendingSessionRequests()}catch(r){throw this.logger.error(r.message),r}}),G(this,"authenticate",async(r,n)=>{try{return await this.engine.authenticate(r,n)}catch(s){throw this.logger.error(s.message),s}}),G(this,"formatAuthMessage",r=>{try{return this.engine.formatAuthMessage(r)}catch(n){throw this.logger.error(n.message),n}}),G(this,"approveSessionAuthenticate",async r=>{try{return await this.engine.approveSessionAuthenticate(r)}catch(n){throw this.logger.error(n.message),n}}),G(this,"rejectSessionAuthenticate",async r=>{try{return await this.engine.rejectSessionAuthenticate(r)}catch(n){throw this.logger.error(n.message),n}}),this.name=e?.name||os.name,this.metadata=Zm(e?.metadata),this.signConfig=e?.signConfig;const i=typeof e?.logger<"u"&&typeof e?.logger!="string"?e.logger:un(Ys({level:e?.logger||os.logger}));this.core=e?.core||new EI(e),this.logger=Fe(i,this.name),this.session=new kI(this.core,this.logger),this.proposal=new UI(this.core,this.logger),this.pendingRequest=new MI(this.core,this.logger),this.engine=new BI(this),this.auth=new HI(this.core,this.logger)}static async init(e){const i=new Dn(e);return await i.initialize(),i}get context(){return je(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.auth.init(),await this.engine.init(),this.logger.info("SignClient Initialization Success"),setTimeout(()=>{this.engine.processRelayMessageCache()},T.toMiliseconds(T.ONE_SECOND))}catch(e){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(e.message),e}}}const us=st.getDevice(),YI={width:"245px",height:"245px",borderRadius:"40px",zIndex:"99999",backgroundColor:"white",border:"none",outline:"none"},JI=`
  <div id="argent-mobile-modal-container" style="position: relative; display: flex; justify-content: center; align-items: center">
    <iframe class="argent-iframe" allow="clipboard-write"></iframe>
  </div>
`;class ZI{constructor(){V(this,"bridgeUrl","https://login.ready.co");V(this,"mobileUrl","ready://");V(this,"type","overlay");V(this,"wcUri");V(this,"overlay");V(this,"popupWindow");V(this,"closingTimeout");V(this,"standaloneConnectorModal")}showWalletConnectModal(e,i){const r=encodeURIComponent(e),n=encodeURIComponent(window.location.href);this.showModal({desktop:`${this.bridgeUrl}?wc=${r}&href=${n}&device=desktop&onlyQR=true`,ios:`${this.mobileUrl}app/wc?uri=${r}&href=${n}&device=mobile&onlyQR=true`,android:`${this.mobileUrl}app/wc?uri=${r}&href=${n}&device=mobile&onlyQR=true`},i)}getWalletConnectQR(e){const i=encodeURIComponent(e),r=encodeURIComponent(window.location.href);this.getQR({desktop:`${this.bridgeUrl}?wc=${i}&href=${r}&device=desktop&onlyQR=true`,ios:`${this.mobileUrl}app/wc?uri=${i}&href=${r}&device=mobile&onlyQR=true`,android:`${this.mobileUrl}app/wc?uri=${i}&href=${r}&device=mobile&onlyQR=true`})}openMobileApp(e){const i=document.createElement("button");i.style.display="none",i.addEventListener("click",()=>{window.location.href=e[us]}),i.click()}getQR(e){if(["android","ios"].includes(us)){this.openMobileApp(e);return}const i=document.createElement("div"),r=document.querySelector("#starknetkit-modal-container");if(r?.shadowRoot){const n=r.shadowRoot.querySelector(".qr-code-slot");if(n){n.innerHTML=JI,document.body.appendChild(i),this.overlay=i;const s=n.querySelector("iframe");s.setAttribute("src",e.desktop);for(const[o,a]of Object.entries(YI))s.style[o]=a}else throw new Error("Cannot find QR code slot")}else throw new Error("Cannot find modal")}showApprovalModal(e){const i=encodeURIComponent(window.location.href),r={desktop:`${this.bridgeUrl}?action=sign&device=desktop&href=${i}`,ios:`${this.mobileUrl}app/wc/request?href=${i}&device=mobile`,android:`${this.mobileUrl}app/wc/request?href=${i}&device=mobile`};if(!Zc.isInArgentMobileAppBrowser()){if(this.getModal(void 0,st.Layout.approval),["android","ios"].includes(us)){this.openMobileApp(r);return}return}this.showModal(r,void 0)}closeModal({success:e,isRequest:i}={success:!1,isRequest:!1}){const r=this.standaloneConnectorModal;e?(r?.$set({layout:st.Layout.success}),setTimeout(()=>r?.$destroy(),500)):i?(r?.$set({layout:st.Layout.requestFailure}),setTimeout(()=>r?.$destroy(),500)):r?.$set({layout:st.Layout.loginFailure})}getModal(e,i=st.Layout.qrCode){this.standaloneConnectorModal=new st.Modal({target:st.getModalTarget(),props:{layout:i,dappName:e?.dappName,showBackButton:!1,selectedWallet:e,callback:async r=>{try{const n=r?.connector;this.standaloneConnectorModal?.$destroy(),await n?.connect()}catch{this.standaloneConnectorModal?.$set({layout:st.Layout.loginFailure})}}}})}showModal(e,i){this.getModal(i,st.Layout.qrCode),this.getQR(e)}}const ot=new ZI,on=gt.constants.NetworkName,QI=async({projectId:t,chainId:e,name:i,description:r,rpcUrl:n,bridgeUrl:s=XI(e),mobileUrl:o=eD(e),modalType:a="overlay",url:c,icons:u,walletConnect:l,onlyQRCode:h,modalWallet:d},f)=>{if(!s)throw new Error("bridgeUrl is required");if(!o)throw new Error("mobileUrl is required");ot.bridgeUrl=s,ot.mobileUrl=o,ot.type=a;const p={projectId:t,metadata:{name:i??"Unknown dapp",description:r??"Unknown dapp description",url:c??"#",icons:u??[],...l?.metadata}},g=await Dn.init(p),y=new gt.RpcProvider({nodeUrl:n}),m=new f({client:g,chainId:e,rpcUrl:n,provider:y});g.on("session_event",w=>{}),g.on("session_update",({topic:w,params:b})=>{const{namespaces:E}=b,x=g.session.get(w);m.updateSession({...x,namespaces:E})}),g.on("session_delete",()=>{});try{const w=g.session.getAll().find(m.isValidSession);if(w)return m.updateSession(w),m;const b={requiredNamespaces:m.getRequiredNamespaces()};Zc.resetWalletConnect(),await new Promise(S=>setTimeout(S,200));const{uri:E,approval:x}=await g.connect(b);if(E){h?ot.getWalletConnectQR(E):ot.showWalletConnectModal(E,{...d,dappName:i||""}),ot.wcUri=E;const S=await x();m.updateSession(S),ot.closeModal({success:!0})}return m}catch{return console.error("@argent/login::error"),ot.closeModal(),null}},XI=t=>{if(!t)throw new Error(`Unknown or unsupported chainId (${t}), either specify a supported chain or set bridgeUrl.`);const e=parseInt(`${t}`);if(String(t).startsWith(on.SN_SEPOLIA)||e===11155111)return"https://mobile-login.hydrogen.argent47.net";if(String(t).startsWith(on.SN_MAIN)||e===1)return"https://login.argent.xyz"},eD=t=>{if(!t)throw new Error(`Unknown or unsupported chainId (${t}), either specify a supported chain or set mobileUrl.`);const e=parseInt(`${t}`);if(String(t).startsWith(on.SN_SEPOLIA)||e===11155111)return"argent-dev://";if(String(t).startsWith(on.SN_MAIN)||e===1)return"argent://"};var tD=Object.defineProperty,iD=(t,e,i)=>e in t?tD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,Ht=(t,e,i)=>iD(t,typeof e!="symbol"?e+"":e,i);function rD(t){return typeof t<"u"&&typeof t.context<"u"}const yt={init:"signer_init",uri:"signer_uri",created:"signer_created",updated:"signer_updated",deleted:"signer_deleted",event:"signer_event"};class nD extends Av{constructor(e){super(),Ht(this,"events",new Ge.EventEmitter),Ht(this,"requiredNamespaces"),Ht(this,"pending",!1),Ht(this,"session"),Ht(this,"opts"),Ht(this,"client"),Ht(this,"initializing",!1),this.requiredNamespaces=e?.requiredNamespaces||{},this.opts=e?.client}get connected(){return typeof this.session<"u"}get connecting(){return this.pending}get chains(){return this.session?hl(this.session.namespaces):km(this.requiredNamespaces)}get accounts(){return this.session?ll(this.session.namespaces):[]}on(e,i){this.events.on(e,i)}once(e,i){this.events.once(e,i)}off(e,i){this.events.off(e,i)}removeListener(e,i){this.events.removeListener(e,i)}async open(){if(this.pending)return new Promise((e,i)=>{this.events.once("open",()=>{if(this.events.once("open_error",r=>{i(r)}),typeof this.client>"u")return i(new Error("Sign Client not initialized"));e()})});try{this.pending=!0;const e=await this.register(),i=e.find({requiredNamespaces:this.requiredNamespaces});if(i.length)return this.onOpen(i[0]);const{uri:r,approval:n}=await e.connect({requiredNamespaces:this.requiredNamespaces});this.events.emit(yt.uri,{uri:r}),this.session=await n(),this.events.emit(yt.created,this.session),this.onOpen()}catch(e){throw this.events.emit("open_error",e),e}}async close(){typeof this.session>"u"||(await(await this.register()).disconnect({topic:this.session.topic,reason:ne("USER_DISCONNECTED")}),this.onClose())}async send(e,i){if(typeof this.client>"u"&&(this.client=await this.register(),this.connected||await this.open()),typeof this.session>"u")throw new Error("Signer connection is missing session");this.client.request({topic:this.session.topic,request:e,chainId:i?.chainId}).then(r=>this.events.emit("payload",bn(e.id,r))).catch(r=>this.events.emit("payload",vn(e.id,r.message)))}async register(e=this.opts){if(typeof this.client<"u")return this.client;if(this.initializing)return new Promise((i,r)=>{this.events.once("register_error",n=>{r(n)}),this.events.once(yt.init,()=>{if(typeof this.client>"u")return r(new Error("Sign Client not initialized"));i(this.client)})});if(rD(e))return this.client=e,this.registerEventListeners(),this.client;try{return this.initializing=!0,this.client=await Dn.init(e),this.initializing=!1,this.registerEventListeners(),this.events.emit(yt.init),this.client}catch(i){throw this.events.emit("register_error",i),i}}onOpen(e){this.pending=!1,e&&(this.session=e),this.events.emit("open")}onClose(){this.pending=!1,this.client&&(this.client=void 0),this.events.emit("close")}registerEventListeners(){typeof this.client<"u"&&(this.client.on("session_event",e=>{var i;this.session&&((i=this.session)==null?void 0:i.topic)!==e.topic||this.events.emit(yt.event,e.params)}),this.client.on("session_update",e=>{var i;typeof this.client<"u"&&(this.session&&((i=this.session)==null?void 0:i.topic)!==e.topic||(this.session=this.client.session.get(e.topic),this.events.emit(yt.updated,this.session)))}),this.client.on("session_delete",e=>{var i;this.session&&(this.session&&((i=this.session)==null?void 0:i.topic)!==e.topic||(this.onClose(),this.events.emit(yt.deleted,this.session),this.session=void 0))}))}}class sD{constructor(){V(this,"accounts",[]);V(this,"eventEmitter",new Ge.EventEmitter);V(this,"updateSession",e=>{if(!this.isValidSession(e))throw console.warn("updateSession incompatible session",e,"for adapter",this.formatChainId(this.chainId)),new Error("Invalid session");this.session=e;const i=hl(e.namespaces,[this.namespace]);this.setChainIds(i);const r=ll(e.namespaces,[this.namespace]);this.setAccounts(r)});V(this,"isValidSession",({namespaces:e,requiredNamespaces:i})=>{const r=this.formatChainId(this.chainId);return i?!!i[this.namespace]?.chains?.includes(r):!!e?.[this.namespace]?.accounts.some(n=>n.startsWith(r))})}getRequiredNamespaces(){const e=[this.formatChainId(this.chainId)];return{[this.namespace]:{chains:e,methods:this.methods,events:this.events}}}isCompatibleChainId(e){return typeof e=="string"?e.startsWith(`${this.namespace}:`):!1}setChainIds(e){const r=e.filter(n=>this.isCompatibleChainId(n)).map(n=>this.parseChainId(n)).filter(n=>n!==this.chainId);r.length&&(this.chainId=r[0],this.eventEmitter.emit("chainChanged",this.chainId))}setChainId(e){if(this.isCompatibleChainId(e)){const i=this.parseChainId(e);this.chainId=i,this.eventEmitter.emit("chainChanged",this.chainId)}}parseAccountId(e){const[i,r,n]=e.split(":");return{chainId:`${i}:${r}`,address:n}}getSignerConnection(e){return new nD({requiredNamespaces:{[this.namespace]:{chains:this.rpc.chains,methods:this.rpc.methods,events:this.rpc.events}},client:e})}registerEventListeners(){this.rpcProvider.on("connect",()=>{const{chains:e,accounts:i}=this.signerConnection;e?.length&&this.setChainIds(e),i?.length&&this.setAccounts(i)}),this.signerConnection.on(yt.created,this.updateSession),this.signerConnection.on(yt.updated,this.updateSession),this.signerConnection.on(yt.event,e=>{if(!this.rpc.chains.includes(e.chainId))return;const{event:i}=e;i.name==="accountsChanged"?(this.accounts=i.data,this.eventEmitter.emit("accountsChanged",this.accounts)):i.name==="chainChanged"?this.setChainId(i.data):this.eventEmitter.emit(i.name,i.data)}),this.rpcProvider.on("disconnect",()=>{this.eventEmitter.emit("disconnect")})}}class Jc extends gt.Account{constructor(e,i,r,n){super(e,i,r),this.wallet=n}async execute(e,i,r={}){const n=Array.isArray(e)?e:[e],s=i===void 0||Array.isArray(i)?r:i;return await this.wallet.wallet_requestAddInvokeTransaction({accountAddress:this.address,executionRequest:{calls:n,invocationDetails:s}})}async declare(e,i){throw new Error("Not supported via Ready Login")}async deployAccount(e,i){throw new Error("Not supported via Ready Login")}}class oD{constructor(e){this.wallet=e}async getPubKey(){throw new Error("Not supported via Ready Login")}async signMessage(e,i){const{signature:r}=await this.wallet.wallet_signTypedData({accountAddress:i,typedData:e});return r}async signTransaction(e,i,r){throw new Error("Not supported via Ready Login")}async signDeployAccountTransaction(e){throw new Error("Not supported via Ready Login")}async signDeclareTransaction(e){throw new Error("Not supported via Ready Login")}}const aD=t=>t.replace(/^SN_/,"SN"),cD=t=>t.replace(/^SN/,"SN_");class uD extends sD{constructor({client:i,chainId:r,rpcUrl:n,provider:s}){super();V(this,"id","argentMobile");V(this,"name","Ready (formerly Argent)");V(this,"version","0.1.0");V(this,"icon","");V(this,"provider");V(this,"signer");V(this,"account");V(this,"selectedAddress","");V(this,"namespace","starknet");V(this,"methods",["starknet_supportedSpecs","starknet_signTypedData","starknet_requestAddInvokeTransaction","wallet_supportedSpecs","wallet_signTypedData","wallet_addInvokeTransaction"]);V(this,"events",["chainChanged","accountsChanged"]);V(this,"remoteSigner");V(this,"signerConnection");V(this,"rpcProvider");V(this,"chainId");V(this,"client");V(this,"session");V(this,"rpc");V(this,"walletRpc");V(this,"handleRequest");V(this,"request",async i=>{if(!this.session)throw new Error("No session");let r=i.type;(r==="wallet_addInvokeTransaction"||r==="wallet_supportedSpecs"||r==="wallet_signTypedData")&&(r=r.replace("wallet_","starknet_"));const n=this.handleRequest[r];if(n)return n(i.params);throw new Error(`Not implemented: .request() for ${i.type}`)});V(this,"on",(i,r)=>{this.eventEmitter.on(i,r)});V(this,"off",(i,r)=>{this.eventEmitter.off(i,r)});V(this,"handleRequestChainId",()=>this.chainId===gt.constants.NetworkName.SN_SEPOLIA?gt.constants.StarknetChainId.SN_SEPOLIA:gt.constants.StarknetChainId.SN_MAIN);V(this,"handleRequestAccounts",()=>this.accounts);V(this,"handleGetPermissions",async()=>await this.isPreauthorized()?["accounts"]:[]);V(this,"handleAddInvokeTransaction",async i=>{const{calls:r}=i;return await this.requestWallet({method:"starknet_requestAddInvokeTransaction",params:{accountAddress:this.account.address,executionRequest:{calls:r?.map(({contract_address:n,entry_point:s,...o})=>({...o,contractAddress:n,entrypoint:s}))}}})});V(this,"handleSignTypedData",async i=>{const r={accountAddress:this.account.address,typedData:i},n=await this.requestWallet({method:"starknet_signTypedData",params:r});return"signature"in n?n.signature:n});V(this,"handleSupportedSpecs",async()=>await this.requestWallet({method:"starknet_supportedSpecs",params:{}}));this.chainId=String(r??gt.constants.NetworkName.SN_MAIN),this.rpc={chains:r?[this.formatChainId(this.chainId)]:[],methods:this.methods,events:this.events},this.signerConnection=this.getSignerConnection(i),this.rpcProvider=new ih(this.signerConnection),this.client=i,this.registerEventListeners(),this.walletRpc=new Proxy({},{get:(o,a)=>c=>this.requestWallet({method:a,params:c})}),this.remoteSigner=new oD(this.walletRpc),this.provider=s||new gt.RpcProvider({nodeUrl:n}),this.account=new Jc(this.provider,"",this.remoteSigner,this.walletRpc),this.handleRequest=Object.freeze({wallet_requestChainId:this.handleRequestChainId,wallet_requestAccounts:this.handleRequestAccounts,wallet_getPermissions:this.handleGetPermissions,starknet_addInvokeTransaction:this.handleAddInvokeTransaction,starknet_signTypedData:this.handleSignTypedData,starknet_supportedSpecs:this.handleSupportedSpecs,wallet_addInvokeTransaction:this.handleAddInvokeTransaction,wallet_signTypedData:this.handleSignTypedData,wallet_supportedSpecs:this.handleSupportedSpecs})}getNetworkName(i){if(i==="SN_SEPOLIA")return gt.constants.NetworkName.SN_SEPOLIA;if(i==="SN_MAIN")return gt.constants.NetworkName.SN_MAIN;throw new Error(`Unknown starknet.js network name for chainId ${i}`)}async enable(){return await this.rpcProvider.connect(),this.accounts}get isConnected(){return!0}async isPreauthorized(){return!!this.client.session.getAll().find(this.isValidSession)}async requestWallet(i){if(!this.session)throw new Error("No session");try{const{topic:r}=this.session,n=this.formatChainId(this.chainId);ot.showApprovalModal(i);const s=await this.client.request({topic:r,chainId:n,request:i});return ot.closeModal({success:!0}),s}catch(r){throw ot.closeModal({isRequest:!0}),r instanceof Error||r&&r.message!==void 0?new Error(r.message):new Error("Unknown error on requestWallet")}}get isConnecting(){return this.signerConnection.connecting}async disable(){await this.rpcProvider.disconnect()}get isWalletConnect(){return!0}registerEventListeners(){super.registerEventListeners(),this.eventEmitter.on("chainChanged",i=>{throw new Error("Not implemented: chainChanged")})}formatChainId(i){return`${this.namespace}:${aD(i)}`}parseChainId(i){return cD(i.split(":")[1])}setAccounts(i){this.accounts=i.filter(s=>this.parseChainId(this.parseAccountId(s).chainId)===this.chainId).map(s=>this.parseAccountId(s).address);const{address:r}=this.parseAccountId(i[0]),n=r.startsWith("0x")?r:`0x${r}`;this.account=new Jc(this.provider,n,this.remoteSigner,this.walletRpc),this.eventEmitter.emit("accountsChanged",this.accounts),this.selectedAddress=n}}const lD=async t=>QI(t,uD),hD=Object.freeze(Object.defineProperty({__proto__:null,getStarknetWindowObject:lD},Symbol.toStringTag,{value:"Module"}));exports.Hash=Xu;exports.abytes=yr;exports.aexists=Is;exports.ahash=sw;exports.aoutput=Qu;exports.concatBytes=ww;exports.createView=pw;exports.index=hD;exports.randomBytes=mw;exports.rotr=fw;exports.toBytes=so;exports.wrapConstructor=el;
