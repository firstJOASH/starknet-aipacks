import { constants as n, shortString as D, Provider as g, CallData as A, addAddressPadding as y, getChecksumAddress as z, typedData as I, TypedDataRevision as j, hash as T } from "starknet";
var d = /* @__PURE__ */ ((e) => (e.SUCCESS = "SUCCESS", e.NOT_CONNECTED = "NOT_CONNECTED", e.ERROR = "ERROR", e.CANCELED = "CANCELED", e.USER_INTERACTION_REQUIRED = "USER_INTERACTION_REQUIRED", e))(d || {}), w = /* @__PURE__ */ ((e) => (e.PAYMASTER = "PAYMASTER", e.CREDITS = "CREDITS", e))(w || {});
const l = /* @__PURE__ */ new Set([
  "contracts",
  "messages",
  "target",
  "method",
  "name",
  "description",
  "types",
  "domain",
  "primaryType"
]), C = ["localhost", "127.0.0.1", "0.0.0.0"];
function L(e) {
  if (!l.has(e))
    throw new Error(`Invalid property name: ${e}`);
}
function i(e, t) {
  return L(t), e[t];
}
function U(e) {
  return s(e).map((t) => ({
    entrypoint: t.entrypoint,
    contractAddress: y(t.contractAddress),
    calldata: A.toHex(t.calldata)
  }));
}
function k(e) {
  return Array.isArray(e) ? e.reduce(
    (t, M) => {
      if (i(M, "target")) {
        const N = z(
          i(M, "target")
        ), a = i(M, "method"), c = i(
          t,
          "contracts"
        ), r = {
          name: O(a),
          entrypoint: a,
          description: i(M, "description")
        };
        if (N in c) {
          const u = s(c[N].methods);
          c[N] = {
            methods: [...u, r]
          };
        } else
          c[N] = {
            methods: [r]
          };
      } else
        i(t, "messages").push(M);
      return t;
    },
    { contracts: {}, messages: [] }
  ) : e;
}
function P(e) {
  return [
    ...Object.entries(e.contracts ?? {}).flatMap(
      ([t, { methods: M }]) => s(M).map((N) => ({
        target: t,
        method: N.entrypoint,
        authorized: N.authorized
      }))
    ),
    ...(e.messages ?? []).map((t) => {
      const M = I.getStructHash(
        t.types,
        "StarknetDomain",
        t.domain,
        j.ACTIVE
      ), N = I.getTypeHash(
        t.types,
        t.primaryType,
        j.ACTIVE
      );
      return {
        scope_hash: T.computePoseidonHash(M, N),
        authorized: t.authorized
      };
    })
  ];
}
function s(e) {
  return Array.isArray(e) ? e : [e];
}
function O(e) {
  return e.replace(/([a-z])([A-Z])/g, "$1 $2").replace(/_/g, " ").toLowerCase().replace(/^\w/, (t) => t.toUpperCase());
}
async function b(e) {
  const t = e.pathname.split("/");
  if (t.includes("starknet")) {
    if (t.includes("mainnet"))
      return n.StarknetChainId.SN_MAIN;
    if (t.includes("sepolia"))
      return n.StarknetChainId.SN_SEPOLIA;
  } else if (t.length >= 3) {
    const M = t[2];
    if (t.includes("katana"))
      return D.encodeShortString(
        `WP_${M.toUpperCase().replace(/-/g, "_")}`
      );
    if (t.includes("mainnet"))
      return D.encodeShortString(
        `GG_${M.toUpperCase().replace(/-/g, "_")}`
      );
  }
  if (C.includes(e.hostname))
    return await new g({
      nodeUrl: e.toString()
    }).getChainId();
  throw new Error(`Chain ${e.toString()} not supported`);
}
const Z = "https://x.cartridge.gg", f = "https://profile.cartridge.gg", R = "https://api.cartridge.gg";
class o extends Error {
  constructor() {
    super("Not ready to connect"), Object.setPrototypeOf(this, o.prototype);
  }
}
const m = {
  ACCOUNTS: "accounts"
}, E = "0.7.13", h = {
  version: E
}, Y = "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAwIiBoZWlnaHQ9IjgwMCIgdmlld0JveD0iMCAwIDgwMCA4MDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxnIGZpbHRlcj0idXJsKCNmaWx0ZXIwX2RfNTExMl83ODIpIj4KPHBhdGggZD0iTTQ2OS4yMzYgNzBDNDgyLjM5IDcwIDQ5My4wNTMgODAuNjYzIDQ5My4wNTMgOTMuODE2NFYxNDcuMTQ3TDUxNS4zMzggMTQ3LjE0N0w1MTUuNDI4IDE0Ny4xNDdMNTE1LjU1NCAxNDcuMTQ3TDUxNS44MjYgMTQ3LjE0OUM1MTYuMDE2IDE0Ny4xNTEgNTE2LjIyNSAxNDcuMTUzIDUxNi40NTEgMTQ3LjE1N0M1MTYuOTA0IDE0Ny4xNjQgNTE3LjQyOCAxNDcuMTc2IDUxOC4wMiAxNDcuMTk1QzUxOS4yMDEgMTQ3LjIzNCA1MjAuNjYgMTQ3LjMwNCA1MjIuMzYxIDE0Ny40MjRDNTI1Ljc0MSAxNDcuNjYzIDUzMC4xODUgMTQ4LjExNCA1MzUuMzYzIDE0OC45NjlDNTQ1LjAwMSAxNTAuNTYyIDU1OC41NTYgMTUzLjc4IDU3Mi45MTggMTYwLjYwM0w3MzAuNDIgMjI2LjY3MUw3MzIuMTAxIDIyNy41MDVDNzcxLjc4NyAyNDcuMTc3IDc4OS45OTMgMjg2LjI5NiA3ODkuOTkzIDMyMi4wMzZWNTg1Ljg2NUM3ODkuOTkzIDU4Ni4wNTQgNzg5Ljk5NCA1ODYuMjU0IDc4OS45OTQgNTg2LjQ2M0w3ODkuOTk2IDU4Ni45MTNDNzkwLjAzOCA1OTcuMDk2IDc5MC4xNjEgNjI2Ljk5NiA3NjQuMjMxIDY1Mi44MjNMNzE0Ljc2IDcwMi4wOTVMNzE0LjY0MSA3MDIuMjE1QzcwNC42MDEgNzEyLjI3NSA2OTIuMTIzIDcyMC42NTIgNjc2LjI4NCA3MjQuODc5QzY2NC4zOSA3MjguMDU0IDY1Mi44MjcgNzI3Ljk2NiA2NDguNjM3IDcyNy45MzRMNjQ4LjYxOSA3MjcuOTMzQzY0OC40MDkgNzI3LjkzMiA2NDguMjE5IDcyNy45MyA2NDguMDQ3IDcyNy45M0w2NDcuNzUyIDcyNy45MjlINDgwLjcyMUM0NzQuMDk0IDcyNy45MjkgNDY4LjcyMSA3MjIuNTU2IDQ2OC43MjEgNzE1LjkyOVY2NjguMzg4SDMyOC41ODZDMzI4LjU4NiA2NzIuNjI5IDMyOC41NzIgNjk4LjA1MiAzMjguNTYxIDcxNS45NDRDMzI4LjU1NyA3MjIuNTY5IDMyMy4xODYgNzI3LjkyOSAzMTYuNTYxIDcyNy45MjlIMTUyLjI0NkMxNTIuMTA0IDcyNy45MjkgMTUxLjk0MiA3MjcuOTI5IDE1MS43NjIgNzI3LjkzMUwxNTEuMzYyIDcyNy45MzRDMTQ3LjE3MiA3MjcuOTY2IDEzNS42MDkgNzI4LjA1NCAxMjMuNzE0IDcyNC44NzlDMTA3Ljg3MyA3MjAuNjUxIDk1LjM5MzggNzEyLjI3MiA4NS4zNTI5IDcwMi4yMUw4NS4yMzg2IDcwMi4wOTVMMzUuNjcgNjUyLjcyNUwzNS41NzIzIDY1Mi42MjdDOS44NjI0MiA2MjYuNzggOS45NjY3IDU5Ny4xODUgMTAuMDAzIDU4Ni44NzRDMTAuMDA0MyA1ODYuNTEzIDEwLjAwNTUgNTg2LjE3NyAxMC4wMDU1IDU4NS44NjVWMzIyLjAzNkMxMC4wMDU1IDI4Ni40MyAyOC4xNjYyIDI0Ny4xOTkgNjcuODk3NyAyMjcuNTA1TDY5LjU3OSAyMjYuNjcxTDIyNy4wODEgMTYwLjYwM0MyNDEuNDQzIDE1My43OCAyNTQuOTk4IDE1MC41NjIgMjY0LjYzNiAxNDguOTY5QzI2OS44MTQgMTQ4LjExNCAyNzQuMjU4IDE0Ny42NjMgMjc3LjYzOCAxNDcuNDI0QzI3OS4zMzggMTQ3LjMwNCAyODAuNzk4IDE0Ny4yMzQgMjgxLjk3OSAxNDcuMTk1QzI4Mi41NzEgMTQ3LjE3NiAyODMuMDk1IDE0Ny4xNjQgMjgzLjU0NyAxNDcuMTU3TDI4My45MTcgMTQ3LjE1MkwyODQuMTczIDE0Ny4xNDlMMjg0LjQ0NSAxNDcuMTQ3TDI4NC41NzEgMTQ3LjE0N0wyODQuNjYgMTQ3LjE0N0wzMDYuOTQyIDE0Ny4xNDdWOTMuODE2NEMzMDYuOTQyIDgwLjY2MyAzMTcuNjA1IDcwIDMzMC43NTggNzBINDY5LjIzNloiIGZpbGw9IiMxOTFBMUEiLz4KPHBhdGggZD0iTTM2Ni40ODMgMTI5LjU0SDQzMy41MTJWMjA2LjY4N0gzNjYuNDgzVjEyOS41NFoiIGZpbGw9IiNGQkNCNEEiLz4KPHBhdGggZD0iTTI2OS4wMSA2MDIuNDI5SDE0NC4wMDhDMTM1Ljc2OCA2MDIuNDI5IDEzNS43NjggNTk0LjE0NiAxMzUuNzY4IDU5NC4xNDZWMjgwLjg1QzEzNS43NjggMjgwLjg1IDEzNS43NjggMjcyLjY0NCAxNDQuMDA4IDI3Mi42NDRIMzY2LjQ4M0wzNjYuNDgzIDIwNi42ODdIMjg0LjY5QzI4NC42OSAyMDYuNjg3IDI2OC4xMzQgMjA2LjY4NyAyNTEuNTc5IDIxNC44OTNMOTQuMzQxNCAyODAuODVDNzcuNzg2MSAyODkuMDU3IDY5LjU0NjkgMzA1LjYyMyA2OS41NDY5IDMyMi4wMzVWNTg1Ljg2M0M2OS41NDY5IDU5NC4xNDcgNjkuNTQ2OSA2MDIuMzUzIDc3Ljc4NjEgNjEwLjYzNkwxMjcuNDUyIDY2MC4xMDRDMTM1LjY5MSA2NjguMzg3IDE0MS45MjggNjY4LjM4NyAxNTIuMjQ3IDY2OC4zODdIMjY5LjAyOUMyNjkuMDM3IDY0OC4zNCAyNjkuMDQ2IDYyNC42NTUgMjY5LjA1NCA2MDIuODg3SDUyOC4wMTNWNjY4LjM4N0g2NDcuNzUzQzY1OC4wNzEgNjY4LjM4NyA2NjQuMzA4IDY2OC4zODcgNjcyLjU0NyA2NjAuMTA0TDcyMi4yMTMgNjEwLjYzNkM3MzAuNDUzIDYwMi40MjkgNzMwLjQ1MyA1OTQuMTQ3IDczMC40NTMgNTg1Ljg2M1YzMjIuMDM1QzczMC40NTMgMzA1LjU0NiA3MjIuMjEzIDI4OS4wNTcgNzA1LjY1OCAyODAuODVMNTQ4LjQyMSAyMTQuODkzQzUzMS44NjUgMjA2LjY4NyA1MTUuMzEgMjA2LjY4NyA1MTUuMzEgMjA2LjY4N0g0MzMuNTEyTDQzMy41MTIgMjcyLjY0NEg2NTYuMDY5QzY2NC4zMDggMjcyLjY0NCA2NjQuMzA4IDI4MC44NSA2NjQuMzA4IDI4MC44NVY1OTQuMTQ2QzY2NC4zMDggNTk0LjE0NiA2NjQuMzA4IDYwMi40MjkgNjU2LjA2OSA2MDIuNDI5SDUyOC4yNjJWNTM3LjM5NkgyNjkuMDc1QzI2OS4wNzUgNTQzLjcwNyAyNjkuMDE3IDU5Ni45MTIgMjY5LjAxIDYwMi40MjlaIiBmaWxsPSIjRkJDQjRBIi8+CjxwYXRoIGQ9Ik0yNjkuMDA5IDQzNi4xNzJINTI4LjI2MlYzNzAuNjgxSDI2OS4wNzVDMjY5LjA3NSAzNzcuMzczIDI2OS4wMDkgNDM2Ljc4OCAyNjkuMDA5IDQzNi4xNzJaIiBmaWxsPSIjRkJDQjRBIi8+CjwvZz4KPGRlZnM+CjxmaWx0ZXIgaWQ9ImZpbHRlcjBfZF81MTEyXzc4MiIgeD0iLTQiIHk9IjAiIHdpZHRoPSI4MDgiIGhlaWdodD0iODA4IiBmaWx0ZXJVbml0cz0idXNlclNwYWNlT25Vc2UiIGNvbG9yLWludGVycG9sYXRpb24tZmlsdGVycz0ic1JHQiI+CjxmZUZsb29kIGZsb29kLW9wYWNpdHk9IjAiIHJlc3VsdD0iQmFja2dyb3VuZEltYWdlRml4Ii8+CjxmZUNvbG9yTWF0cml4IGluPSJTb3VyY2VBbHBoYSIgdHlwZT0ibWF0cml4IiB2YWx1ZXM9IjAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDEyNyAwIiByZXN1bHQ9ImhhcmRBbHBoYSIvPgo8ZmVPZmZzZXQgZHk9IjQiLz4KPGZlR2F1c3NpYW5CbHVyIHN0ZERldmlhdGlvbj0iMiIvPgo8ZmVDb21wb3NpdGUgaW4yPSJoYXJkQWxwaGEiIG9wZXJhdG9yPSJvdXQiLz4KPGZlQ29sb3JNYXRyaXggdHlwZT0ibWF0cml4IiB2YWx1ZXM9IjAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAuMjUgMCIvPgo8ZmVCbGVuZCBtb2RlPSJub3JtYWwiIGluMj0iQmFja2dyb3VuZEltYWdlRml4IiByZXN1bHQ9ImVmZmVjdDFfZHJvcFNoYWRvd181MTEyXzc4MiIvPgo8ZmVCbGVuZCBtb2RlPSJub3JtYWwiIGluPSJTb3VyY2VHcmFwaGljIiBpbjI9ImVmZmVjdDFfZHJvcFNoYWRvd181MTEyXzc4MiIgcmVzdWx0PSJzaGFwZSIvPgo8L2ZpbHRlcj4KPC9kZWZzPgo8L3N2Zz4K";
function S() {
}
class p {
  m_lastPromise = Promise.resolve();
  /**
   * Acquire lock
   * @param [bypass=false] option to skip lock acquisition
   */
  async obtain(t = !1) {
    let M = S;
    if (t) return M;
    const N = this.m_lastPromise;
    return this.m_lastPromise = new Promise((a) => M = a), await N, M;
  }
}
const Q = new p();
class _ {
  id = "controller";
  name = "Controller";
  version = h.version;
  icon = Y;
  account;
  subscriptions = [];
  _probePromise = null;
  async safeProbe() {
    if (this.account)
      return this.account;
    if (this._probePromise)
      return this._probePromise;
    const t = await Q.obtain();
    return await new Promise(async (M) => {
      try {
        this._probePromise = this.probe();
        const N = await this._probePromise;
        M(N);
      } finally {
        this._probePromise = null;
      }
    }).finally(() => {
      t();
    });
  }
  request = async (t) => {
    switch (t.type) {
      case "wallet_getPermissions":
        return await this.safeProbe(), this.account ? [m.ACCOUNTS] : [];
      case "wallet_requestAccounts": {
        if (this.account)
          return [this.account.address];
        const N = t.params && t.params.silent_mode;
        return this.account = await this.safeProbe(), !this.account && !N && (this.account = await this.connect()), this.account ? [this.account.address] : [];
      }
      case "wallet_watchAsset":
        throw {
          code: 63,
          message: "An unexpected error occurred",
          data: "wallet_watchAsset not implemented"
        };
      case "wallet_addStarknetChain": {
        let N = t.params;
        return this.addStarknetChain(N);
      }
      case "wallet_switchStarknetChain": {
        let N = t.params;
        return this.switchStarknetChain(N.chainId);
      }
      case "wallet_requestChainId":
        if (!this.account)
          throw {
            code: 63,
            message: "An unexpected error occurred",
            data: "Account not initialized"
          };
        return await this.account.getChainId();
      case "wallet_deploymentData":
        throw {
          code: 63,
          message: "An unexpected error occurred",
          data: "wallet_deploymentData not implemented"
        };
      case "wallet_addInvokeTransaction":
        if (!this.account)
          throw {
            code: 63,
            message: "An unexpected error occurred",
            data: "Account not initialized"
          };
        let M = t.params;
        return await this.account.execute(
          M.calls.map((N) => ({
            contractAddress: N.contract_address,
            entrypoint: N.entry_point,
            calldata: N.calldata
          }))
        );
      case "wallet_addDeclareTransaction":
        throw {
          code: 63,
          message: "An unexpected error occurred",
          data: "wallet_addDeclareTransaction not implemented"
        };
      case "wallet_signTypedData": {
        if (!this.account)
          throw {
            code: 63,
            message: "An unexpected error occurred",
            data: "Account not initialized"
          };
        return await this.account.signMessage(t.params);
      }
      case "wallet_supportedSpecs":
        return [];
      case "wallet_supportedWalletApi":
        return [];
      default:
        throw {
          code: 63,
          message: "An unexpected error occurred",
          data: `Unknown RPC call type: ${t.type}`
        };
    }
  };
  on = (t, M) => {
    if (t !== "accountsChanged" && t !== "networkChanged")
      throw new Error(`Unknown event: ${t}`);
    this.subscriptions.push({ type: t, handler: M });
  };
  off = (t, M) => {
    if (t !== "accountsChanged" && t !== "networkChanged")
      throw new Error(`Unknown event: ${t}`);
    const N = this.subscriptions.findIndex(
      (a) => a.type === t && a.handler === M
    );
    N >= 0 && this.subscriptions.splice(N, 1);
  };
  emitNetworkChanged(t) {
    this.subscriptions.filter((M) => M.type === "networkChanged").forEach((M) => {
      M.handler(t);
    });
  }
  emitAccountsChanged(t) {
    this.subscriptions.filter((M) => M.type === "accountsChanged").forEach((M) => {
      M.handler(t);
    });
  }
}
export {
  R as A,
  _ as B,
  w as F,
  Z as K,
  o as N,
  f as P,
  d as R,
  k as a,
  P as b,
  O as h,
  U as n,
  b as p,
  s as t
};
//# sourceMappingURL=provider-C4iZV8Y5.js.map
