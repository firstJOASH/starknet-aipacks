{"version":3,"sources":["dist/penpal.js"],"names":["Penpal","MessageType","Resolution","ErrorCode","NativeErrorName","NativeEventType","createDestructor","localName","log","callbacks","destroyed","[object Object]","error","forEach","callback","push","createLogger","debug","args","console","DEFAULT_PORT_BY_PROTOCOL","http:","https:","URL_REGEX","opaqueOriginSchemes","getOriginFromSrc","src","find","scheme","startsWith","location","document","regexResult","exec","protocol","hostname","port","portSuffix","serializeError","name","message","stack","deserializeError","obj","deserializedError","Error","Object","keys","key","connectCallReceiver","info","serializedMethods","local","remote","originForSending","originForReceiving","handleMessageEvent","event","source","data","penpal","Call","origin","callMessage","methodName","id","createPromiseHandler","resolution","returnValue","Reply","Rejected","returnValueIsError","postMessage","err","DataCloneError","errorReplyMessage","Promise","resolve","call","apply","then","Fulfilled","addEventListener","Message","removeEventListener","generateId","KEY_PATH_DELIMITER","keyPathToSegments","keyPath","split","segmentsToKeyPath","segments","join","createKeyPath","prefix","setAtKeyPath","subject","value","reduce","prevSubject","idx","length","serializeMethods","methods","flattenedMethods","assign","deserializeMethods","connectCallSender","callSender","methodKeyPaths","destroyConnection","createMethodProxy","iframeRemoved","closed","e","code","ConnectionDestroyed","reject","replyMessage","api","handleAckMessageFactory","childOrigin","destructor","destroy","onDestroy","destroyCallReceiver","receiverMethodNames","window","receiverMethodName","methodNames","destroyCallSender","handleSynMessageFactory","synAckMessage","SynAck","CHECK_IFRAME_IN_DOC_INTERVAL","monitorIframeRemoval","iframe","checkIframeInDocIntervalId","setInterval","isConnected","clearInterval","startConnectionTimeout","timeout","timeoutId","undefined","setTimeout","ConnectionTimeout","clearTimeout","validateIframeHasSrcOrSrcDoc","srcdoc","NoIframeSrc","connectToChild","options","handleSynMessage","handleAckMessage","promise","stopConnectionTimeout","handleMessage","contentWindow","Syn","Ack","handleSynAckMessageFactory","parentOrigin","originQualifies","RegExp","test","ackMessage","parent","areGlobalsAccessible","connectToParent","handleSynAckMessage","sendSynMessage","synMessage","parentOriginForSyn","indexForBundle"],"mappings":"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"}